import './polyfills.server.mjs';
import{$ as I,A as gr,B as Ge,C as ja,D as $a,Da as sv,E as mo,F as Se,Fa as Fd,G as Ce,Ga as ov,H as yr,I as go,Ia as Ld,J as oi,Ja as ji,K as bn,Ka as Hn,L as yo,La as av,M as zi,Ma as Vd,N as En,O as B,Oa as lv,P as z,Pa as $i,Q as vo,Qa as Wi,R as Gi,Ra as el,S as _t,Sa as cv,T as Fe,Ta as uv,U as Nd,Ua as dv,V as X,Va as hv,W as Od,Wa as tl,X as Wa,Xa as fv,Y as Ka,Ya as pv,Z as Ha,Za as mv,_ as Qa,_a as gv,a as fr,aa as w,b as za,ba as pe,bb as yv,c as nn,ca as Ke,d as Qy,da as ie,e as Yy,ea as me,f as pr,fa as Ya,fb as vv,g as ii,ga as Ja,gb as _v,h as qi,ha as L,i as po,ia as rt,ib as Tt,j as Mt,ja as ot,jb as nl,k as Jy,ka as tv,kb as Sv,l as Xy,la as at,m as Rd,ma as lt,n as Zy,na as ct,o as kd,oa as zt,p as si,pa as je,q as xd,qa as Md,r as ev,ra as ai,s as Ga,sa as _o,t as qt,ta as Xa,u as ke,ua as nv,v as mr,va as rv,w as Pe,wa as Pd,x as he,xa as Za,y as Cn,z as ze,za as iv}from"./chunk-7SLQSPEO.mjs";import{a as Cv,b as bv,c as Bd,d as Ev,e as Tv,f as wv,g as Ud,h as Iv,i as Av,j as rn,k as So,l as Qn,m as rl,n as Co,o as qd,p as Dv,q as bo,r as il,s as St,t as Pt,u as zw}from"./chunk-GDK6FPRZ.mjs";import{a as vt,b as Ot,c as fe,f as A,h as Dd,j as R}from"./chunk-EXD34EPT.mjs";var de=A(jt=>{"use strict";Object.defineProperty(jt,"__esModule",{value:!0});jt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=jt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=jt.Propagate=jt.LogVerbosity=jt.Status=void 0;var O_=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(O_||(jt.Status=O_={})),M_=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(M_||(jt.LogVerbosity=M_={})),P_=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(P_||(jt.Propagate=P_={}));jt.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;jt.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var gh=A((P4,OD)=>{OD.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var xe=A(Ct=>{"use strict";var yh,vh,_h,Sh;Object.defineProperty(Ct,"__esModule",{value:!0});Ct.isTracerEnabled=Ct.trace=Ct.log=Ct.setLoggerVerbosity=Ct.setLogger=Ct.getLogger=void 0;var Ir=de(),MD=fe("process"),PD=gh().version,FD={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},gi=FD,ns=Ir.LogVerbosity.ERROR,LD=(vh=(yh=process.env.GRPC_NODE_VERBOSITY)!==null&&yh!==void 0?yh:process.env.GRPC_VERBOSITY)!==null&&vh!==void 0?vh:"";switch(LD.toUpperCase()){case"DEBUG":ns=Ir.LogVerbosity.DEBUG;break;case"INFO":ns=Ir.LogVerbosity.INFO;break;case"ERROR":ns=Ir.LogVerbosity.ERROR;break;case"NONE":ns=Ir.LogVerbosity.NONE;break;default:}var VD=()=>gi;Ct.getLogger=VD;var BD=n=>{gi=n};Ct.setLogger=BD;var UD=n=>{ns=n};Ct.setLoggerVerbosity=UD;var qD=(n,...e)=>{let t;if(n>=ns){switch(n){case Ir.LogVerbosity.DEBUG:t=gi.debug;break;case Ir.LogVerbosity.INFO:t=gi.info;break;case Ir.LogVerbosity.ERROR:t=gi.error;break}t||(t=gi.error),t&&t.bind(gi)(...e)}};Ct.log=qD;var zD=(Sh=(_h=process.env.GRPC_NODE_TRACE)!==null&&_h!==void 0?_h:process.env.GRPC_TRACE)!==null&&Sh!==void 0?Sh:"",Ch=new Set,F_=new Set;for(let n of zD.split(","))n.startsWith("-")?F_.add(n.substring(1)):Ch.add(n);var GD=Ch.has("all");function jD(n,e,t){L_(e)&&(0,Ct.log)(n,new Date().toISOString()+" | v"+PD+" "+MD.pid+" | "+e+" | "+t)}Ct.trace=jD;function L_(n){return!F_.has(n)&&(GD||Ch.has(n))}Ct.isTracerEnabled=L_});var kl=A(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.getErrorCode=rs.getErrorMessage=void 0;function $D(n){return n instanceof Error?n.message:String(n)}rs.getErrorMessage=$D;function WD(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}rs.getErrorCode=WD});var At=A(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.Metadata=void 0;var KD=xe(),HD=de(),QD=kl(),YD=/^[0-9a-z_.-]+$/,JD=/^[ -~]*$/;function XD(n){return YD.test(n)}function ZD(n){return JD.test(n)}function B_(n){return n.endsWith("-bin")}function e1(n){return!n.startsWith("grpc-")}function xl(n){return n.toLowerCase()}function V_(n,e){if(!XD(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(B_(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!ZD(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var bh=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=xl(e),V_(e,t),this.internalRepr.set(e,[t])}add(e,t){e=xl(e),V_(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=xl(e),this.internalRepr.delete(e)}get(e){return e=xl(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(t1);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{B_(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(e1(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,QD.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,KD.log)(HD.LogVerbosity.ERROR,o)}}return t}};Nl.Metadata=bh;var t1=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Ah=A(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.CallCredentials=void 0;var Ih=At();function n1(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var is=class n{static createFromMetadataGenerator(e){return new Th(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;n1(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Ih.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new wh}};Ol.CallCredentials=is;var Eh=class n extends is{constructor(e){super(),this.creds=e}generateMetadata(e){return R(this,null,function*(){let t=new Ih.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},Th=class n extends is{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Eh([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},wh=class n extends is{generateMetadata(e){return Promise.resolve(new Ih.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Rh=A(ss=>{"use strict";Object.defineProperty(ss,"__esModule",{value:!0});ss.getDefaultRootsData=ss.CIPHER_SUITES=void 0;var r1=fe("fs");ss.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var U_=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Dh=null;function i1(){return U_?(Dh===null&&(Dh=r1.readFileSync(U_)),Dh):null}ss.getDefaultRootsData=i1});var Fl=A(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.ChannelCredentials=void 0;var s1=fe("tls"),o1=Ah(),q_=Rh();function kh(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var os=class{constructor(e){this.callCredentials=e||o1.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(kh(e,"Root certificate"),kh(t,"Private key"),kh(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,s1.createSecureContext)({ca:(s=e??(0,q_.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:q_.CIPHER_SUITES});return new Ml(o,i??{})}static createFromSecureContext(e,t){return new Ml(e,t??{})}static createInsecure(){return new xh}};Pl.ChannelCredentials=os;var xh=class n extends os{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Ml=class n extends os{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Nh(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Nh=class n extends os{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Dr=A(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.validateLoadBalancingConfig=ut.getFirstUsableConfig=ut.isLoadBalancerNameRegistered=ut.createLoadBalancer=ut.registerDefaultLoadBalancerType=ut.registerLoadBalancerType=ut.createChildChannelControlHelper=void 0;function a1(n,e){var t,r,i,s,o,a,l,c,u,p;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(p=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&p!==void 0?p:n.removeChannelzChild.bind(n)}}ut.createChildChannelControlHelper=a1;var Ar={},Oh=null;function l1(n,e,t){Ar[n]={LoadBalancer:e,LoadBalancingConfig:t}}ut.registerLoadBalancerType=l1;function c1(n){Oh=n}ut.registerDefaultLoadBalancerType=c1;function u1(n,e){let t=n.getLoadBalancerName();return t in Ar?new Ar[t].LoadBalancer(e):null}ut.createLoadBalancer=u1;function d1(n){return n in Ar}ut.isLoadBalancerNameRegistered=d1;function h1(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Ar)return t;return e&&Oh?new Ar[Oh].LoadBalancingConfig:null}ut.getFirstUsableConfig=h1;function f1(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Ar)return Ar[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}ut.validateLoadBalancingConfig=f1});var Mh=A(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.extractAndSelectServiceConfig=Rr.validateServiceConfig=Rr.validateRetryThrottling=void 0;var p1=fe("os"),Ll=de(),m1=Dr(),Vl=/^\d+(\.\d{1,9})?s$/,g1="node";function y1(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function v1(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Vl.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Vl.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Ll.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Ll.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function _1(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Vl.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Ll.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Ll.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function S1(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(y1(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Vl.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=v1(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=_1(n.hedgingPolicy));return t}function z_(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Rr.validateRetryThrottling=z_;function G_(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,m1.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(S1(r));"retryThrottling"in n&&(e.retryThrottling=z_(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Rr.validateServiceConfig=G_;function C1(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:G_(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function b1(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=C1(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===p1.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===g1&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function E1(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return b1(i,e)}return null}Rr.extractAndSelectServiceConfig=E1});var $t=A(Bl=>{"use strict";Object.defineProperty(Bl,"__esModule",{value:!0});Bl.ConnectivityState=void 0;var j_=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(j_||(Bl.ConnectivityState=j_={}))});var Ft=A(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.uriToString=kr.splitHostPort=kr.parseUri=void 0;var T1=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function w1(n){let e=T1.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}kr.parseUri=w1;var $_=/^\d+$/;function I1(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return $_.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?$_.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}kr.splitHostPort=I1;function A1(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}kr.uriToString=A1});var In=A(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.mapUriDefaultScheme=Wt.getDefaultAuthority=Wt.createResolver=Wt.registerDefaultScheme=Wt.registerResolver=void 0;var Fh=Ft(),as={},Ph=null;function D1(n,e){as[n]=e}Wt.registerResolver=D1;function R1(n){Ph=n}Wt.registerDefaultScheme=R1;function k1(n,e,t){if(n.scheme!==void 0&&n.scheme in as)return new as[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Fh.uriToString)(n)}`)}Wt.createResolver=k1;function x1(n){if(n.scheme!==void 0&&n.scheme in as)return as[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Fh.uriToString)(n)}`)}Wt.getDefaultAuthority=x1;function N1(n){return n.scheme===void 0||!(n.scheme in as)?Ph!==null?{scheme:Ph,authority:void 0,path:(0,Fh.uriToString)(n)}:null:n}Wt.mapUriDefaultScheme=N1});var Nr=A(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.QueuePicker=xr.UnavailablePicker=xr.PickResultType=void 0;var O1=At(),M1=de(),Ul=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Ul||(xr.PickResultType=Ul={})),Lh=class{constructor(e){this.status=Object.assign({code:M1.Status.UNAVAILABLE,details:"No connection established",metadata:new O1.Metadata},e)}pick(e){return{pickResultType:Ul.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};xr.UnavailablePicker=Lh;var Vh=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Ul.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};xr.QueuePicker=Vh});var Fo=A(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.BackoffTimeout=void 0;var P1=1e3,F1=1.6,L1=12e4,V1=.2;function B1(n,e){return Math.random()*(e-n)+n}var Bh=class{constructor(e,t){this.callback=e,this.initialDelay=P1,this.multiplier=F1,this.maxDelay=L1,this.jitter=V1,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+B1(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};ql.BackoffTimeout=Bh});var Gl=A(zl=>{"use strict";Object.defineProperty(zl,"__esModule",{value:!0});zl.ChildLoadBalancerHandler=void 0;var U1=Dr(),q1=$t(),z1="child_load_balancer_helper",Uh=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===q1.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,U1.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return z1}};zl.ChildLoadBalancerHandler=Uh});var K_=A(jl=>{"use strict";Object.defineProperty(jl,"__esModule",{value:!0});jl.ResolvingLoadBalancer=void 0;var G1=Dr(),j1=Mh(),Dt=$t(),$1=In(),ls=Nr(),W1=Fo(),qh=de(),K1=At(),H1=xe(),Q1=de(),Y1=Ft(),J1=Gl(),X1="resolving_load_balancer";function W_(n){H1.trace(Q1.LogVerbosity.DEBUG,X1,n)}var Z1=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function eR(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function tR(n,e,t,r){for(let i of t)if(eR(n,e,i,r))return i;return null}function nR(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of Z1){let u=tR(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:qh.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:qh.Status.OK,dynamicFilterFactories:[]}}}var zh=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Dt.ConnectivityState.IDLE,this.latestChildPicker=new ls.QueuePicker(this),this.currentState=Dt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,j1.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Dt.ConnectivityState.IDLE,new ls.QueuePicker(this)),this.childLoadBalancer=new J1.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(W_("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,$1.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,p)=>{var m;this.backoffTimeout.stop(),this.backoffTimeout.reset();let S=null;l===null?c===null?(this.previousServiceConfig=null,S=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):S=this.previousServiceConfig:(S=l,this.previousServiceConfig=l);let E=(m=S?.loadBalancingConfig)!==null&&m!==void 0?m:[],T=(0,G1.getFirstUsableConfig)(E,!0);if(T===null){this.handleResolutionFailure({code:qh.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new K1.Metadata});return}this.childLoadBalancer.updateAddressList(a,T,p);let b=S??this.defaultServiceConfig;this.onSuccessfulResolution(b,u??nR(b))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new W1.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Dt.ConnectivityState.IDLE&&this.updateState(Dt.ConnectivityState.CONNECTING,new ls.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){W_((0,Y1.uriToString)(this.target)+" "+Dt.ConnectivityState[this.currentState]+" -> "+Dt.ConnectivityState[e]),e===Dt.ConnectivityState.IDLE&&(t=new ls.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Dt.ConnectivityState.IDLE&&(this.updateState(Dt.ConnectivityState.TRANSIENT_FAILURE,new ls.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Dt.ConnectivityState.IDLE||this.currentState===Dt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Dt.ConnectivityState.IDLE,this.latestChildPicker=new ls.QueuePicker(this),this.currentState=Dt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};jl.ResolvingLoadBalancer=zh});var H_=A(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.channelOptionsEqual=cs.recognizedOptions=void 0;cs.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function rR(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}cs.channelOptionsEqual=rR});var Dn=A(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.stringToSubchannelAddress=An.subchannelAddressToString=An.subchannelAddressEqual=An.isTcpSubchannelAddress=void 0;var iR=fe("net");function Lo(n){return"port"in n}An.isTcpSubchannelAddress=Lo;function sR(n,e){return!n&&!e?!0:!n||!e?!1:Lo(n)?Lo(e)&&n.host===e.host&&n.port===e.port:!Lo(e)&&n.path===e.path}An.subchannelAddressEqual=sR;function oR(n){return Lo(n)?n.host+":"+n.port:n.path}An.subchannelAddressToString=oR;var aR=443;function lR(n,e){return(0,iR.isIP)(n)?{host:n,port:e??aR}:{path:n}}An.stringToSubchannelAddress=lR});var $l=A(us=>{"use strict";Object.defineProperty(us,"__esModule",{value:!0});us.addAdminServicesToServer=us.registerAdminService=void 0;var Q_=[];function cR(n,e){Q_.push({getServiceDefinition:n,getHandlers:e})}us.registerAdminService=cR;function uR(n){for(let{getServiceDefinition:e,getHandlers:t}of Q_)n.addService(e(),t())}us.addAdminServicesToServer=uR});var Y_=A(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.ClientDuplexStreamImpl=Kt.ClientWritableStreamImpl=Kt.ClientReadableStreamImpl=Kt.ClientUnaryCallImpl=Kt.callErrorFromStatus=void 0;var dR=fe("events"),Kh=fe("stream"),Vo=de();function hR(n,e){let t=`${n.code} ${Vo.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Kt.callErrorFromStatus=hR;var Gh=class extends dR.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vo.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Kt.ClientUnaryCallImpl=Gh;var jh=class extends Kh.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vo.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Kt.ClientReadableStreamImpl=jh;var $h=class extends Kh.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vo.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Kt.ClientWritableStreamImpl=$h;var Wh=class extends Kh.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Vo.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Kt.ClientDuplexStreamImpl=Wh});var J_=A(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.InterceptingListenerImpl=ds.isInterceptingListener=void 0;function fR(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}ds.isInterceptingListener=fR;var Hh=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};ds.InterceptingListenerImpl=Hh});var tf=A(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.getInterceptingCall=Ht.InterceptingCall=Ht.RequesterBuilder=Ht.ListenerBuilder=Ht.InterceptorConfigurationError=void 0;var pR=At(),X_=J_(),Z_=de(),e0=kl(),Uo=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Ht.InterceptorConfigurationError=Uo;var Yh=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Ht.ListenerBuilder=Yh;var Jh=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Ht.RequesterBuilder=Jh;var Qh={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Bo={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Xh=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Bo.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Bo.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Bo.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Bo.cancel}:this.requester=Bo}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,p)=>{var m,S,E;this.processingMetadata=!1;let T;if((0,X_.isInterceptingListener)(p))T=p;else{let b={onReceiveMetadata:(m=p.onReceiveMetadata)!==null&&m!==void 0?m:Qh.onReceiveMetadata,onReceiveMessage:(S=p.onReceiveMessage)!==null&&S!==void 0?S:Qh.onReceiveMessage,onReceiveStatus:(E=p.onReceiveStatus)!==null&&E!==void 0?E:Qh.onReceiveStatus};T=new X_.InterceptingListenerImpl(b,c)}this.nextCall.start(u,T),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Ht.InterceptingCall=Xh;function mR(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Wl=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(Z_.Status.INTERNAL,`Request message serialization failure: ${(0,e0.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:Z_.Status.INTERNAL,details:`Response message parsing error: ${(0,e0.getErrorMessage)(a)}`,metadata:new pR.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Zh=class extends Wl{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},ef=class extends Wl{};function gR(n,e,t){let r=mR(n,t.path,e);return t.responseStream?new ef(r,t):new Zh(r,t)}function yR(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Uo("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Uo("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>gR(r,a,e))(s)}Ht.getInterceptingCall=yR});var sf=A(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});Hl.Client=void 0;var Rn=Y_(),vR=of(),_R=$t(),Or=de(),hs=At(),Kl=tf(),cn=Symbol(),fs=Symbol(),ps=Symbol(),Xn=Symbol();function nf(n){return typeof n=="function"}function ms(n){return n.stack.split(`
`).slice(1).join(`
`)}var rf=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[fs]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[ps]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[fs].length>0&&this[ps].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Xn]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[cn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[cn]=o(e,t,r)}else this[cn]=new vR.ChannelImplementation(e,t,r)}close(){this[cn].close()}getChannel(){return this[cn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[cn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===_R.ConnectivityState.READY)t();else try{this[cn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(nf(e))return{metadata:new hs.Metadata,options:{},callback:e};if(nf(t))return e instanceof hs.Metadata?{metadata:e,options:{},callback:t}:{metadata:new hs.Metadata,options:e,callback:t};if(!(e instanceof hs.Metadata&&t instanceof Object&&nf(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),p={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},m={argument:i,metadata:u.metadata,call:new Rn.ClientUnaryCallImpl,channel:this[cn],methodDefinition:p,callOptions:u.options,callback:u.callback};this[Xn]&&(m=this[Xn](m));let S=m.call,E={clientInterceptors:this[fs],clientInterceptorProviders:this[ps],callInterceptors:(l=m.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=m.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},T=(0,Kl.getInterceptingCall)(E,m.methodDefinition,m.callOptions,m.channel);S.call=T;let b=null,O=!1,D=new Error;return T.start(m.metadata,{onReceiveMetadata:M=>{S.emit("metadata",M)},onReceiveMessage(M){b!==null&&T.cancelWithStatus(Or.Status.INTERNAL,"Too many responses received"),b=M},onReceiveStatus(M){if(!O){if(O=!0,M.code===Or.Status.OK)if(b===null){let P=ms(D);m.callback((0,Rn.callErrorFromStatus)({code:Or.Status.INTERNAL,details:"No message received",metadata:M.metadata},P))}else m.callback(null,b);else{let P=ms(D);m.callback((0,Rn.callErrorFromStatus)(M,P))}D=null,S.emit("status",M)}}}),T.sendMessage(i),T.halfClose(),S}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},p={metadata:c.metadata,call:new Rn.ClientWritableStreamImpl(t),channel:this[cn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Xn]&&(p=this[Xn](p));let m=p.call,S={clientInterceptors:this[fs],clientInterceptorProviders:this[ps],callInterceptors:(a=p.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=p.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,Kl.getInterceptingCall)(S,p.methodDefinition,p.callOptions,p.channel);m.call=E;let T=null,b=!1,O=new Error;return E.start(p.metadata,{onReceiveMetadata:D=>{m.emit("metadata",D)},onReceiveMessage(D){T!==null&&E.cancelWithStatus(Or.Status.INTERNAL,"Too many responses received"),T=D},onReceiveStatus(D){if(!b){if(b=!0,D.code===Or.Status.OK)if(T===null){let M=ms(O);p.callback((0,Rn.callErrorFromStatus)({code:Or.Status.INTERNAL,details:"No message received",metadata:D.metadata},M))}else p.callback(null,T);else{let M=ms(O);p.callback((0,Rn.callErrorFromStatus)(D,M))}O=null,m.emit("status",D)}}}),m}checkMetadataAndOptions(e,t){let r,i;return e instanceof hs.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new hs.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},p={argument:i,metadata:c.metadata,call:new Rn.ClientReadableStreamImpl(r),channel:this[cn],methodDefinition:u,callOptions:c.options};this[Xn]&&(p=this[Xn](p));let m=p.call,S={clientInterceptors:this[fs],clientInterceptorProviders:this[ps],callInterceptors:(a=p.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=p.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},E=(0,Kl.getInterceptingCall)(S,p.methodDefinition,p.callOptions,p.channel);m.call=E;let T=!1,b=new Error;return E.start(p.metadata,{onReceiveMetadata(O){m.emit("metadata",O)},onReceiveMessage(O){m.push(O)},onReceiveStatus(O){if(!T){if(T=!0,m.push(null),O.code!==Or.Status.OK){let D=ms(b);m.emit("error",(0,Rn.callErrorFromStatus)(O,D))}b=null,m.emit("status",O)}}}),E.sendMessage(i),E.halfClose(),m}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Rn.ClientDuplexStreamImpl(t,r),channel:this[cn],methodDefinition:c,callOptions:l.options};this[Xn]&&(u=this[Xn](u));let p=u.call,m={clientInterceptors:this[fs],clientInterceptorProviders:this[ps],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},S=(0,Kl.getInterceptingCall)(m,u.methodDefinition,u.callOptions,u.channel);p.call=S;let E=!1,T=new Error;return S.start(u.metadata,{onReceiveMetadata(b){p.emit("metadata",b)},onReceiveMessage(b){p.push(b)},onReceiveStatus(b){if(!E){if(E=!0,p.push(null),b.code!==Or.Status.OK){let O=ms(T);p.emit("error",(0,Rn.callErrorFromStatus)(b,O))}T=null,p.emit("status",b)}}}),p}};Hl.Client=rf});var lf=A(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.loadPackageDefinition=gs.makeClientConstructor=void 0;var qo=sf(),SR={unary:qo.Client.prototype.makeUnaryRequest,server_stream:qo.Client.prototype.makeServerStreamRequest,client_stream:qo.Client.prototype.makeClientStreamRequest,bidi:qo.Client.prototype.makeBidiStreamRequest};function af(n){return["__proto__","prototype","constructor"].includes(n)}function t0(n,e,t){t||(t={});class r extends qo.Client{}return Object.keys(n).forEach(i=>{if(af(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=CR(SR[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!af(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}gs.makeClientConstructor=t0;function CR(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function bR(n){return"format"in n}function ER(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>af(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];bR(r)?o[s]=r:o[s]=t0(r,s,{})}return e}gs.loadPackageDefinition=ER});var I0=A((az,w0)=>{"use strict";var TR=1/0,wR="[object Symbol]",IR=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,AR=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yl="\\ud800-\\udfff",c0="\\u0300-\\u036f\\ufe20-\\ufe23",u0="\\u20d0-\\u20f0",d0="\\u2700-\\u27bf",h0="a-z\\xdf-\\xf6\\xf8-\\xff",DR="\\xac\\xb1\\xd7\\xf7",RR="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",kR="\\u2000-\\u206f",xR=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",f0="A-Z\\xc0-\\xd6\\xd8-\\xde",p0="\\ufe0e\\ufe0f",m0=DR+RR+kR+xR,uf="['\u2019]",NR="["+Yl+"]",n0="["+m0+"]",Ql="["+c0+u0+"]",g0="\\d+",OR="["+d0+"]",y0="["+h0+"]",v0="[^"+Yl+m0+g0+d0+h0+f0+"]",cf="\\ud83c[\\udffb-\\udfff]",MR="(?:"+Ql+"|"+cf+")",_0="[^"+Yl+"]",df="(?:\\ud83c[\\udde6-\\uddff]){2}",hf="[\\ud800-\\udbff][\\udc00-\\udfff]",ys="["+f0+"]",S0="\\u200d",r0="(?:"+y0+"|"+v0+")",PR="(?:"+ys+"|"+v0+")",i0="(?:"+uf+"(?:d|ll|m|re|s|t|ve))?",s0="(?:"+uf+"(?:D|LL|M|RE|S|T|VE))?",C0=MR+"?",b0="["+p0+"]?",FR="(?:"+S0+"(?:"+[_0,df,hf].join("|")+")"+b0+C0+")*",E0=b0+C0+FR,LR="(?:"+[OR,df,hf].join("|")+")"+E0,VR="(?:"+[_0+Ql+"?",Ql,df,hf,NR].join("|")+")",BR=RegExp(uf,"g"),UR=RegExp(Ql,"g"),qR=RegExp(cf+"(?="+cf+")|"+VR+E0,"g"),zR=RegExp([ys+"?"+y0+"+"+i0+"(?="+[n0,ys,"$"].join("|")+")",PR+"+"+s0+"(?="+[n0,ys+r0,"$"].join("|")+")",ys+"?"+r0+"+"+i0,ys+"+"+s0,g0,LR].join("|"),"g"),GR=RegExp("["+S0+Yl+c0+u0+p0+"]"),jR=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,$R={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},WR=typeof global=="object"&&global&&global.Object===Object&&global,KR=typeof self=="object"&&self&&self.Object===Object&&self,HR=WR||KR||Function("return this")();function QR(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function YR(n){return n.split("")}function JR(n){return n.match(IR)||[]}function XR(n){return function(e){return n?.[e]}}var ZR=XR($R);function T0(n){return GR.test(n)}function ek(n){return jR.test(n)}function tk(n){return T0(n)?nk(n):YR(n)}function nk(n){return n.match(qR)||[]}function rk(n){return n.match(zR)||[]}var ik=Object.prototype,sk=ik.toString,o0=HR.Symbol,a0=o0?o0.prototype:void 0,l0=a0?a0.toString:void 0;function ok(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function ak(n){if(typeof n=="string")return n;if(hk(n))return l0?l0.call(n):"";var e=n+"";return e=="0"&&1/n==-TR?"-0":e}function lk(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:ok(n,e,t)}function ck(n){return function(e){e=Jl(e);var t=T0(e)?tk(e):void 0,r=t?t[0]:e.charAt(0),i=t?lk(t,1).join(""):e.slice(1);return r[n]()+i}}function uk(n){return function(e){return QR(yk(mk(e).replace(BR,"")),n,"")}}function dk(n){return!!n&&typeof n=="object"}function hk(n){return typeof n=="symbol"||dk(n)&&sk.call(n)==wR}function Jl(n){return n==null?"":ak(n)}var fk=uk(function(n,e,t){return e=e.toLowerCase(),n+(t?pk(e):e)});function pk(n){return gk(Jl(n).toLowerCase())}function mk(n){return n=Jl(n),n&&n.replace(AR,ZR).replace(UR,"")}var gk=ck("toUpperCase");function yk(n,e,t){return n=Jl(n),e=t?void 0:e,e===void 0?ek(n)?rk(n):JR(n):n.match(e)||[]}w0.exports=fk});var ff=A((lz,A0)=>{"use strict";A0.exports=vk;function vk(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var p=new Array(arguments.length-1),m=0;m<p.length;)p[m++]=arguments[m];a.apply(null,p)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var x0=A(k0=>{"use strict";var Xl=k0;Xl.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var vs=new Array(64),R0=new Array(123);for(un=0;un<64;)R0[vs[un]=un<26?un+65:un<52?un+71:un<62?un-4:un-59|43]=un++;var un;Xl.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=vs[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=vs[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=vs[l|c>>6],s[o++]=vs[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=vs[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var D0="invalid encoding";Xl.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=R0[l])===void 0)throw Error(D0);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(D0);return r-i};Xl.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var O0=A((uz,N0)=>{"use strict";N0.exports=Zl;function Zl(){this._listeners={}}Zl.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Zl.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Zl.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var U0=A((dz,B0)=>{"use strict";B0.exports=M0(M0);function M0(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,P0),n.writeFloatBE=e.bind(null,F0);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,L0),n.readFloatBE=t.bind(null,V0)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var p=Math.floor(Math.log(o)/Math.LN2);p===1024&&(p=1023),u=o*Math.pow(2,-p),r(u*4503599627370496>>>0,a,l+i),r((c<<31|p+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,P0,0,4),n.writeDoubleBE=e.bind(null,F0,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,p=c>>>20&2047,m=4294967296*(c&1048575)+l;return p===2047?m?NaN:u*(1/0):p===0?u*5e-324*m:u*Math.pow(2,p-1075)*(m+4503599627370496)}n.readDoubleLE=t.bind(null,L0,0,4),n.readDoubleBE=t.bind(null,V0,4,0)}(),n}function P0(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function F0(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function L0(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function V0(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var pf=A((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var z0=A(q0=>{"use strict";var mf=q0;mf.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};mf.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};mf.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var j0=A((fz,G0)=>{"use strict";G0.exports=_k;function _k(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var W0=A((pz,$0)=>{"use strict";$0.exports=Je;var zo=kn();function Je(n,e){this.lo=n>>>0,this.hi=e>>>0}var yi=Je.zero=new Je(0,0);yi.toNumber=function(){return 0};yi.zzEncode=yi.zzDecode=function(){return this};yi.length=function(){return 1};var Sk=Je.zeroHash="\0\0\0\0\0\0\0\0";Je.fromNumber=function(e){if(e===0)return yi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Je(r,i)};Je.from=function(e){if(typeof e=="number")return Je.fromNumber(e);if(zo.isString(e))if(zo.Long)e=zo.Long.fromString(e);else return Je.fromNumber(parseInt(e,10));return e.low||e.high?new Je(e.low>>>0,e.high>>>0):yi};Je.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Je.prototype.toLong=function(e){return zo.Long?new zo.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Mr=String.prototype.charCodeAt;Je.fromHash=function(e){return e===Sk?yi:new Je((Mr.call(e,0)|Mr.call(e,1)<<8|Mr.call(e,2)<<16|Mr.call(e,3)<<24)>>>0,(Mr.call(e,4)|Mr.call(e,5)<<8|Mr.call(e,6)<<16|Mr.call(e,7)<<24)>>>0)};Je.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Je.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Je.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Je.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var kn=A(gf=>{"use strict";var $=gf;$.asPromise=ff();$.base64=x0();$.EventEmitter=O0();$.float=U0();$.inquire=pf();$.utf8=z0();$.pool=j0();$.LongBits=W0();$.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);$.global=$.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||gf;$.emptyArray=Object.freeze?Object.freeze([]):[];$.emptyObject=Object.freeze?Object.freeze({}):{};$.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};$.isString=function(e){return typeof e=="string"||e instanceof String};$.isObject=function(e){return e&&typeof e=="object"};$.isset=$.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};$.Buffer=function(){try{var n=$.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();$._Buffer_from=null;$._Buffer_allocUnsafe=null;$.newBuffer=function(e){return typeof e=="number"?$.Buffer?$._Buffer_allocUnsafe(e):new $.Array(e):$.Buffer?$._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};$.Array=typeof Uint8Array<"u"?Uint8Array:Array;$.Long=$.global.dcodeIO&&$.global.dcodeIO.Long||$.global.Long||$.inquire("long");$.key2Re=/^true|false|0|1$/;$.key32Re=/^-?(?:0|[1-9][0-9]*)$/;$.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;$.longToHash=function(e){return e?$.LongBits.from(e).toHash():$.LongBits.zeroHash};$.longFromHash=function(e,t){var r=$.LongBits.fromHash(e);return $.Long?$.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function K0(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}$.merge=K0;$.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function H0(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&K0(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}$.newError=H0;$.ProtocolError=H0("ProtocolError");$.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};$.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};$.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};$._configure=function(){var n=$.Buffer;if(!n){$._Buffer_from=$._Buffer_allocUnsafe=null;return}$._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},$._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var tc=A((gz,X0)=>{"use strict";X0.exports=le;var Qt=kn(),yf,ec=Qt.LongBits,Q0=Qt.base64,Y0=Qt.utf8;function Go(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function _f(){}function Ck(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function le(){this.len=0,this.head=new Go(_f,0,0),this.tail=this.head,this.states=null}var J0=function(){return Qt.Buffer?function(){return(le.create=function(){return new yf})()}:function(){return new le}};le.create=J0();le.alloc=function(e){return new Qt.Array(e)};Qt.Array!==Array&&(le.alloc=Qt.pool(le.alloc,Qt.Array.prototype.subarray));le.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Go(e,t,r),this.len+=t,this};function Sf(n,e,t){e[t]=n&255}function bk(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Cf(n,e){this.len=n,this.next=void 0,this.val=e}Cf.prototype=Object.create(Go.prototype);Cf.prototype.fn=bk;le.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Cf((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};le.prototype.int32=function(e){return e<0?this._push(bf,10,ec.fromNumber(e)):this.uint32(e)};le.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function bf(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}le.prototype.uint64=function(e){var t=ec.from(e);return this._push(bf,t.length(),t)};le.prototype.int64=le.prototype.uint64;le.prototype.sint64=function(e){var t=ec.from(e).zzEncode();return this._push(bf,t.length(),t)};le.prototype.bool=function(e){return this._push(Sf,1,e?1:0)};function vf(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}le.prototype.fixed32=function(e){return this._push(vf,4,e>>>0)};le.prototype.sfixed32=le.prototype.fixed32;le.prototype.fixed64=function(e){var t=ec.from(e);return this._push(vf,4,t.lo)._push(vf,4,t.hi)};le.prototype.sfixed64=le.prototype.fixed64;le.prototype.float=function(e){return this._push(Qt.float.writeFloatLE,4,e)};le.prototype.double=function(e){return this._push(Qt.float.writeDoubleLE,8,e)};var Ek=Qt.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};le.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Sf,1,0);if(Qt.isString(e)){var r=le.alloc(t=Q0.length(e));Q0.decode(e,r,0),e=r}return this.uint32(t)._push(Ek,t,e)};le.prototype.string=function(e){var t=Y0.length(e);return t?this.uint32(t)._push(Y0.write,t,e):this._push(Sf,1,0)};le.prototype.fork=function(){return this.states=new Ck(this),this.head=this.tail=new Go(_f,0,0),this.len=0,this};le.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Go(_f,0,0),this.len=0),this};le.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};le.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};le._configure=function(n){yf=n,le.create=J0(),yf._configure()}});var tS=A((yz,eS)=>{"use strict";eS.exports=xn;var Z0=tc();(xn.prototype=Object.create(Z0.prototype)).constructor=xn;var Pr=kn();function xn(){Z0.call(this)}xn._configure=function(){xn.alloc=Pr._Buffer_allocUnsafe,xn.writeBytesBuffer=Pr.Buffer&&Pr.Buffer.prototype instanceof Uint8Array&&Pr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};xn.prototype.bytes=function(e){Pr.isString(e)&&(e=Pr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(xn.writeBytesBuffer,t,e),this};function Tk(n,e,t){n.length<40?Pr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}xn.prototype.string=function(e){var t=Pr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Tk,t,e),this};xn._configure()});var rc=A((vz,oS)=>{"use strict";oS.exports=Ve;var dn=kn(),Tf,iS=dn.LongBits,wk=dn.utf8;function hn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Ve(n){this.buf=n,this.pos=0,this.len=n.length}var nS=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ve(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ve(e);throw Error("illegal buffer")},sS=function(){return dn.Buffer?function(t){return(Ve.create=function(i){return dn.Buffer.isBuffer(i)?new Tf(i):nS(i)})(t)}:nS};Ve.create=sS();Ve.prototype._slice=dn.Array.prototype.subarray||dn.Array.prototype.slice;Ve.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,hn(this,10);return e}}();Ve.prototype.int32=function(){return this.uint32()|0};Ve.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Ef(){var n=new iS(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw hn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw hn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Ve.prototype.bool=function(){return this.uint32()!==0};function nc(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Ve.prototype.fixed32=function(){if(this.pos+4>this.len)throw hn(this,4);return nc(this.buf,this.pos+=4)};Ve.prototype.sfixed32=function(){if(this.pos+4>this.len)throw hn(this,4);return nc(this.buf,this.pos+=4)|0};function rS(){if(this.pos+8>this.len)throw hn(this,8);return new iS(nc(this.buf,this.pos+=4),nc(this.buf,this.pos+=4))}Ve.prototype.float=function(){if(this.pos+4>this.len)throw hn(this,4);var e=dn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ve.prototype.double=function(){if(this.pos+8>this.len)throw hn(this,4);var e=dn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ve.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw hn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=dn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Ve.prototype.string=function(){var e=this.bytes();return wk.read(e,0,e.length)};Ve.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw hn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw hn(this);while(this.buf[this.pos++]&128);return this};Ve.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Ve._configure=function(n){Tf=n,Ve.create=sS(),Tf._configure();var e=dn.Long?"toLong":"toNumber";dn.merge(Ve.prototype,{int64:function(){return Ef.call(this)[e](!1)},uint64:function(){return Ef.call(this)[e](!0)},sint64:function(){return Ef.call(this).zzDecode()[e](!1)},fixed64:function(){return rS.call(this)[e](!0)},sfixed64:function(){return rS.call(this)[e](!1)}})}});var uS=A((_z,cS)=>{"use strict";cS.exports=vi;var lS=rc();(vi.prototype=Object.create(lS.prototype)).constructor=vi;var aS=kn();function vi(n){lS.call(this,n)}vi._configure=function(){aS.Buffer&&(vi.prototype._slice=aS.Buffer.prototype.slice)};vi.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};vi._configure()});var hS=A((Sz,dS)=>{"use strict";dS.exports=jo;var wf=kn();(jo.prototype=Object.create(wf.EventEmitter.prototype)).constructor=jo;function jo(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");wf.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}jo.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return wf.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};jo.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var If=A(fS=>{"use strict";var Ik=fS;Ik.Service=hS()});var Af=A((bz,pS)=>{"use strict";pS.exports={}});var yS=A(gS=>{"use strict";var Rt=gS;Rt.build="minimal";Rt.Writer=tc();Rt.BufferWriter=tS();Rt.Reader=rc();Rt.BufferReader=uS();Rt.util=kn();Rt.rpc=If();Rt.roots=Af();Rt.configure=mS;function mS(){Rt.util._configure(),Rt.Writer._configure(Rt.BufferWriter),Rt.Reader._configure(Rt.BufferReader)}mS()});var _S=A((Tz,vS)=>{"use strict";vS.exports=Df;function Df(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Df.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var p=new Array(arguments.length-1),m=0;m<p.length;)p[m]=arguments[++m];if(m=0,s=s.replace(/%([%dfijs])/g,function(E,T){var b=p[m++];switch(T){case"d":case"f":return String(Number(b));case"i":return String(Math.floor(b));case"j":return JSON.stringify(b);case"s":return String(b)}return"%"}),m!==p.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Df.verbose=!1});var CS=A((wz,SS)=>{"use strict";SS.exports=$o;var Ak=ff(),Dk=pf(),Rf=Dk("fs");function $o(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Rf&&Rf.readFile?Rf.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?$o.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):$o.xhr(n,e,t):Ak($o,this,n,e)}$o.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var TS=A(ES=>{"use strict";var xf=ES,bS=xf.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},kf=xf.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=bS(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};xf.resolve=function(e,t,r){return r||(t=kf(t)),bS(t)?t:(r||(e=kf(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?kf(e+"/"+t):t)}});var _i=A(wS=>{"use strict";var Wo=wS,Rk=Xe(),kk=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Ko(n,e){var t=0,r={};for(e|=0;t<n.length;)r[kk[t+e]]=n[t++];return r}Wo.basic=Ko([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Wo.defaults=Ko([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",Rk.emptyArray,null]);Wo.long=Ko([0,0,0,1,1],7);Wo.mapKey=Ko([0,0,0,5,5,0,0,0,1,1,0,2],2);Wo.packed=Ko([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Fr=A((Dz,DS)=>{"use strict";DS.exports=Yt;var ic=Si();((Yt.prototype=Object.create(ic.prototype)).constructor=Yt).className="Field";var IS=fn(),AS=_i(),$e=Xe(),Nf,xk=/^required|optional|repeated$/;Yt.fromJSON=function(e,t){return new Yt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Yt(n,e,t,r,i,s,o){if($e.isObject(r)?(o=i,s=r,r=i=void 0):$e.isObject(i)&&(o=s,s=i,i=void 0),ic.call(this,n,s),!$e.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!$e.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!xk.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!$e.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=$e.Long?AS.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Yt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Yt.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),ic.prototype.setOption.call(this,e,t,r)};Yt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return $e.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Yt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=AS.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Nf?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof IS&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof IS))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=$e.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;$e.base64.test(this.typeDefault)?$e.base64.decode(this.typeDefault,e=$e.newBuffer($e.base64.length(this.typeDefault)),0):$e.utf8.write(this.typeDefault,e=$e.newBuffer($e.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=$e.emptyObject:this.repeated?this.defaultValue=$e.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Nf&&(this.parent.ctor.prototype[this.name]=this.defaultValue),ic.prototype.resolve.call(this)};Yt.d=function(e,t,r,i){return typeof t=="function"?t=$e.decorateType(t).name:t&&typeof t=="object"&&(t=$e.decorateEnum(t).name),function(o,a){$e.decorateType(o.constructor).add(new Yt(a,e,t,r,{default:i}))}};Yt._configure=function(e){Nf=e}});var _s=A((Rz,xS)=>{"use strict";xS.exports=Jt;var oc=Si();((Jt.prototype=Object.create(oc.prototype)).constructor=Jt).className="OneOf";var RS=Fr(),sc=Xe();function Jt(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),oc.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Jt.fromJSON=function(e,t){return new Jt(e,t.oneof,t.options,t.comment)};Jt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return sc.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function kS(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Jt.prototype.add=function(e){if(!(e instanceof RS))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,kS(this),this};Jt.prototype.remove=function(e){if(!(e instanceof RS))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Jt.prototype.onAdd=function(e){oc.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}kS(this)};Jt.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);oc.prototype.onRemove.call(this,e)};Jt.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){sc.decorateType(i.constructor).add(new Jt(s,e)),Object.defineProperty(i,s,{get:sc.oneOfGetter(e),set:sc.oneOfSetter(e)})}}});var bs=A((kz,PS)=>{"use strict";PS.exports=ce;var Of=Si();((ce.prototype=Object.create(Of.prototype)).constructor=ce).className="Namespace";var NS=Fr(),ac=Xe(),Nk=_s(),Ss,Ho,Cs;ce.fromJSON=function(e,t){return new ce(e,t.options).addJSON(t.nested)};function OS(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}ce.arrayToJSON=OS;ce.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};ce.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function ce(n,e){Of.call(this,n,e),this.nested=void 0,this._nestedArray=null}function MS(n){return n._nestedArray=null,n}Object.defineProperty(ce.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=ac.toArray(this.nested))}});ce.prototype.toJSON=function(e){return ac.toObject(["options",this.options,"nested",OS(this.nestedArray,e)])};ce.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Ss.fromJSON:s.values!==void 0?Cs.fromJSON:s.methods!==void 0?Ho.fromJSON:s.id!==void 0?NS.fromJSON:ce.fromJSON)(r[i],s));return this};ce.prototype.get=function(e){return this.nested&&this.nested[e]||null};ce.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Cs)return this.nested[e].values;throw Error("no such enum: "+e)};ce.prototype.add=function(e){if(!(e instanceof NS&&e.extend!==void 0||e instanceof Ss||e instanceof Nk||e instanceof Cs||e instanceof Ho||e instanceof ce))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ce&&e instanceof ce&&!(t instanceof Ss||t instanceof Ho)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),MS(this)};ce.prototype.remove=function(e){if(!(e instanceof Of))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),MS(this)};ce.prototype.define=function(e,t){if(ac.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ce))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ce(i))}return t&&r.addJSON(t),r};ce.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ce?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ce.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),ac.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof ce&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ce&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};ce.prototype.lookupType=function(e){var t=this.lookup(e,[Ss]);if(!t)throw Error("no such type: "+e);return t};ce.prototype.lookupEnum=function(e){var t=this.lookup(e,[Cs]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ce.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Ss,Cs]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ce.prototype.lookupService=function(e){var t=this.lookup(e,[Ho]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ce._configure=function(n,e,t){Ss=n,Ho=e,Cs=t}});var lc=A((xz,FS)=>{"use strict";FS.exports=Zn;var Mf=Fr();((Zn.prototype=Object.create(Mf.prototype)).constructor=Zn).className="MapField";var Ok=_i(),Qo=Xe();function Zn(n,e,t,r,i,s){if(Mf.call(this,n,e,r,void 0,void 0,i,s),!Qo.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Zn.fromJSON=function(e,t){return new Zn(e,t.id,t.keyType,t.type,t.options,t.comment)};Zn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Qo.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Zn.prototype.resolve=function(){if(this.resolved)return this;if(Ok.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Mf.prototype.resolve.call(this)};Zn.d=function(e,t,r){return typeof r=="function"?r=Qo.decorateType(r).name:r&&typeof r=="object"&&(r=Qo.decorateEnum(r).name),function(s,o){Qo.decorateType(s.constructor).add(new Zn(o,e,t,r))}}});var cc=A((Nz,LS)=>{"use strict";LS.exports=Ci;var Pf=Si();((Ci.prototype=Object.create(Pf.prototype)).constructor=Ci).className="Method";var Es=Xe();function Ci(n,e,t,r,i,s,o,a,l){if(Es.isObject(i)?(o=i,i=s=void 0):Es.isObject(s)&&(o=s,s=void 0),!(e===void 0||Es.isString(e)))throw TypeError("type must be a string");if(!Es.isString(t))throw TypeError("requestType must be a string");if(!Es.isString(r))throw TypeError("responseType must be a string");Pf.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}Ci.fromJSON=function(e,t){return new Ci(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Ci.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Es.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Ci.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Pf.prototype.resolve.call(this))}});var uc=A((Oz,BS)=>{"use strict";BS.exports=Xt;var Lr=bs();((Xt.prototype=Object.create(Lr.prototype)).constructor=Xt).className="Service";var Ff=cc(),Yo=Xe(),Mk=If();function Xt(n,e){Lr.call(this,n,e),this.methods={},this._methodsArray=null}Xt.fromJSON=function(e,t){var r=new Xt(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Ff.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Xt.prototype.toJSON=function(e){var t=Lr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Yo.toObject(["options",t&&t.options||void 0,"methods",Lr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Xt.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Yo.toArray(this.methods))}});function VS(n){return n._methodsArray=null,n}Xt.prototype.get=function(e){return this.methods[e]||Lr.prototype.get.call(this,e)};Xt.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Lr.prototype.resolve.call(this)};Xt.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Ff?(this.methods[e.name]=e,e.parent=this,VS(this)):Lr.prototype.add.call(this,e)};Xt.prototype.remove=function(e){if(e instanceof Ff){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,VS(this)}return Lr.prototype.remove.call(this,e)};Xt.prototype.create=function(e,t,r){for(var i=new Mk.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=Yo.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=Yo.codegen(["r","c"],Yo.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var dc=A((Mz,US)=>{"use strict";US.exports=Nn;var Pk=kn();function Nn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Nn.create=function(e){return this.$type.create(e)};Nn.encode=function(e,t){return this.$type.encode(e,t)};Nn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Nn.decode=function(e){return this.$type.decode(e)};Nn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Nn.verify=function(e){return this.$type.verify(e)};Nn.fromObject=function(e){return this.$type.fromObject(e)};Nn.toObject=function(e,t){return this.$type.toObject(e,t)};Nn.prototype.toJSON=function(){return this.$type.toObject(this,Pk.toJSONOptions)}});var Lf=A((Pz,zS)=>{"use strict";zS.exports=Vk;var Fk=fn(),er=_i(),qS=Xe();function Lk(n){return"missing required '"+n.name+"'"}function Vk(n){var e=qS.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof Fk?"int32":r.type,s="m"+qS.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),er.defaults[r.keyType]!==void 0?e("k=%j",er.defaults[r.keyType]):e("k=null"),er.defaults[i]!==void 0?e("value=%j",er.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),er.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),er.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),er.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),er.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):er.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",Lk(o))}return e("return m")}});var Uf=A((Fz,GS)=>{"use strict";GS.exports=qk;var Bk=fn(),Vf=Xe();function Zt(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Bf(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof Bk){n("switch(%s){",r)("default:")("return%j",Zt(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",Zt(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Zt(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",Zt(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",Zt(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",Zt(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Zt(e,"buffer"));break}return n}function Uk(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",Zt(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",Zt(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",Zt(e,"boolean key"));break}return n}function qk(n){var e=Vf.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+Vf.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",Zt(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),Uk(e,s,"k[i]"),Bf(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Zt(s,"array"))("for(var i=0;i<%s.length;++i){",o),Bf(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=Vf.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}Bf(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Gf=A($S=>{"use strict";var jS=$S,Jo=fn(),On=Xe();function qf(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Jo){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}jS.fromObject=function(e){var t=e.fieldsArray,r=On.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=On.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),qf(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),qf(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Jo||r("if(d%s!=null){",o),qf(r,s,i,o),s.resolvedType instanceof Jo||r("}"))}return r("return m")};function zf(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Jo?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}jS.toObject=function(e){var t=e.fieldsArray.slice().sort(On.compareFieldsById);if(!t.length)return On.codegen()("return {}");for(var r=On.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",On.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",On.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=On.safeProp(l.name);if(l.resolvedType instanceof Jo)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var p=!1;for(a=0;a<t.length;++a){var l=t[a],m=e._fieldsArray.indexOf(l),c=On.safeProp(l.name);l.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),zf(r,l,m,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),zf(r,l,m,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),zf(r,l,m,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",On.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var jf=A(WS=>{"use strict";var zk=WS,Gk=dc();zk[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof Gk){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var pc=A((Bz,HS)=>{"use strict";HS.exports=be;var pn=bs();((be.prototype=Object.create(pn.prototype)).constructor=be).className="Type";var jk=fn(),Kf=_s(),hc=Fr(),$k=lc(),Wk=uc(),$f=dc(),Wf=rc(),Kk=tc(),dt=Xe(),Hk=Hf(),Qk=Lf(),Yk=Uf(),KS=Gf(),Jk=jf();function be(n,e){pn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(be.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=dt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=dt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=be.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof $f||((n.prototype=new $f).constructor=n,dt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,dt.merge(n,$f,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:dt.oneOfGetter(this._oneofsArray[t].oneof),set:dt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});be.generateConstructor=function(e){for(var t=dt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",dt.safeProp(i.name)):i.repeated&&t("this%s=[]",dt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function fc(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}be.fromJSON=function(e,t){var r=new be(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?$k.fromJSON:hc.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Kf.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?hc.fromJSON:o.fields!==void 0?be.fromJSON:o.values!==void 0?jk.fromJSON:o.methods!==void 0?Wk.fromJSON:pn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};be.prototype.toJSON=function(e){var t=pn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return dt.toObject(["options",t&&t.options||void 0,"oneofs",pn.arrayToJSON(this.oneofsArray,e),"fields",pn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};be.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return pn.prototype.resolveAll.call(this)};be.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};be.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof hc&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),fc(this)}return e instanceof Kf?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),fc(this)):pn.prototype.add.call(this,e)};be.prototype.remove=function(e){if(e instanceof hc&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),fc(this)}if(e instanceof Kf){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),fc(this)}return pn.prototype.remove.call(this,e)};be.prototype.isReservedId=function(e){return pn.isReservedId(this.reserved,e)};be.prototype.isReservedName=function(e){return pn.isReservedName(this.reserved,e)};be.prototype.create=function(e){return new this.ctor(e)};be.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=Hk(this)({Writer:Kk,types:t,util:dt}),this.decode=Qk(this)({Reader:Wf,types:t,util:dt}),this.verify=Yk(this)({types:t,util:dt}),this.fromObject=KS.fromObject(this)({types:t,util:dt}),this.toObject=KS.toObject(this)({types:t,util:dt});var i=Jk[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};be.prototype.encode=function(e,t){return this.setup().encode(e,t)};be.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};be.prototype.decode=function(e,t){return this.setup().decode(e,t)};be.prototype.decodeDelimited=function(e){return e instanceof Wf||(e=Wf.create(e)),this.decode(e,e.uint32())};be.prototype.verify=function(e){return this.setup().verify(e)};be.prototype.fromObject=function(e){return this.setup().fromObject(e)};be.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};be.d=function(e){return function(r){dt.decorateType(r,e)}}});var yc=A((Uz,ZS)=>{"use strict";ZS.exports=Lt;var gc=bs();((Lt.prototype=Object.create(gc.prototype)).constructor=Lt).className="Root";var Yf=Fr(),YS=fn(),Xk=_s(),Vr=Xe(),JS,Qf,Xo;function Lt(n){gc.call(this,"",n),this.deferred=[],this.files=[]}Lt.fromJSON=function(e,t){return t||(t=new Lt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Lt.prototype.resolvePath=Vr.path.resolve;Lt.prototype.fetch=Vr.fetch;function XS(){}Lt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Vr.asPromise(n,i,e,t);var s=r===XS;function o(S,E){if(r){if(s)throw S;var T=r;r=null,T(S,E)}}function a(S){var E=S.lastIndexOf("google/protobuf/");if(E>-1){var T=S.substring(E);if(T in Xo)return T}return null}function l(S,E){try{if(Vr.isString(E)&&E.charAt(0)==="{"&&(E=JSON.parse(E)),!Vr.isString(E))i.setOptions(E.options).addJSON(E.nested);else{Qf.filename=S;var T=Qf(E,i,t),b,O=0;if(T.imports)for(;O<T.imports.length;++O)(b=a(T.imports[O])||i.resolvePath(S,T.imports[O]))&&c(b);if(T.weakImports)for(O=0;O<T.weakImports.length;++O)(b=a(T.weakImports[O])||i.resolvePath(S,T.weakImports[O]))&&c(b,!0)}}catch(D){o(D)}!s&&!u&&o(null,i)}function c(S,E){if(S=a(S)||S,!(i.files.indexOf(S)>-1)){if(i.files.push(S),S in Xo){s?l(S,Xo[S]):(++u,setTimeout(function(){--u,l(S,Xo[S])}));return}if(s){var T;try{T=Vr.fs.readFileSync(S).toString("utf8")}catch(b){E||o(b);return}l(S,T)}else++u,i.fetch(S,function(b,O){if(--u,!!r){if(b){E?u||o(null,i):o(b);return}l(S,O)}})}}var u=0;Vr.isString(e)&&(e=[e]);for(var p=0,m;p<e.length;++p)(m=i.resolvePath("",e[p]))&&c(m);if(s)return i;u||o(null,i)};Lt.prototype.loadSync=function(e,t){if(!Vr.isNode)throw Error("not supported");return this.load(e,t,XS)};Lt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return gc.prototype.resolveAll.call(this)};var mc=/^[A-Z]/;function QS(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Yf(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Lt.prototype._handleAdd=function(e){if(e instanceof Yf)e.extend!==void 0&&!e.extensionField&&(QS(this,e)||this.deferred.push(e));else if(e instanceof YS)mc.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof Xk)){if(e instanceof JS)for(var t=0;t<this.deferred.length;)QS(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);mc.test(e.name)&&(e.parent[e.name]=e)}};Lt.prototype._handleRemove=function(e){if(e instanceof Yf){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof YS)mc.test(e.name)&&delete e.parent[e.name];else if(e instanceof gc){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);mc.test(e.name)&&delete e.parent[e.name]}};Lt._configure=function(n,e,t){JS=n,Qf=e,Xo=t}});var Xe=A((qz,tC)=>{"use strict";var Be=tC.exports=kn(),eC=Af(),Jf,Xf;Be.codegen=_S();Be.fetch=CS();Be.path=TS();Be.fs=Be.inquire("fs");Be.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Be.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var Zk=/\\/g,ex=/"/g;Be.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Be.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Be.isReserved(e)?'["'+e.replace(Zk,"\\\\").replace(ex,'\\"')+'"]':"."+e};Be.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var tx=/_([a-z])/g;Be.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(tx,function(t,r){return r.toUpperCase()})};Be.compareFieldsById=function(e,t){return e.id-t.id};Be.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Be.decorateRoot.remove(e.$type),e.$type.name=t,Be.decorateRoot.add(e.$type)),e.$type;Jf||(Jf=pc());var r=new Jf(t||e.name);return Be.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var nx=0;Be.decorateEnum=function(e){if(e.$type)return e.$type;Xf||(Xf=fn());var t=new Xf("Enum"+nx++,e);return Be.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Be.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Be,"decorateRoot",{get:function(){return eC.decorated||(eC.decorated=new(yc()))}})});var Si=A((zz,nC)=>{"use strict";nC.exports=Vt;Vt.className="ReflectionObject";var vc=Xe(),_c;function Vt(n,e){if(!vc.isString(n))throw TypeError("name must be a string");if(e&&!vc.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Vt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Vt.prototype.toJSON=function(){throw Error()};Vt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof _c&&t._handleAdd(this)};Vt.prototype.onRemove=function(e){var t=e.root;t instanceof _c&&t._handleRemove(this),this.parent=null,this.resolved=!1};Vt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof _c&&(this.resolved=!0),this)};Vt.prototype.getOption=function(e){if(this.options)return this.options[e]};Vt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Vt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];vc.setProperty(o,r,t)}else s={},s[e]=vc.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Vt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Vt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Vt._configure=function(n){_c=n}});var fn=A((Gz,sC)=>{"use strict";sC.exports=Mn;var rC=Si();((Mn.prototype=Object.create(rC.prototype)).constructor=Mn).className="Enum";var iC=bs(),Sc=Xe();function Mn(n,e,t,r,i,s){if(rC.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Mn.fromJSON=function(e,t){var r=new Mn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Mn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Sc.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Mn.prototype.add=function(e,t,r,i){if(!Sc.isString(e))throw TypeError("name must be a string");if(!Sc.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Mn.prototype.remove=function(e){if(!Sc.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Mn.prototype.isReservedId=function(e){return iC.isReservedId(this.reserved,e)};Mn.prototype.isReservedName=function(e){return iC.isReservedName(this.reserved,e)}});var Hf=A((jz,aC)=>{"use strict";aC.exports=ix;var rx=fn(),Zf=_i(),ep=Xe();function oC(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function ix(n){for(var e=ep.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(ep.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof rx?"int32":s.type,l=Zf.basic[a];r="m"+ep.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Zf.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Zf.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?oC(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?oC(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var cC=A(($z,lC)=>{"use strict";var oe=lC.exports=yS();oe.build="light";function sx(n,e,t){return typeof e=="function"?(t=e,e=new oe.Root):e||(e=new oe.Root),e.load(n,t)}oe.load=sx;function ox(n,e){return e||(e=new oe.Root),e.loadSync(n)}oe.loadSync=ox;oe.encoder=Hf();oe.decoder=Lf();oe.verifier=Uf();oe.converter=Gf();oe.ReflectionObject=Si();oe.Namespace=bs();oe.Root=yc();oe.Enum=fn();oe.Type=pc();oe.Field=Fr();oe.OneOf=_s();oe.MapField=lc();oe.Service=uc();oe.Method=cc();oe.Message=dc();oe.wrappers=jf();oe.types=_i();oe.util=Xe();oe.ReflectionObject._configure(oe.Root);oe.Namespace._configure(oe.Type,oe.Service,oe.Enum);oe.Root._configure(oe.Type);oe.Field._configure(oe.Type)});var np=A((Wz,hC)=>{"use strict";hC.exports=dC;var tp=/[\s{}=;:[\],'"()<>]/g,ax=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,lx=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,cx=/^ *[*/]+ */,ux=/^\s*\*?\/*/,dx=/\n/g,hx=/\s/,fx=/\\(.?)/g,px={0:"\0",r:"\r",n:`
`,t:"	"};function uC(n){return n.replace(fx,function(e,t){switch(t){case"\\":case"":return t;default:return px[t]||""}})}dC.unescape=uC;function dC(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(P){return Error("illegal "+P+" (line "+i+")")}function u(){var P=l==="'"?lx:ax;P.lastIndex=t-1;var j=P.exec(n);if(!j)throw c("string");return t=P.lastIndex,b(l),l=null,uC(j[1])}function p(P){return n.charAt(P)}function m(P,j,Q){var _={type:n.charAt(P++),lineEmpty:!1,leading:Q},g;e?g=2:g=3;var y=P-g,v;do if(--y<0||(v=n.charAt(y))===`
`){_.lineEmpty=!0;break}while(v===" "||v==="	");for(var h=n.substring(P,j).split(dx),C=0;C<h.length;++C)h[C]=h[C].replace(e?ux:cx,"").trim();_.text=h.join(`
`).trim(),o[i]=_,s=i}function S(P){var j=E(P),Q=n.substring(P,j),_=/^\s*\/\//.test(Q);return _}function E(P){for(var j=P;j<r&&p(j)!==`
`;)j++;return j}function T(){if(a.length>0)return a.shift();if(l)return u();var P,j,Q,_,g,y=t===0;do{if(t===r)return null;for(P=!1;hx.test(Q=p(t));)if(Q===`
`&&(y=!0,++i),++t===r)return null;if(p(t)==="/"){if(++t===r)throw c("comment");if(p(t)==="/")if(e){if(_=t,g=!1,S(t-1)){g=!0;do if(t=E(t),t===r||(t++,!y))break;while(S(t))}else t=Math.min(r,E(t)+1);g&&(m(_,t,y),y=!0),i++,P=!0}else{for(g=p(_=t+1)==="/";p(++t)!==`
`;)if(t===r)return null;++t,g&&(m(_,t-1,y),y=!0),++i,P=!0}else if((Q=p(t))==="*"){_=t+1,g=e||p(_)==="*";do{if(Q===`
`&&++i,++t===r)throw c("comment");j=Q,Q=p(t)}while(j!=="*"||Q!=="/");++t,g&&(m(_,t-2,y),y=!0),P=!0}else return"/"}}while(P);var v=t;tp.lastIndex=0;var h=tp.test(p(v++));if(!h)for(;v<r&&!tp.test(p(v));)++v;var C=n.substring(t,t=v);return(C==='"'||C==="'")&&(l=C),C}function b(P){a.push(P)}function O(){if(!a.length){var P=T();if(P===null)return null;b(P)}return a[0]}function D(P,j){var Q=O(),_=Q===P;if(_)return T(),!0;if(!j)throw c("token '"+Q+"', '"+P+"' expected");return!1}function M(P){var j=null,Q;return P===void 0?(Q=o[i-1],delete o[i-1],Q&&(e||Q.type==="*"||Q.lineEmpty)&&(j=Q.leading?Q.text:null)):(s<P&&O(),Q=o[P],delete o[P],Q&&!Q.lineEmpty&&(e||Q.type==="/")&&(j=Q.leading?null:Q.text)),j}return Object.defineProperty({next:T,peek:O,push:b,skip:D,cmnt:M},"line",{get:function(){return i}})}});var vC=A((Kz,yC)=>{"use strict";yC.exports=tr;tr.filename=null;tr.defaults={keepCase:!1};var mx=np(),fC=yc(),pC=pc(),mC=Fr(),gx=lc(),gC=_s(),yx=fn(),vx=uc(),_x=cc(),rp=_i(),ip=Xe(),Sx=/^[1-9][0-9]*$/,Cx=/^-?[1-9][0-9]*$/,bx=/^0[x][0-9a-fA-F]+$/,Ex=/^-?0[x][0-9a-fA-F]+$/,Tx=/^0[0-7]+$/,wx=/^-?0[0-7]+$/,Ix=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Pn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Fn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,Ax=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function tr(n,e,t){e instanceof fC||(t=e,e=new fC),t||(t=tr.defaults);var r=t.preferTrailingComment||!1,i=mx(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,p,m,S,E,T=!1,b=e,O=t.keepCase?function(k){return k}:ip.camelCase;function D(k,x,V){var K=tr.filename;return V||(tr.filename=null),Error("illegal "+(x||"token")+" '"+k+"' ("+(K?K+", ":"")+"line "+i.line+")")}function M(){var k=[],x;do{if((x=s())!=='"'&&x!=="'")throw D(x);k.push(s()),l(x),x=a()}while(x==='"'||x==="'");return k.join("")}function P(k){var x=s();switch(x){case"'":case'"':return o(x),M();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return Q(x,!0)}catch{if(k&&Fn.test(x))return x;throw D(x,"value")}}function j(k,x){var V,K;do x&&((V=a())==='"'||V==="'")?k.push(M()):k.push([K=_(s()),l("to",!0)?_(s()):K]);while(l(",",!0));var G={options:void 0};G.setOption=function(ne,De){this.options===void 0&&(this.options={}),this.options[ne]=De},C(G,function(De){if(De==="option")_e(G,De),l(";");else throw D(De)},function(){nt(G)})}function Q(k,x){var V=1;switch(k.charAt(0)==="-"&&(V=-1,k=k.substring(1)),k){case"inf":case"INF":case"Inf":return V*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(Sx.test(k))return V*parseInt(k,10);if(bx.test(k))return V*parseInt(k,16);if(Tx.test(k))return V*parseInt(k,8);if(Ix.test(k))return V*parseFloat(k);throw D(k,"number",x)}function _(k,x){switch(k){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!x&&k.charAt(0)==="-")throw D(k,"id");if(Cx.test(k))return parseInt(k,10);if(Ex.test(k))return parseInt(k,16);if(wx.test(k))return parseInt(k,8);throw D(k,"id")}function g(){if(p!==void 0)throw D("package");if(p=s(),!Fn.test(p))throw D(p,"name");b=b.define(p),l(";")}function y(){var k=a(),x;switch(k){case"weak":x=S||(S=[]),s();break;case"public":s();default:x=m||(m=[]);break}k=M(),l(";"),x.push(k)}function v(){if(l("="),E=M(),T=E==="proto3",!T&&E!=="proto2")throw D(E,"syntax");e.setOption("syntax",E),l(";")}function h(k,x){switch(x){case"option":return _e(k,x),l(";"),!0;case"message":return d(k,x),!0;case"enum":return ve(k,x),!0;case"service":return qe(k,x),!0;case"extend":return Ui(k,x),!0}return!1}function C(k,x,V){var K=i.line;if(k&&(typeof k.comment!="string"&&(k.comment=c()),k.filename=tr.filename),l("{",!0)){for(var G;(G=s())!=="}";)x(G);l(";",!0)}else V&&V(),l(";"),k&&(typeof k.comment!="string"||r)&&(k.comment=c(K)||k.comment)}function d(k,x){if(!Pn.test(x=s()))throw D(x,"type name");var V=new pC(x);C(V,function(G){if(!h(V,G))switch(G){case"map":ae(V,G);break;case"required":case"repeated":f(V,G);break;case"optional":T?f(V,"proto3_optional"):f(V,"optional");break;case"oneof":we(V,G);break;case"extensions":j(V.extensions||(V.extensions=[]));break;case"reserved":j(V.reserved||(V.reserved=[]),!0);break;default:if(!T||!Fn.test(G))throw D(G);o(G),f(V,"optional");break}}),k.add(V)}function f(k,x,V){var K=s();if(K==="group"){U(k,x);return}for(;K.endsWith(".")||a().startsWith(".");)K+=s();if(!Fn.test(K))throw D(K,"type");var G=s();if(!Pn.test(G))throw D(G,"name");G=O(G),l("=");var ne=new mC(G,_(s()),K,x,V);if(C(ne,function(Nt){if(Nt==="option")_e(ne,Nt),l(";");else throw D(Nt)},function(){nt(ne)}),x==="proto3_optional"){var De=new gC("_"+G);ne.setOption("proto3_optional",!0),De.add(ne),k.add(De)}else k.add(ne);!T&&ne.repeated&&(rp.packed[K]!==void 0||rp.basic[K]===void 0)&&ne.setOption("packed",!1,!0)}function U(k,x){var V=s();if(!Pn.test(V))throw D(V,"name");var K=ip.lcFirst(V);V===K&&(V=ip.ucFirst(V)),l("=");var G=_(s()),ne=new pC(V);ne.group=!0;var De=new mC(K,G,V,x);De.filename=tr.filename,C(ne,function(Nt){switch(Nt){case"option":_e(ne,Nt),l(";");break;case"required":case"repeated":f(ne,Nt);break;case"optional":T?f(ne,"proto3_optional"):f(ne,"optional");break;case"message":d(ne,Nt);break;case"enum":ve(ne,Nt);break;default:throw D(Nt)}}),k.add(ne).add(De)}function ae(k){l("<");var x=s();if(rp.mapKey[x]===void 0)throw D(x,"type");l(",");var V=s();if(!Fn.test(V))throw D(V,"type");l(">");var K=s();if(!Pn.test(K))throw D(K,"name");l("=");var G=new gx(O(K),_(s()),x,V);C(G,function(De){if(De==="option")_e(G,De),l(";");else throw D(De)},function(){nt(G)}),k.add(G)}function we(k,x){if(!Pn.test(x=s()))throw D(x,"name");var V=new gC(O(x));C(V,function(G){G==="option"?(_e(V,G),l(";")):(o(G),f(V,"optional"))}),k.add(V)}function ve(k,x){if(!Pn.test(x=s()))throw D(x,"name");var V=new yx(x);C(V,function(G){switch(G){case"option":_e(V,G),l(";");break;case"reserved":j(V.reserved||(V.reserved=[]),!0);break;default:Me(V,G)}}),k.add(V)}function Me(k,x){if(!Pn.test(x))throw D(x,"name");l("=");var V=_(s(),!0),K={options:void 0};K.setOption=function(G,ne){this.options===void 0&&(this.options={}),this.options[G]=ne},C(K,function(ne){if(ne==="option")_e(K,ne),l(";");else throw D(ne)},function(){nt(K)}),k.add(x,V,K.comment,K.options)}function _e(k,x){var V=l("(",!0);if(!Fn.test(x=s()))throw D(x,"name");var K=x,G=K,ne;V&&(l(")"),K="("+K+")",G=K,x=a(),Ax.test(x)&&(ne=x.slice(1),K+=x,s())),l("=");var De=gt(k,K);Re(k,G,De,ne)}function gt(k,x){if(l("{",!0)){for(var V={};!l("}",!0);){if(!Pn.test(st=s()))throw D(st,"name");if(st===null)throw D(st,"end of input");var K,G=st;if(l(":",!0),a()==="{")K=gt(k,x+"."+st);else if(a()==="["){K=[];var ne;if(l("[",!0)){do ne=P(!0),K.push(ne);while(l(",",!0));l("]"),typeof ne<"u"&&Ue(k,x+"."+st,ne)}}else K=P(!0),Ue(k,x+"."+st,K);var De=V[G];De&&(K=[].concat(De).concat(K)),V[G]=K,l(",",!0),l(";",!0)}return V}var hr=P(!0);return Ue(k,x,hr),hr}function Ue(k,x,V){k.setOption&&k.setOption(x,V)}function Re(k,x,V,K){k.setParsedOption&&k.setParsedOption(x,V,K)}function nt(k){if(l("[",!0)){do _e(k,"option");while(l(",",!0));l("]")}return k}function qe(k,x){if(!Pn.test(x=s()))throw D(x,"service name");var V=new vx(x);C(V,function(G){if(!h(V,G))if(G==="rpc")yt(V,G);else throw D(G)}),k.add(V)}function yt(k,x){var V=c(),K=x;if(!Pn.test(x=s()))throw D(x,"name");var G=x,ne,De,hr,Nt;if(l("("),l("stream",!0)&&(De=!0),!Fn.test(x=s())||(ne=x,l(")"),l("returns"),l("("),l("stream",!0)&&(Nt=!0),!Fn.test(x=s())))throw D(x);hr=x,l(")");var qa=new _x(G,K,ne,hr,De,Nt);qa.comment=V,C(qa,function(Ad){if(Ad==="option")_e(qa,Ad),l(";");else throw D(Ad)}),k.add(qa)}function Ui(k,x){if(!Fn.test(x=s()))throw D(x,"reference");var V=x;C(null,function(G){switch(G){case"required":case"repeated":f(k,G,V);break;case"optional":T?f(k,"proto3_optional",V):f(k,"optional",V);break;default:if(!T||!Fn.test(G))throw D(G);o(G),f(k,"optional",V);break}})}for(var st;(st=s())!==null;)switch(st){case"package":if(!u)throw D(st);g();break;case"import":if(!u)throw D(st);y();break;case"syntax":if(!u)throw D(st);v();break;case"option":_e(b,st),l(";");break;default:if(h(b,st)){u=!1;continue}throw D(st)}return tr.filename=null,{package:p,imports:m,weakImports:S,syntax:E,root:e}}});var CC=A((Hz,SC)=>{"use strict";SC.exports=mn;var Dx=/\/|\./;function mn(n,e){Dx.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),mn[n]=e}mn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var _C;mn("duration",{Duration:_C={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});mn("timestamp",{Timestamp:_C});mn("empty",{Empty:{fields:{}}});mn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});mn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});mn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});mn.get=function(e){return mn[e]||null}});var EC=A((Qz,bC)=>{"use strict";var Br=bC.exports=cC();Br.build="full";Br.tokenize=np();Br.parse=vC();Br.common=CC();Br.Root._configure(Br.Type,Br.parse,Br.common)});var Cc=A((Yz,TC)=>{"use strict";TC.exports=EC()});var sp=A((Jz,Rx)=>{Rx.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var RC=A((re,DC)=>{"use strict";var bt=Cc();DC.exports=re=bt.descriptor=bt.Root.fromJSON(sp()).lookup(".google.protobuf");var wC=bt.Namespace,Zo=bt.Root,nr=bt.Enum,Ur=bt.Type,qr=bt.Field,kx=bt.MapField,bc=bt.OneOf,ea=bt.Service,Ec=bt.Method;Zo.fromDescriptor=function(e){typeof e.length=="number"&&(e=re.FileDescriptorSet.decode(e));var t=new Zo;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(Ur.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(nr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(qr.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(ea.fromDescriptor(r.service[o]));var a=Ts(r.options,re.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Zo.prototype.toDescriptor=function(e){var t=re.FileDescriptorSet.create();return IC(this,t.file,e),t};function IC(n,e,t){var r=re.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Zo||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof Ur?r.messageType.push(s.toDescriptor(t)):s instanceof nr?r.enumType.push(s.toDescriptor()):s instanceof qr?r.extension.push(s.toDescriptor(t)):s instanceof ea?r.service.push(s.toDescriptor()):s instanceof wC&&IC(s,e,t);r.options=ws(n.options,re.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var xx=0;Ur.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=re.DescriptorProto.decode(e));var r=new Ur(e.name.length?e.name:"Type"+xx++,Ts(e.options,re.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(bc.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=qr.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(qr.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(Ur.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(nr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};Ur.prototype.toDescriptor=function(e){var t=re.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof kx){var s=op(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=op(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&AC(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(re.DescriptorProto.create({name:i.typeName,field:[re.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),re.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:re.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof qr?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Ur?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof nr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(re.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(re.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=ws(this.options,re.MessageOptions),t};var Nx=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;qr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=re.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=Lx(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new qr(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=Ts(e.options,re.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=Nx.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return Vx(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};qr.prototype.toDescriptor=function(e){var t=re.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=bt.util.ucFirst(this.name),t.label=3;else{switch(t.type=op(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?AC(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=ws(this.options,re.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=re.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=re.FieldOptions.create())).packed=!0),t};var Ox=0;nr.fromDescriptor=function(e){typeof e.length=="number"&&(e=re.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new nr(e.name&&e.name.length?e.name:"Enum"+Ox++,t,Ts(e.options,re.EnumOptions))};nr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(re.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return re.EnumDescriptorProto.create({name:this.name,value:e,options:ws(this.options,re.EnumOptions)})};var Mx=0;bc.fromDescriptor=function(e){return typeof e.length=="number"&&(e=re.OneofDescriptorProto.decode(e)),new bc(e.name&&e.name.length?e.name:"oneof"+Mx++)};bc.prototype.toDescriptor=function(){return re.OneofDescriptorProto.create({name:this.name})};var Px=0;ea.fromDescriptor=function(e){typeof e.length=="number"&&(e=re.ServiceDescriptorProto.decode(e));var t=new ea(e.name&&e.name.length?e.name:"Service"+Px++,Ts(e.options,re.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Ec.fromDescriptor(e.method[r]));return t};ea.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return re.ServiceDescriptorProto.create({name:this.name,method:e,options:ws(this.options,re.ServiceOptions)})};var Fx=0;Ec.fromDescriptor=function(e){return typeof e.length=="number"&&(e=re.MethodDescriptorProto.decode(e)),new Ec(e.name&&e.name.length?e.name:"Method"+Fx++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Ts(e.options,re.MethodOptions))};Ec.prototype.toDescriptor=function(){return re.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:ws(this.options,re.MethodOptions)})};function Lx(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function Vx(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function op(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof nr)return 14;if(e instanceof Ur)return e.group?10:11;throw Error("illegal type: "+n)}function Ts(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof nr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(Bx(s),o));return t.length?bt.util.toObject(t):void 0}}function ws(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=bt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(bt.util.toObject(t)):void 0}}function AC(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Zo)&&e instanceof wC)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function Bx(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var kC=A((Xz,Ux)=>{Ux.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var xC=A((Zz,qx)=>{qx.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var NC=A((e6,zx)=>{zx.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var FC=A(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.addCommonProtos=zr.loadProtosWithOptionsSync=zr.loadProtosWithOptions=void 0;var OC=fe("fs"),MC=fe("path"),Is=Cc();function PC(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(MC.isAbsolute(i))return i;for(let s of e){let o=MC.join(s,i);try{return OC.accessSync(o,OC.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function Gx(n,e){return R(this,null,function*(){let t=new Is.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));PC(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}zr.loadProtosWithOptions=Gx;function jx(n,e){let t=new Is.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");PC(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}zr.loadProtosWithOptionsSync=jx;function $x(){let n=kC(),e=sp(),t=xC(),r=NC();Is.common("api",n.nested.google.nested.protobuf.nested),Is.common("descriptor",e.nested.google.nested.protobuf.nested),Is.common("source_context",t.nested.google.nested.protobuf.nested),Is.common("type",r.nested.google.nested.protobuf.nested)}zr.addCommonProtos=$x});var BC=A((VC,ap)=>{"use strict";var LC=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(d,f,U){this.low=d|0,this.high=f|0,this.unsigned=!!U}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(d){return(d&&d.__isLong__)===!0}function i(d){var f=Math.clz32(d&-d);return d?31-f:f}t.isLong=r;var s={},o={};function a(d,f){var U,ae,we;return f?(d>>>=0,(we=0<=d&&d<256)&&(ae=o[d],ae)?ae:(U=c(d,0,!0),we&&(o[d]=U),U)):(d|=0,(we=-128<=d&&d<128)&&(ae=s[d],ae)?ae:(U=c(d,d<0?-1:0,!1),we&&(s[d]=U),U))}t.fromInt=a;function l(d,f){if(isNaN(d))return f?P:M;if(f){if(d<0)return P;if(d>=b)return y}else{if(d<=-O)return v;if(d+1>=O)return g}return d<0?l(-d,f).neg():c(d%T|0,d/T|0,f)}t.fromNumber=l;function c(d,f,U){return new t(d,f,U)}t.fromBits=c;var u=Math.pow;function p(d,f,U){if(d.length===0)throw Error("empty string");if(typeof f=="number"?(U=f,f=!1):f=!!f,d==="NaN"||d==="Infinity"||d==="+Infinity"||d==="-Infinity")return f?P:M;if(U=U||10,U<2||36<U)throw RangeError("radix");var ae;if((ae=d.indexOf("-"))>0)throw Error("interior hyphen");if(ae===0)return p(d.substring(1),f,U).neg();for(var we=l(u(U,8)),ve=M,Me=0;Me<d.length;Me+=8){var _e=Math.min(8,d.length-Me),gt=parseInt(d.substring(Me,Me+_e),U);if(_e<8){var Ue=l(u(U,_e));ve=ve.mul(Ue).add(l(gt))}else ve=ve.mul(we),ve=ve.add(l(gt))}return ve.unsigned=f,ve}t.fromString=p;function m(d,f){return typeof d=="number"?l(d,f):typeof d=="string"?p(d,f):c(d.low,d.high,typeof f=="boolean"?f:d.unsigned)}t.fromValue=m;var S=65536,E=1<<24,T=S*S,b=T*T,O=b/2,D=a(E),M=a(0);t.ZERO=M;var P=a(0,!0);t.UZERO=P;var j=a(1);t.ONE=j;var Q=a(1,!0);t.UONE=Q;var _=a(-1);t.NEG_ONE=_;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var v=c(0,-2147483648,!1);t.MIN_VALUE=v;var h=t.prototype;h.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},h.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(v)){var U=l(f),ae=this.div(U),we=ae.mul(U).sub(this);return ae.toString(f)+we.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var ve=l(u(f,6),this.unsigned),Me=this,_e="";;){var gt=Me.div(ve),Ue=Me.sub(gt.mul(ve)).toInt()>>>0,Re=Ue.toString(f);if(Me=gt,Me.isZero())return Re+_e;for(;Re.length<6;)Re="0"+Re;_e=""+Re+_e}},h.getHighBits=function(){return this.high},h.getHighBitsUnsigned=function(){return this.high>>>0},h.getLowBits=function(){return this.low},h.getLowBitsUnsigned=function(){return this.low>>>0},h.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,U=31;U>0&&!(f&1<<U);U--);return this.high!=0?U+33:U+1},h.isZero=function(){return this.high===0&&this.low===0},h.eqz=h.isZero,h.isNegative=function(){return!this.unsigned&&this.high<0},h.isPositive=function(){return this.unsigned||this.high>=0},h.isOdd=function(){return(this.low&1)===1},h.isEven=function(){return(this.low&1)===0},h.equals=function(f){return r(f)||(f=m(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},h.eq=h.equals,h.notEquals=function(f){return!this.eq(f)},h.neq=h.notEquals,h.ne=h.notEquals,h.lessThan=function(f){return this.comp(f)<0},h.lt=h.lessThan,h.lessThanOrEqual=function(f){return this.comp(f)<=0},h.lte=h.lessThanOrEqual,h.le=h.lessThanOrEqual,h.greaterThan=function(f){return this.comp(f)>0},h.gt=h.greaterThan,h.greaterThanOrEqual=function(f){return this.comp(f)>=0},h.gte=h.greaterThanOrEqual,h.ge=h.greaterThanOrEqual,h.compare=function(f){if(r(f)||(f=m(f)),this.eq(f))return 0;var U=this.isNegative(),ae=f.isNegative();return U&&!ae?-1:!U&&ae?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},h.comp=h.compare,h.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(j)},h.neg=h.negate,h.add=function(f){r(f)||(f=m(f));var U=this.high>>>16,ae=this.high&65535,we=this.low>>>16,ve=this.low&65535,Me=f.high>>>16,_e=f.high&65535,gt=f.low>>>16,Ue=f.low&65535,Re=0,nt=0,qe=0,yt=0;return yt+=ve+Ue,qe+=yt>>>16,yt&=65535,qe+=we+gt,nt+=qe>>>16,qe&=65535,nt+=ae+_e,Re+=nt>>>16,nt&=65535,Re+=U+Me,Re&=65535,c(qe<<16|yt,Re<<16|nt,this.unsigned)},h.subtract=function(f){return r(f)||(f=m(f)),this.add(f.neg())},h.sub=h.subtract,h.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=m(f)),e){var U=e.mul(this.low,this.high,f.low,f.high);return c(U,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?P:M;if(this.eq(v))return f.isOdd()?v:M;if(f.eq(v))return this.isOdd()?v:M;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(D)&&f.lt(D))return l(this.toNumber()*f.toNumber(),this.unsigned);var ae=this.high>>>16,we=this.high&65535,ve=this.low>>>16,Me=this.low&65535,_e=f.high>>>16,gt=f.high&65535,Ue=f.low>>>16,Re=f.low&65535,nt=0,qe=0,yt=0,Ui=0;return Ui+=Me*Re,yt+=Ui>>>16,Ui&=65535,yt+=ve*Re,qe+=yt>>>16,yt&=65535,yt+=Me*Ue,qe+=yt>>>16,yt&=65535,qe+=we*Re,nt+=qe>>>16,qe&=65535,qe+=ve*Ue,nt+=qe>>>16,qe&=65535,qe+=Me*gt,nt+=qe>>>16,qe&=65535,nt+=ae*Re+we*Ue+ve*gt+Me*_e,nt&=65535,c(yt<<16|Ui,nt<<16|qe,this.unsigned)},h.mul=h.multiply,h.divide=function(f){if(r(f)||(f=m(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var U=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(U,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?P:M;var ae,we,ve;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return P;if(f.gt(this.shru(1)))return Q;ve=P}else{if(this.eq(v)){if(f.eq(j)||f.eq(_))return v;if(f.eq(v))return j;var Me=this.shr(1);return ae=Me.div(f).shl(1),ae.eq(M)?f.isNegative()?j:_:(we=this.sub(f.mul(ae)),ve=ae.add(we.div(f)),ve)}else if(f.eq(v))return this.unsigned?P:M;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();ve=M}for(we=this;we.gte(f);){ae=Math.max(1,Math.floor(we.toNumber()/f.toNumber()));for(var _e=Math.ceil(Math.log(ae)/Math.LN2),gt=_e<=48?1:u(2,_e-48),Ue=l(ae),Re=Ue.mul(f);Re.isNegative()||Re.gt(we);)ae-=gt,Ue=l(ae,this.unsigned),Re=Ue.mul(f);Ue.isZero()&&(Ue=j),ve=ve.add(Ue),we=we.sub(Re)}return ve},h.div=h.divide,h.modulo=function(f){if(r(f)||(f=m(f)),e){var U=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(U,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},h.mod=h.modulo,h.rem=h.modulo,h.not=function(){return c(~this.low,~this.high,this.unsigned)},h.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},h.clz=h.countLeadingZeros,h.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},h.ctz=h.countTrailingZeros,h.and=function(f){return r(f)||(f=m(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},h.or=function(f){return r(f)||(f=m(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},h.xor=function(f){return r(f)||(f=m(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},h.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},h.shl=h.shiftLeft,h.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},h.shr=h.shiftRight,h.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},h.shru=h.shiftRightUnsigned,h.shr_u=h.shiftRightUnsigned,h.rotateLeft=function(f){var U;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(U=32-f,c(this.low<<f|this.high>>>U,this.high<<f|this.low>>>U,this.unsigned)):(f-=32,U=32-f,c(this.high<<f|this.low>>>U,this.low<<f|this.high>>>U,this.unsigned))},h.rotl=h.rotateLeft,h.rotateRight=function(f){var U;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(U=32-f,c(this.high<<U|this.low>>>f,this.low<<U|this.high>>>f,this.unsigned)):(f-=32,U=32-f,c(this.low<<U|this.high>>>f,this.high<<U|this.low>>>f,this.unsigned))},h.rotr=h.rotateRight,h.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},h.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},h.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},h.toBytesLE=function(){var f=this.high,U=this.low;return[U&255,U>>>8&255,U>>>16&255,U>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},h.toBytesBE=function(){var f=this.high,U=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,U>>>24,U>>>16&255,U>>>8&255,U&255]},t.fromBytes=function(f,U,ae){return ae?t.fromBytesLE(f,U):t.fromBytesBE(f,U)},t.fromBytesLE=function(f,U){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,U)},t.fromBytesBE=function(f,U){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],U)};var C=t;return n.default=C,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return LC}):typeof ap=="object"&&typeof VC=="object"&&(ap.exports=LC)});var dp=A(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.loadFileDescriptorSetFromObject=He.loadFileDescriptorSetFromBuffer=He.fromJSON=He.loadSync=He.load=He.IdempotencyLevel=He.isAnyExtension=He.Long=void 0;var Wx=I0(),Ln=Cc(),cp=RC(),up=FC(),Kx=BC();He.Long=Kx;function Hx(n){return"@type"in n&&typeof n["@type"]=="string"}He.isAnyExtension=Hx;var zC;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(zC=He.IdempotencyLevel||(He.IdempotencyLevel={}));var GC={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function Qx(n,e){return n===""?e:n+"."+e}function Yx(n){return n instanceof Ln.Service||n instanceof Ln.Type||n instanceof Ln.Enum}function Jx(n){return n instanceof Ln.Namespace||n instanceof Ln.Root}function jC(n,e){let t=Qx(e,n.name);return Yx(n)?[[t,n]]:Jx(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>jC(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function UC(n,e){return function(r){return n.toObject(n.decode(r),e)}}function qC(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function Xx(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:zC.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function Zx(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:qC(i),requestDeserialize:UC(i,t),responseSerialize:qC(s),responseDeserialize:UC(s,t),originalName:Wx(n.name),requestType:lp(i,r),responseType:lp(s,r),options:Xx(n.parsedOptions)}}function eN(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=Zx(s,e,t,r);return i}function lp(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,GC),fileDescriptorProtos:e}}function tN(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,GC),fileDescriptorProtos:e}}function nN(n,e,t,r){if(n instanceof Ln.Service)return eN(n,e,t,r);if(n instanceof Ln.Type)return lp(n,r);if(n instanceof Ln.Enum)return tN(n,r);throw new Error("Type mismatch in reflection object handling")}function Tc(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(cp.FileDescriptorProto.encode(s).finish()));for(let[s,o]of jC(n,""))t[s]=nN(o,s,e,i);return t}function $C(n,e){e=e||{};let t=Ln.Root.fromDescriptor(n);return t.resolveAll(),Tc(t,e)}function rN(n,e){return(0,up.loadProtosWithOptions)(n,e).then(t=>Tc(t,e))}He.load=rN;function iN(n,e){let t=(0,up.loadProtosWithOptionsSync)(n,e);return Tc(t,e)}He.loadSync=iN;function sN(n,e){e=e||{};let t=Ln.Root.fromJSON(n);return t.resolveAll(),Tc(t,e)}He.fromJSON=sN;function oN(n,e){let t=cp.FileDescriptorSet.decode(n);return $C(t,e)}He.loadFileDescriptorSetFromBuffer=oN;function aN(n,e){let t=cp.FileDescriptorSet.fromObject(n);return $C(t,e)}He.loadFileDescriptorSetFromObject=aN;(0,up.addCommonProtos)()});var bi=A(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.setup=Ie.getChannelzServiceDefinition=Ie.getChannelzHandlers=Ie.unregisterChannelzRef=Ie.registerChannelzSocket=Ie.registerChannelzServer=Ie.registerChannelzSubchannel=Ie.registerChannelzChannel=Ie.ChannelzCallTracker=Ie.ChannelzChildrenTracker=Ie.ChannelzTrace=void 0;var WC=fe("net"),ta=$t(),ra=de(),lN=Dn(),cN=$l(),uN=lf();function hp(n){return{channel_id:n.id,name:n.name}}function gp(n){return{subchannel_id:n.id,name:n.name}}function dN(n){return{server_id:n.id}}function Ic(n){return{socket_id:n.id,name:n.name}}var KC=32,fp=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=KC*2&&(this.events=this.events.slice(KC)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:rr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:rr(e.timestamp),channel_ref:e.childChannel?hp(e.childChannel):null,subchannel_ref:e.childSubchannel?gp(e.childSubchannel):null}))}}};Ie.ChannelzTrace=fp;var pp=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ie.ChannelzChildrenTracker=pp;var mp=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ie.ChannelzCallTracker=mp;var hN=1;function Ac(){return hN++}var na=[],yp=[],Gr=[],vp=[];function fN(n,e,t){let r=Ac(),i={id:r,name:n,kind:"channel"};return t&&(na[r]={ref:i,getInfo:e}),i}Ie.registerChannelzChannel=fN;function pN(n,e,t){let r=Ac(),i={id:r,name:n,kind:"subchannel"};return t&&(yp[r]={ref:i,getInfo:e}),i}Ie.registerChannelzSubchannel=pN;function mN(n,e){let t=Ac(),r={id:t,kind:"server"};return e&&(Gr[t]={ref:r,getInfo:n}),r}Ie.registerChannelzServer=mN;function gN(n,e,t){let r=Ac(),i={id:r,name:n,kind:"socket"};return t&&(vp[r]={ref:i,getInfo:e}),i}Ie.registerChannelzSocket=gN;function yN(n){switch(n.kind){case"channel":delete na[n.id];return;case"subchannel":delete yp[n.id];return;case"server":delete Gr[n.id];return;case"socket":delete vp[n.id];return}}Ie.unregisterChannelzRef=yN;function vN(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function HC(n){if(n==="")return[];let e=n.split(":").map(r=>vN(r));return[].concat(...e)}function _N(n){if((0,WC.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,WC.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(HC(e)),s=Buffer.from(HC(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function YC(n){switch(n){case ta.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case ta.ConnectivityState.IDLE:return{state:"IDLE"};case ta.ConnectivityState.READY:return{state:"READY"};case ta.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case ta.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function rr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function JC(n){let e=n.getInfo();return{ref:hp(n.ref),data:{target:e.target,state:YC(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:rr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>hp(t)),subchannel_ref:e.children.subchannels.map(t=>gp(t))}}function SN(n,e){let t=Number.parseInt(n.request.channel_id),r=na[t];if(r===void 0){e({code:ra.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:JC(r)})}function CN(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<na.length;i++){let s=na[i];if(s!==void 0&&(r.push(JC(s)),r.length>=t))break}e(null,{channel:r,end:i>=Gr.length})}function XC(n){let e=n.getInfo();return{ref:dN(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:rr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Ic(t))}}function bN(n,e){let t=Number.parseInt(n.request.server_id),r=Gr[t];if(r===void 0){e({code:ra.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:XC(r)})}function EN(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<Gr.length;i++){let s=Gr[i];if(s!==void 0&&(r.push(XC(s)),r.length>=t))break}e(null,{server:r,end:i>=Gr.length})}function TN(n,e){let t=Number.parseInt(n.request.subchannel_id),r=yp[t];if(r===void 0){e({code:ra.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:gp(r.ref),data:{target:i.target,state:YC(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:rr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Ic(o))};e(null,{subchannel:s})}function QC(n){var e;return(0,lN.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=_N(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function wN(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=vp[a];if(l===void 0){e({code:ra.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,p={ref:Ic(l.ref),local:c.localAddress?QC(c.localAddress):null,remote:c.remoteAddress?QC(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:rr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:rr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:rr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:rr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:p})}function IN(n,e){let t=Number.parseInt(n.request.server_id),r=Gr[t];if(r===void 0){e({code:ra.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,p)=>u.id-p.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Ic(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function ZC(){return{GetChannel:SN,GetTopChannels:CN,GetServer:bN,GetServers:EN,GetSubchannel:TN,GetSocket:wN,GetServerSockets:IN}}Ie.getChannelzHandlers=ZC;var wc=null;function eb(){if(wc)return wc;let n=dp().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return wc=(0,uN.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,wc}Ie.getChannelzServiceDefinition=eb;function AN(){(0,cN.registerAdminService)(eb,ZC)}Ie.setup=AN});var tb=A(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.Subchannel=void 0;var Ee=$t(),DN=Fo(),_p=xe(),Dc=de(),RN=Ft(),kN=Dn(),As=bi(),xN="subchannel",NN=~(1<<31),Sp=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Ee.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new As.ChannelzCallTracker,this.childrenTracker=new As.ChannelzChildrenTracker,this.streamTracker=new As.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new DN.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,kN.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new As.ChannelzTrace,this.channelzRef=(0,As.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){_p.trace(Dc.LogVerbosity.DEBUG,xN,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){_p.trace(Dc.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Ee.ConnectivityState.TRANSIENT_FAILURE],Ee.ConnectivityState.CONNECTING):this.transitionToState([Ee.ConnectivityState.TRANSIENT_FAILURE],Ee.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,NN);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Ee.ConnectivityState.CONNECTING],Ee.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Ee.ConnectivityState.READY],Ee.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,_p.log(Dc.LogVerbosity.ERROR,`Connection to ${(0,RN.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Ee.ConnectivityState.CONNECTING],Ee.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Ee.ConnectivityState[this.connectivityState]+" -> "+Ee.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Ee.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Ee.ConnectivityState.READY:this.stopBackoff();break;case Ee.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Ee.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Ee.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,As.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Ee.ConnectivityState.CONNECTING,Ee.ConnectivityState.READY],Ee.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Dc.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Ee.ConnectivityState.IDLE],Ee.ConnectivityState.CONNECTING)||this.connectivityState===Ee.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Ee.ConnectivityState.TRANSIENT_FAILURE],Ee.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Rc.Subchannel=Sp});var Tp=A(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.setup=Wr.DEFAULT_PORT=void 0;var nb=In(),ib=fe("dns"),sb=fe("util"),ON=Mh(),Cp=de(),bp=At(),MN=xe(),PN=de(),jr=Ft(),rb=fe("net"),FN=Fo(),LN="dns_resolver";function $r(n){MN.trace(PN.LogVerbosity.DEBUG,LN,n)}Wr.DEFAULT_PORT=443;var VN=3e4,BN=sb.promisify(ib.resolveTxt),UN=sb.promisify(ib.lookup);function qN(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Ep=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,$r("Resolver constructed for target "+(0,jr.uriToString)(e));let a=(0,jr.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,rb.isIPv4)(a.host)||(0,rb.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:Wr.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:Wr.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Cp.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,jr.uriToString)(this.target)}`,metadata:new bp.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new FN.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:VN,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||($r("Returning IP address for target "+(0,jr.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)$r("Failed to parse DNS address "+(0,jr.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Cp.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,jr.uriToString)(this.target)}`,metadata:new bp.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;$r("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=UN(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=qN(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if($r("Resolved addresses for target "+(0,jr.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&($r("Resolution error for target "+(0,jr.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=BN(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,ON.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Cp.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new bp.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?$r('resolution update delayed by "min time between resolutions" rate limit'):$r("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function zN(){(0,nb.registerResolver)("dns",Ep),(0,nb.registerDefaultScheme)("dns")}Wr.setup=zN});var wp=A(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.getProxiedConnection=ks.mapProxyName=void 0;var ia=xe(),Ds=de(),GN=In(),jN=fe("http"),$N=fe("tls"),WN=xe(),ob=Dn(),Rs=Ft(),KN=fe("url"),HN=Tp(),QN="proxy";function Kr(n){WN.trace(Ds.LogVerbosity.DEBUG,QN,n)}function YN(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new KN.URL(n)}catch{return(0,ia.log)(Ds.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,ia.log)(Ds.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,ia.log)(Ds.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),Kr("Proxy server "+o.address+" set by environment variable "+e),o}function JN(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(Kr("No proxy server list set by environment variable "+e),n.split(",")):[]}function XN(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=YN();if(!i.address)return r;let s=(0,Rs.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of JN())if(l===o)return Kr("Not using proxy for target in no_proxy list: "+(0,Rs.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,Rs.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}ks.mapProxyName=XN;function ZN(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,Rs.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,Rs.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:HN.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,ob.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,ob.subchannelAddressToString)(n);return Kr("Using proxy "+u+" to connect to "+l.path),new Promise((p,m)=>{let S=jN.request(l);S.once("connect",(E,T,b)=>{var O;if(S.removeAllListeners(),T.removeAllListeners(),E.statusCode===200)if(Kr("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let D=(0,GN.getDefaultAuthority)(s),M=(0,Rs.splitHostPort)(D),P=(O=M?.host)!==null&&O!==void 0?O:D,j=$N.connect(Object.assign({host:P,servername:P,socket:T},t),()=>{Kr("Successfully established a TLS connection to "+l.path+" through proxy "+u),p({socket:j,realTarget:s})});j.on("error",Q=>{Kr("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+Q.message),m()})}else Kr("Successfully established a plaintext connection to "+l.path+" through proxy "+u),p({socket:T,realTarget:s});else(0,ia.log)(Ds.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+E.statusCode),m()}),S.once("error",E=>{S.removeAllListeners(),(0,ia.log)(Ds.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+E.message),m()}),S.end()})}ks.getProxiedConnection=ZN});var Ap=A(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.StreamDecoder=void 0;var ir=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(ir||{}),Ip=class{constructor(e){this.maxReadMessageLength=e,this.readState=ir.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case ir.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=ir.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case ir.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=ir.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=ir.NO_DATA,i.push(s)}}break;case ir.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=ir.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};kc.StreamDecoder=Ip});var ab=A(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.Http2SubchannelCall=void 0;var sr=fe("http2"),eO=fe("os"),ge=de(),Hr=At(),tO=Ap(),nO=xe(),rO=de(),iO="subchannel_call";function sO(n){for(let[e,t]of Object.entries(eO.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Dp=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ge.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:ge.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new tO.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let p of Object.keys(l))u+="		"+p+": "+l[p]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=ge.Status.INTERNAL;break;case 401:this.mappedStatusCode=ge.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ge.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ge.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ge.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ge.Status.UNKNOWN}if(c&sr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let p;try{p=Hr.Metadata.fromHttp2Headers(l)}catch(m){this.endCall({code:ge.Status.UNKNOWN,details:m.message,metadata:new Hr.Metadata});return}this.listener.onReceiveMetadata(p)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(ge.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===ge.Status.OK)return;let c,u="";switch(e.rstCode){case sr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=ge.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case sr.constants.NGHTTP2_REFUSED_STREAM:c=ge.Status.UNAVAILABLE,u="Stream refused by server";break;case sr.constants.NGHTTP2_CANCEL:c=ge.Status.CANCELLED,u="Call cancelled";break;case sr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=ge.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case sr.constants.NGHTTP2_INADEQUATE_SECURITY:c=ge.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case sr.constants.NGHTTP2_INTERNAL_ERROR:c=ge.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=ge.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=ge.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new Hr.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+sO(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ge.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Hr.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){nO.trace(rO.LogVerbosity.DEBUG,iO,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ge.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ge.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Hr.Metadata.fromHttp2Headers(e)}catch{r=new Hr.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===ge.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in ge.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ge.Status.OK?t=sr.constants.NGHTTP2_NO_ERROR:t=sr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Hr.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ge.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=ge.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=ge.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:ge.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Hr.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};xc.Http2SubchannelCall=Dp});var Rp=A(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.getNextCallNumber=void 0;var oO=0;function aO(){return oO++}Nc.getNextCallNumber=aO});var ub=A(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.Http2SubchannelConnector=void 0;var Mp=fe("http2"),lb=fe("tls"),kp=bi(),sa=de(),lO=wp(),Ns=xe(),cb=In(),Oc=Dn(),xs=Ft(),cO=fe("net"),uO=ab(),dO=Rp(),xp="transport",hO="transport_flowctrl",fO=gh().version,{HTTP2_HEADER_AUTHORITY:pO,HTTP2_HEADER_CONTENT_TYPE:mO,HTTP2_HEADER_METHOD:gO,HTTP2_HEADER_PATH:yO,HTTP2_HEADER_TE:vO,HTTP2_HEADER_USER_AGENT:_O}=Mp.constants,SO=2e4,CO=Buffer.from("too_many_pings","ascii"),Np=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=SO,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new kp.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Oc.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,kp.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${fO}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Mp.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(CO)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Ns.isTracerEnabled(xp)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Oc.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Oc.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),p=c.getCertificate(),m=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:m&&"raw"in m?m.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Ns.trace(sa.LogVerbosity.DEBUG,xp,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Ns.trace(sa.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Ns.trace(sa.LogVerbosity.DEBUG,hO,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Ns.trace(sa.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[pO]=t,o[_O]=this.userAgent,o[mO]="application/grpc",o[gO]="POST",o[yO]=r,o[vO]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var p;(p=s.onCallEnd)===null||p===void 0||p.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var p;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(p=s.onStreamEnd)===null||p===void 0||p.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var p;(p=s.onCallEnd)===null||p===void 0||p.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var p;(p=s.onStreamEnd)===null||p===void 0||p.call(s,u)}},c=new uO.Http2SubchannelCall(a,l,i,this,(0,dO.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,kp.unregisterChannelzRef)(this.channelzRef)}},Op=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Ns.trace(sa.LogVerbosity.DEBUG,xp,(0,xs.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,xs.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,xs.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Oc.subchannelAddressToString)(e)));let p=(0,cb.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),m=t._getConnectionOptions()||{};m.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?m.maxSessionMemory=r["grpc-node.max_session_memory"]:m.maxSessionMemory=Number.MAX_SAFE_INTEGER;let S="http://";if("secureContext"in m){if(S="https://",r["grpc.ssl_target_name_override"]){let b=r["grpc.ssl_target_name_override"];m.checkServerIdentity=(O,D)=>(0,lb.checkServerIdentity)(b,D),m.servername=b}else{let b=(c=(l=(0,xs.splitHostPort)(p))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";m.servername=b}i.socket&&(m.createConnection=(b,O)=>i.socket)}else m.createConnection=(b,O)=>i.socket?i.socket:cO.connect(e);m=Object.assign(Object.assign(Object.assign({},m),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let E=Mp.connect(S+p,m);this.session=E;let T="Failed to connect";E.unref(),E.once("connect",()=>{E.removeAllListeners(),s(new Np(E,e,r,u)),this.session=null}),E.once("close",()=>{this.session=null,setImmediate(()=>{o(`${T} (${new Date().toISOString()})`)})}),E.once("error",b=>{T=b.message,this.trace("connection failed with error "+T)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,lb.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,cb.getDefaultAuthority)((i=(0,xs.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,xs.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,lO.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Mc.Http2SubchannelConnector=Op});var db=A(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.getSubchannelPool=Os.SubchannelPool=void 0;var bO=H_(),EO=tb(),TO=Dn(),wO=Ft(),IO=ub(),AO=1e4,oa=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},AO),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,wO.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,TO.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,bO.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new EO.Subchannel(e,t,r,i,new IO.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Os.SubchannelPool=oa;var DO=new oa;function RO(n){return n?DO:new oa}Os.getSubchannelPool=RO});var Fp=A(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});Ms.FilterStackFactory=Ms.FilterStack=void 0;var Pc=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Ms.FilterStack=Pc;var Pp=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new Pc(this.factories.map(e=>e.createFilter()))}};Ms.FilterStackFactory=Pp});var Lp=A(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.CompressionAlgorithms=void 0;var hb=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(hb||(Fc.CompressionAlgorithms=hb={}))});var Bp=A(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.BaseFilter=void 0;var Vp=class{sendMetadata(e){return R(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return R(this,null,function*(){return e})}receiveMessage(e){return R(this,null,function*(){return e})}receiveTrailers(e){return e}};Lc.BaseFilter=Vp});var mb=A(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.CompressionFilterFactory=Fs.CompressionFilter=void 0;var Vc=fe("zlib"),pb=Lp(),Bc=de(),kO=Bp(),xO=xe(),NO=n=>typeof n=="number"&&typeof pb.CompressionAlgorithms[n]=="string",Ps=class{writeMessage(e,t){return R(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return R(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Ei=class extends Ps{compressMessage(e){return R(this,null,function*(){return e})}writeMessage(e,t){return R(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Up=class extends Ps{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Vc.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Vc.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:Bc.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},qp=class extends Ps{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Vc.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Vc.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:Bc.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},zp=class extends Ps{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function fb(n,e){switch(n){case"identity":return new Ei;case"deflate":return new Up(e);case"gzip":return new qp(e);default:return new zp(n)}}var Uc=class extends kO.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new Ei,this.receiveCompression=new Ei,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:Bc.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(NO(s)){let o=pb.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=fb(this.currentCompressionAlgorithm,-1))}else xO.log(Bc.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return R(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=fb(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Ei,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return R(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Ei?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return R(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Fs.CompressionFilter=Uc;var Gp=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Uc(this.options,this.sharedFilterConfig)}};Fs.CompressionFilterFactory=Gp});var qc=A(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.deadlineToString=Vn.getRelativeTimeout=Vn.getDeadlineTimeoutString=Vn.minDeadline=void 0;function OO(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Vn.minDeadline=OO;var MO=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function PO(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of MO){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Vn.getDeadlineTimeoutString=PO;var FO=2147483647;function LO(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>FO?1/0:r}Vn.getRelativeTimeout=LO;function VO(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Vn.deadlineToString=VO});var Gc=A(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.restrictControlPlaneStatusCode=void 0;var Bn=de(),BO=[Bn.Status.OK,Bn.Status.INVALID_ARGUMENT,Bn.Status.NOT_FOUND,Bn.Status.ALREADY_EXISTS,Bn.Status.FAILED_PRECONDITION,Bn.Status.ABORTED,Bn.Status.OUT_OF_RANGE,Bn.Status.DATA_LOSS];function UO(n,e){return BO.includes(n)?{code:Bn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Bn.Status[n]} ${e}`}:{code:n,details:e}}zc.restrictControlPlaneStatusCode=UO});var yb=A(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});Wc.LoadBalancingCall=void 0;var gb=$t(),jc=de(),qO=qc(),$c=At(),aa=Nr(),zO=Ft(),GO=xe(),jp=Gc(),jO=fe("http2"),$O="load_balancing_call",$p=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),p="";u.length>=2&&(p=u[1]);let m=(c=(l=(0,zO.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${m}/${p}`}trace(e){GO.trace(jc.LogVerbosity.DEBUG,$O,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+aa.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case aa.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let p=this.metadata.clone();if(p.merge(a),p.get("authorization").length>1&&this.outputStatus({code:jc.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new $c.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==gb.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+gb.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&p.set("grpc-timeout",(0,qO.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(p,this.host,this.methodName,{onReceiveMetadata:m=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(m)},onReceiveMessage:m=>{this.trace("Received message"),this.listener.onReceiveMessage(m)},onReceiveStatus:m=>{this.trace("Received status"),m.rstCode===jO.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(m,"REFUSED"):this.outputStatus(m,"PROCESSED")}})}catch(m){this.trace("Failed to start call on picked subchannel "+i+" with error "+m.message),this.outputStatus({code:jc.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+m.message,metadata:new $c.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,jp.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:jc.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new $c.Metadata},"PROCESSED")});break;case aa.PickResultType.DROP:let{code:s,details:o}=(0,jp.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case aa.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,jp.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case aa.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new $c.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Wc.LoadBalancingCall=$p});var _b=A(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});Hc.ResolvingCall=void 0;var Ls=de(),Kc=qc(),vb=At(),WO=xe(),KO=Gc(),HO="resolving_call",Wp=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Ls.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Ls.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Ls.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Kc.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){WO.trace(Ls.LogVerbosity.DEBUG,HO,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Kc.deadlineToString)(this.deadline));let e=(0,Kc.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Ls.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Ls.Status.OK){let{code:r,details:i}=(0,KO.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new vb.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Kc.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new vb.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Hc.ResolvingCall=Wp});var Sb=A(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.RetryingCall=Qr.MessageBufferTracker=Qr.RetryThrottler=void 0;var Qc=de(),QO=At(),YO=xe(),JO="retrying_call",Hp=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Qr.RetryThrottler=Hp;var Qp=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Qr.MessageBufferTracker=Qp;var Kp="grpc-previous-rpc-attempts",Yp=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){YO.trace(Qc.LogVerbosity.DEBUG,JO,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new QO.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Qc.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Qc.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Qc.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Kp,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Kp,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Kp,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Qr.RetryingCall=Yp});var Jc=A(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.BaseSubchannelWrapper=void 0;var Jp=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Yc.BaseSubchannelWrapper=Jp});var Eb=A(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.InternalChannel=void 0;var XO=Fl(),ZO=K_(),eM=db(),Cb=Nr(),la=de(),tM=Fp(),nM=mb(),bb=In(),Xp=xe(),rM=wp(),Xc=Ft(),Un=$t(),ca=bi(),iM=yb(),sM=qc(),oM=_b(),Zp=Rp(),aM=Gc(),em=Sb(),lM=Jc(),cM=2147483647,uM=1e3,dM=30*60*1e3,Zc=new Map,hM=1<<24,fM=1<<20,tm=class extends lM.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},nm=class{constructor(e,t,r){var i,s,o,a,l,c,u,p;if(this.credentials=t,this.options=r,this.connectivityState=Un.ConnectivityState.IDLE,this.currentPicker=new Cb.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new ca.ChannelzCallTracker,this.childrenTracker=new ca.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof XO.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let m=(0,Xc.parseUri)(e);if(m===null)throw new Error(`Could not parse target name "${e}"`);let S=(0,bb.mapUriDefaultScheme)(m);if(S===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},cM),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new ca.ChannelzTrace,this.channelzRef=(0,ca.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,bb.getDefaultAuthority)(S);let E=(0,rM.mapProxyName)(S,r);this.target=E.target,this.options=Object.assign({},this.options,E.extraOptions),this.subchannelPool=(0,eM.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new em.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:hM,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:fM),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:dM,uM);let T={createSubchannel:(O,D)=>{let M=this.subchannelPool.getOrCreateSubchannel(this.target,O,Object.assign({},this.options,D),this.credentials);M.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",M.getChannelzRef());let P=new tm(M,this);return this.wrappedSubchannels.add(P),P},updateState:(O,D)=>{this.currentPicker=D;let M=this.pickQueue.slice();this.pickQueue=[],M.length>0&&this.callRefTimerUnref();for(let P of M)P.doPick();this.updateState(O)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:O=>{this.channelzEnabled&&this.childrenTracker.refChild(O)},removeChannelzChild:O=>{this.channelzEnabled&&this.childrenTracker.unrefChild(O)}};this.resolvingLoadBalancer=new ZO.ResolvingLoadBalancer(this.target,T,r,(O,D)=>{O.retryThrottling?Zc.set(this.getTarget(),new em.RetryThrottler(O.retryThrottling.maxTokens,O.retryThrottling.tokenRatio,Zc.get(this.getTarget()))):Zc.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=D,this.currentResolutionError=null,process.nextTick(()=>{let M=this.configSelectionQueue;this.configSelectionQueue=[],M.length>0&&this.callRefTimerUnref();for(let P of M)P.getConfig()})},O=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+O.code+' and details "'+O.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,aM.restrictControlPlaneStatusCode)(O.code,O.details)),{metadata:O.metadata}));let D=this.configSelectionQueue;this.configSelectionQueue=[],D.length>0&&this.callRefTimerUnref();for(let M of D)M.reportResolverError(O)}),this.filterStackFactory=new tM.FilterStackFactory([new nM.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let b=new Error;(0,Xp.trace)(la.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((p=b.stack)===null||p===void 0?void 0:p.substring(b.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Xp.trace)(t??la.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Xc.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Xp.trace)(la.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Xc.uriToString)(this.target)+" "+Un.ConnectivityState[this.connectivityState]+" -> "+Un.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Un.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Un.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Un.ConnectivityState.IDLE),this.currentPicker=new Cb.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Un.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===la.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Zp.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new iM.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Zp.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new em.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,Zc.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Zp.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,sM.deadlineToString)(t));let a={deadline:t,flags:s??la.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new oM.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Un.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,ca.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Xc.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Un.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Un.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};eu.InternalChannel=nm});var of=A(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.ChannelImplementation=void 0;var pM=Fl(),mM=Eb(),rm=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof pM.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new mM.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};tu.ChannelImplementation=rm});var Nb=A(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.Http2ServerCallStream=en.ServerDuplexStreamImpl=en.ServerWritableStreamImpl=en.ServerReadableStreamImpl=en.ServerUnaryCallImpl=void 0;var Rb=fe("events"),Vs=fe("http2"),om=fe("stream"),Tb=fe("zlib"),Te=de(),am=At(),gM=Ap(),kb=xe(),da=kl(),xb="server_call";function ua(n){kb.trace(Te.LogVerbosity.DEBUG,xb,n)}var yM="grpc-accept-encoding",vM="grpc-encoding",wb="grpc-message",Ib="grpc-status",Ab="grpc-timeout",_M=/(\d{1,8})\s*([HMSmun])/,SM={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},CM={[yM]:"identity,deflate,gzip",[vM]:"identity"},Db={[Vs.constants.HTTP2_HEADER_STATUS]:Vs.constants.HTTP_STATUS_OK,[Vs.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},bM={waitForTrailers:!0},im=class extends Rb.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};en.ServerUnaryCallImpl=im;var nu=class extends om.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};en.ServerReadableStreamImpl=nu;var ha=class extends om.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new am.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,da.getErrorMessage)(i),code:Te.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Te.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};en.ServerWritableStreamImpl=ha;var Bs=class extends om.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new am.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};en.ServerDuplexStreamImpl=Bs;Bs.prototype._read=nu.prototype._read;Bs.prototype._write=ha.prototype._write;Bs.prototype._final=ha.prototype._final;var sm=class extends Rb.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Te.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Te.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;ua("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Te.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=Tb.createInflate():i=Tb.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Te.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Te.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},Db),CM),t);this.stream.respond(r,bM)}receiveMetadata(e){let t=am.Metadata.fromHttp2Headers(e);kb.isTracerEnabled(xb)&&ua("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(Ab);if(r.length>0){let i=r[0].toString().match(_M);if(i===null){let a=new Error("Invalid deadline");return a.code=Te.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*SM[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(EM,s,this),t.remove(Ab)}return t.remove(Vs.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Vs.constants.HTTP2_HEADER_TE),t.remove(Vs.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(p){if(s+=p.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Te.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(p)}function u(p){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),p!==void 0){r({code:Te.Status.INTERNAL,details:p.message});return}if(s===0){r({code:Te.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let m=Buffer.concat(a,s),E=m.readUInt8(0)===1?e:"identity",T=o.getDecompressedMessage(m,E);if(Buffer.isBuffer(T)){t(o.deserializeMessageWithInternalError(T));return}T.then(b=>t(o.deserializeMessageWithInternalError(b)),b=>r(b.code?b:{code:Te.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return R(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,da.getErrorMessage)(t),code:Te.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return R(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Te.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,da.getErrorMessage)(s),code:Te.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Te.Status.OK),!this.checkCancelled())if(ua("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Te.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[Ib]:e.code,[wb]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[Ib]:e.code,[wb]:encodeURI(e.details)},Db),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Te.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Te.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new gM.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>R(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>R(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Te.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let m=u.readUInt8(0)===1?t:"identity",S;try{S=yield this.getDecompressedMessage(u,m)}catch(E){this.sendError(E);return}if(!S)return;yield this.pushOrBufferMessage(e,S)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>R(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return R(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return R(this,null,function*(){if(t===null){ua("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}ua("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,da.getErrorCode)(r);(i===null||i<Te.Status.OK||i>Te.Status.UNAUTHENTICATED)&&(i=Te.Status.INTERNAL),e.emit("error",{details:(0,da.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};en.Http2ServerCallStream=sm;function EM(n){let e=new Error("Deadline exceeded");e.code=Te.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var um=A(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.ServerCredentials=void 0;var Ob=Rh(),fa=class{static createInsecure(){return new lm}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new cm({ca:e||(0,Ob.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:Ob.CIPHER_SUITES})}};ru.ServerCredentials=fa;var lm=class extends fa{_isSecure(){return!1}_getSettings(){return null}},cm=class extends fa{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var Fb=A(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.Server=void 0;var Yr=fe("http2"),or=de(),Ti=Nb(),TM=um(),Mb=In(),iu=xe(),gn=Dn(),wM=Ft(),kt=bi(),su=~(1<<31),IM=~(1<<31),AM=2e4,{HTTP2_HEADER_PATH:Pb}=Yr.constants,DM="server";function RM(){}function dm(n){return{code:or.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function kM(n,e){let t=dm(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var hm=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new kt.ChannelzTrace,this.callTracker=new kt.ChannelzCallTracker,this.listenerChildrenTracker=new kt.ChannelzChildrenTracker,this.sessionChildrenTracker=new kt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,kt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:su,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:su,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:IM,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:AM,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,gn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,gn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let p=o,m=p.getCipher(),S=p.getCertificate(),E=p.getPeerCertificate();c={cipherSuiteStandardName:(t=m.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:m.standardName?null:m.name,localCertificate:S&&"raw"in S?S.raw:null,remoteCertificate:E&&"raw"in E?E.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){iu.trace(or.LogVerbosity.DEBUG,DM,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=kM(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof TM.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,wM.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,Mb.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(S,E)=>{process.nextTick(()=>r(S,E))},l=()=>{let S;if(t._isSecure()){let E=Object.assign(o,t._getSettings());E.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,S=Yr.createSecureServer(E),S.on("secureConnection",T=>{T.on("error",b=>{this.trace("An incoming TLS connection closed with error: "+b.message)})})}else S=Yr.createServer(o);return S.setTimeout(0,RM),this._setupHandlers(S),S},c=(S,E,T)=>S.length===0?Promise.resolve({port:E,count:T}):Promise.all(S.map(b=>{this.trace("Attempting to bind "+(0,gn.subchannelAddressToString)(b));let O;(0,gn.isTcpSubchannelAddress)(b)?O={host:b.host,port:E}:O=b;let D=l();return new Promise((M,P)=>{let j=Q=>{this.trace("Failed to bind "+(0,gn.subchannelAddressToString)(b)+" with error "+Q.message),M(Q)};D.once("error",j),D.listen(O,()=>{if(this.shutdown){D.close(),M(new Error("bindAsync failed because server is shutdown"));return}let Q=D.address(),_;typeof Q=="string"?_={path:Q}:_={host:Q.address,port:Q.port};let g=(0,kt.registerChannelzSocket)((0,gn.subchannelAddressToString)(_),()=>({localAddress:_,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:D,channelzRef:g}),this.trace("Successfully bound "+(0,gn.subchannelAddressToString)(_)),M("port"in _?_.port:E),D.removeListener("error",j)})})})).then(b=>{let O=0;for(let D of b)if(typeof D=="number"&&(O+=1,D!==E))throw new Error("Invalid state: multiple port numbers added from single address");return{port:E,count:O+T}}),u=S=>{if(S.length===0)return Promise.resolve({port:0,count:0});let E=S[0],T=l();return new Promise((b,O)=>{let D=M=>{this.trace("Failed to bind "+(0,gn.subchannelAddressToString)(E)+" with error "+M.message),b(u(S.slice(1)))};T.once("error",D),T.listen(E,()=>{if(this.shutdown){T.close(),b({port:0,count:0});return}let M=T.address(),P={host:M.address,port:M.port},j=(0,kt.registerChannelzSocket)((0,gn.subchannelAddressToString)(P),()=>({localAddress:P,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(j),this.http2ServerList.push({server:T,channelzRef:j}),this.trace("Successfully bound "+(0,gn.subchannelAddressToString)(P)),b(c(S.slice(1),M.port,1)),T.removeListener("error",D)})})},p={onSuccessfulResolution:(S,E,T)=>{if(p.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),S.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let b;(0,gn.isTcpSubchannelAddress)(S[0])?S[0].port===0?b=u(S):b=c(S,S[0].port,0):b=c(S,1,0),b.then(O=>{if(O.count===0){let D=`No address added out of total ${S.length} resolved`;iu.log(or.LogVerbosity.ERROR,D),a(new Error(D),0)}else O.count<S.length&&iu.log(or.LogVerbosity.INFO,`WARNING Only ${O.count} addresses added out of total ${S.length} resolved`),a(null,O.port)},O=>{let D=`No address added out of total ${S.length} resolved`;iu.log(or.LogVerbosity.ERROR,D),a(new Error(D),0)})},onError:S=>{a(new Error(S.details),0)}};(0,Mb.createResolver)(s,p,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,kt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Yr.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,kt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,kt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,kt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Yr.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Yr.constants.HTTP2_HEADER_STATUS]:Yr.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Ti.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=or.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[Pb],s=this._retrieveHandler(i);if(!s){this._respondWithError(dm(i),e,r);return}let o=new Ti.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===or.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:or.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[Pb],i=this._retrieveHandler(r);if(!i){this._respondWithError(dm(r),e,null);return}let s=new Ti.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:or.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")xM(e,t,s,o);else if(a==="clientStream")NM(e,t,s,o);else if(a==="serverStream")OM(e,t,s,o);else if(a==="bidi")MM(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let p=(0,kt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),m={ref:p,streamTracker:new kt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,m);let S=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+S),this.sessionChildrenTracker.refChild(p));let E=null,T=null,b=!1;if(this.maxConnectionAgeMs!==su){let D=this.maxConnectionAgeMs/10,M=Math.random()*D*2-D;E=(l=(a=setTimeout(()=>{var P,j;b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+S);try{s.goaway(Yr.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==su&&(T=(j=(P=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||j===void 0?void 0:j.call(P))},this.maxConnectionAgeMs+M)).unref)===null||l===void 0?void 0:l.call(a)}let O=(u=(c=setInterval(()=>{var D,M;let P=(M=(D=setTimeout(()=>{b=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+S),s.close()},this.keepaliveTimeoutMs)).unref)===null||M===void 0?void 0:M.call(D);try{s.ping((j,Q,_)=>{clearTimeout(P)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(b||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+S),this.sessionChildrenTracker.unrefChild(p),(0,kt.unregisterChannelzRef)(p)),E&&clearTimeout(E),T&&clearTimeout(T),O&&clearTimeout(O),this.sessions.delete(s)})})}};ou.Server=hm;function xM(n,e,t,r){return R(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ti.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function NM(n,e,t,r){let i=new Ti.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function OM(n,e,t,r){return R(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ti.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function MM(n,e,t,r){let i=new Ti.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var Lb=A(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.StatusBuilder=void 0;var fm=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};au.StatusBuilder=fm});var pm=A(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.isDuration=Jr.durationToMs=Jr.msToDuration=void 0;function PM(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}Jr.msToDuration=PM;function FM(n){return n.seconds*1e3+n.nanos/1e6|0}Jr.durationToMs=FM;function LM(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}Jr.isDuration=LM});var bm=A(Xr=>{"use strict";var mm;Object.defineProperty(Xr,"__esModule",{value:!0});Xr.setup=Xr.OutlierDetectionLoadBalancer=Xr.OutlierDetectionLoadBalancingConfig=void 0;var cu=$t(),Bb=de(),wi=pm(),Ub=Em(),qb=Dr(),VM=Gl(),BM=Nr(),Vb=Dn(),UM=Jc(),qM=xe(),zM="outlier_detection";function Ze(n){qM.trace(Bb.LogVerbosity.DEBUG,zM,n)}var Cm="outlier_detection",GM=((mm=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&mm!==void 0?mm:"true")==="true",jM={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},$M={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Us(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function gm(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,wi.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function lu(n,e,t){let r=t?`${t}.${e}`:e;if(Us(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var pa=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},jM),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},$M),o):null}getLoadBalancerName(){return Cm}toJsonObject(){return{interval:(0,wi.msToDuration)(this.intervalMs),base_ejection_time:(0,wi.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,wi.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(gm(e,"interval"),gm(e,"base_ejection_time"),gm(e,"max_ejection_time"),lu(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Us(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),lu(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Us(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Us(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");lu(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),lu(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Us(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Us(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,wi.durationToMs)(e.interval):null,e.base_ejection_time?(0,wi.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,wi.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(qb.validateLoadBalancingConfig))}};Xr.OutlierDetectionLoadBalancingConfig=pa;var vm=class extends UM.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?cu.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,cu.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,cu.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function ym(){return{success:0,failure:0}}var _m=class{constructor(){this.activeBucket=ym(),this.inactiveBucket=ym()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=ym()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Sm=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===BM.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===Bb.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},uu=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new VM.ChildLoadBalancerHandler((0,Ub.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,Vb.subchannelAddressToString)(t)),o=new vm(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===cu.ConnectivityState.READY?e.updateState(t,new Sm(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Ze("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[p,m]of this.addressMap){let S=m.counter.getLastSuccesses(),E=m.counter.getLastFailures();Ze("Stats for "+p+": successes="+S+" failures="+E+" targetRequestVolume="+r),S+E>=r&&(i+=1,s.push(S/(S+E)))}if(Ze("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((p,m)=>p+m)/s.length,a=0;for(let p of s){let m=p-o;a+=m*m}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);Ze("stdev="+c+" ejectionThreshold="+u);for(let[p,m]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let S=m.counter.getLastSuccesses(),E=m.counter.getLastFailures();if(S+E<r)continue;let T=S/(S+E);if(Ze("Checking candidate "+p+" successRate="+T),T<u){let b=Math.random()*100;Ze("Candidate "+p+" randomNumber="+b+" enforcement_percentage="+t.enforcement_percentage),b<t.enforcement_percentage&&(Ze("Ejecting candidate "+p),this.eject(m,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Ze("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(Ze("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;Ze("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(Ze("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Ze("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(Ze("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof pa))return;let i=new Set;for(let o of e)i.add((0,Vb.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(Ze("Adding map entry for "+o),this.addressMap.set(o,{counter:new _m,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(Ze("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,qb.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Ze("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else Ze("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Ze("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Cm}};Xr.OutlierDetectionLoadBalancer=uu;function WM(){GM&&(0,Ub.registerLoadBalancerType)(Cm,uu,pa)}Xr.setup=WM});var Em=A(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.OutlierDetectionLoadBalancingConfig=Z.BaseSubchannelWrapper=Z.registerAdminService=Z.FilterStackFactory=Z.BaseFilter=Z.PickResultType=Z.QueuePicker=Z.UnavailablePicker=Z.ChildLoadBalancerHandler=Z.subchannelAddressToString=Z.validateLoadBalancingConfig=Z.getFirstUsableConfig=Z.registerLoadBalancerType=Z.createChildChannelControlHelper=Z.BackoffTimeout=Z.durationToMs=Z.uriToString=Z.createResolver=Z.registerResolver=Z.log=Z.trace=void 0;var zb=xe();Object.defineProperty(Z,"trace",{enumerable:!0,get:function(){return zb.trace}});Object.defineProperty(Z,"log",{enumerable:!0,get:function(){return zb.log}});var Gb=In();Object.defineProperty(Z,"registerResolver",{enumerable:!0,get:function(){return Gb.registerResolver}});Object.defineProperty(Z,"createResolver",{enumerable:!0,get:function(){return Gb.createResolver}});var KM=Ft();Object.defineProperty(Z,"uriToString",{enumerable:!0,get:function(){return KM.uriToString}});var HM=pm();Object.defineProperty(Z,"durationToMs",{enumerable:!0,get:function(){return HM.durationToMs}});var QM=Fo();Object.defineProperty(Z,"BackoffTimeout",{enumerable:!0,get:function(){return QM.BackoffTimeout}});var du=Dr();Object.defineProperty(Z,"createChildChannelControlHelper",{enumerable:!0,get:function(){return du.createChildChannelControlHelper}});Object.defineProperty(Z,"registerLoadBalancerType",{enumerable:!0,get:function(){return du.registerLoadBalancerType}});Object.defineProperty(Z,"getFirstUsableConfig",{enumerable:!0,get:function(){return du.getFirstUsableConfig}});Object.defineProperty(Z,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return du.validateLoadBalancingConfig}});var YM=Dn();Object.defineProperty(Z,"subchannelAddressToString",{enumerable:!0,get:function(){return YM.subchannelAddressToString}});var JM=Gl();Object.defineProperty(Z,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return JM.ChildLoadBalancerHandler}});var Tm=Nr();Object.defineProperty(Z,"UnavailablePicker",{enumerable:!0,get:function(){return Tm.UnavailablePicker}});Object.defineProperty(Z,"QueuePicker",{enumerable:!0,get:function(){return Tm.QueuePicker}});Object.defineProperty(Z,"PickResultType",{enumerable:!0,get:function(){return Tm.PickResultType}});var XM=Bp();Object.defineProperty(Z,"BaseFilter",{enumerable:!0,get:function(){return XM.BaseFilter}});var ZM=Fp();Object.defineProperty(Z,"FilterStackFactory",{enumerable:!0,get:function(){return ZM.FilterStackFactory}});var eP=$l();Object.defineProperty(Z,"registerAdminService",{enumerable:!0,get:function(){return eP.registerAdminService}});var tP=Jc();Object.defineProperty(Z,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return tP.BaseSubchannelWrapper}});var nP=bm();Object.defineProperty(Z,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return nP.OutlierDetectionLoadBalancingConfig}})});var jb=A(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.setup=void 0;var rP=In(),wm=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function iP(){(0,rP.registerResolver)("unix",wm)}hu.setup=iP});var Qb=A(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.setup=void 0;var $b=fe("net"),fu=de(),Im=At(),Wb=In(),Kb=Ft(),sP=xe(),oP="ip_resolver";function Hb(n){sP.trace(fu.LogVerbosity.DEBUG,oP,n)}var Am="ipv4",Dm="ipv6",aP=443,pu=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,Hb("Resolver constructed for target "+(0,Kb.uriToString)(e));let s=[];if(!(e.scheme===Am||e.scheme===Dm)){this.error={code:fu.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Im.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,Kb.splitHostPort)(a);if(l===null){this.error={code:fu.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Im.Metadata};return}if(e.scheme===Am&&!(0,$b.isIPv4)(l.host)||e.scheme===Dm&&!(0,$b.isIPv6)(l.host)){this.error={code:fu.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Im.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:aP})}this.addresses=s,Hb("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function lP(){(0,Wb.registerResolver)(Am,pu),(0,Wb.registerResolver)(Dm,pu)}mu.setup=lP});var Xb=A(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.setup=qn.PickFirstLoadBalancer=qn.shuffled=qn.PickFirstLoadBalancingConfig=void 0;var Yb=Dr(),ht=$t(),gu=Nr(),cP=xe(),uP=de(),dP="pick_first";function Rm(n){cP.trace(uP.LogVerbosity.DEBUG,dP,n)}var ma="pick_first",hP=250,ga=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return ma}toJsonObject(){return{[ma]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};qn.PickFirstLoadBalancingConfig=ga;var km=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:gu.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function Jb(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}qn.shuffled=Jb;var yu=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=ht.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(ht.ConnectivityState.READY,new km(this.currentPick)):this.children.length===0?this.updateState(ht.ConnectivityState.IDLE,new gu.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(ht.ConnectivityState.TRANSIENT_FAILURE,new gu.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(ht.ConnectivityState.CONNECTING,new gu.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==ht.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===ht.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===ht.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===ht.ConnectivityState.IDLE||i===ht.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===ht.ConnectivityState.IDLE&&(Rm("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},hP)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Rm("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Rm(ht.ConnectivityState[this.currentState]+" -> "+ht.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===ht.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===ht.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof ga&&(t.getShuffleAddressList()&&(e=Jb(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===ht.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return ma}};qn.PickFirstLoadBalancer=yu;function fP(){(0,Yb.registerLoadBalancerType)(ma,yu,ga),(0,Yb.registerDefaultLoadBalancerType)(ma)}qn.setup=fP});var eE=A(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.setup=qs.RoundRobinLoadBalancer=void 0;var pP=Dr(),ft=$t(),vu=Nr(),mP=Dn(),gP=xe(),yP=de(),vP="round_robin";function Zb(n){gP.trace(yP.LogVerbosity.DEBUG,vP,n)}var _u="round_robin",xm=class n{getLoadBalancerName(){return _u}constructor(){}toJsonObject(){return{[_u]:{}}}static createFromJson(e){return new n}},Nm=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:vu.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Su=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=ft.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===ft.ConnectivityState.TRANSIENT_FAILURE||i===ft.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(ft.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===ft.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(ft.ConnectivityState.READY,new Nm(e,t))}else this.countSubchannelsWithState(ft.ConnectivityState.CONNECTING)>0?this.updateState(ft.ConnectivityState.CONNECTING,new vu.QueuePicker(this)):this.countSubchannelsWithState(ft.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(ft.ConnectivityState.TRANSIENT_FAILURE,new vu.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(ft.ConnectivityState.IDLE,new vu.QueuePicker(this))}updateState(e,t){Zb(ft.ConnectivityState[this.currentState]+" -> "+ft.ConnectivityState[e]),e===ft.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),Zb("Connect to address list "+e.map(r=>(0,mP.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===ft.ConnectivityState.IDLE||i===ft.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return _u}};qs.RoundRobinLoadBalancer=Su;function _P(){(0,pP.registerLoadBalancerType)(_u,Su,xm)}qs.setup=_P});var iE=A(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.experimental=q.addAdminServicesToServer=q.getChannelzHandlers=q.getChannelzServiceDefinition=q.InterceptorConfigurationError=q.InterceptingCall=q.RequesterBuilder=q.ListenerBuilder=q.StatusBuilder=q.getClientChannel=q.ServerCredentials=q.Server=q.setLogVerbosity=q.setLogger=q.load=q.loadObject=q.CallCredentials=q.ChannelCredentials=q.waitForClientReady=q.closeClient=q.Channel=q.makeGenericClientConstructor=q.makeClientConstructor=q.loadPackageDefinition=q.Client=q.compressionAlgorithms=q.propagate=q.connectivityState=q.status=q.logVerbosity=q.Metadata=q.credentials=void 0;var Cu=Ah();Object.defineProperty(q,"CallCredentials",{enumerable:!0,get:function(){return Cu.CallCredentials}});var SP=of();Object.defineProperty(q,"Channel",{enumerable:!0,get:function(){return SP.ChannelImplementation}});var CP=Lp();Object.defineProperty(q,"compressionAlgorithms",{enumerable:!0,get:function(){return CP.CompressionAlgorithms}});var bP=$t();Object.defineProperty(q,"connectivityState",{enumerable:!0,get:function(){return bP.ConnectivityState}});var bu=Fl();Object.defineProperty(q,"ChannelCredentials",{enumerable:!0,get:function(){return bu.ChannelCredentials}});var tE=sf();Object.defineProperty(q,"Client",{enumerable:!0,get:function(){return tE.Client}});var Om=de();Object.defineProperty(q,"logVerbosity",{enumerable:!0,get:function(){return Om.LogVerbosity}});Object.defineProperty(q,"status",{enumerable:!0,get:function(){return Om.Status}});Object.defineProperty(q,"propagate",{enumerable:!0,get:function(){return Om.Propagate}});var nE=xe(),Mm=lf();Object.defineProperty(q,"loadPackageDefinition",{enumerable:!0,get:function(){return Mm.loadPackageDefinition}});Object.defineProperty(q,"makeClientConstructor",{enumerable:!0,get:function(){return Mm.makeClientConstructor}});Object.defineProperty(q,"makeGenericClientConstructor",{enumerable:!0,get:function(){return Mm.makeClientConstructor}});var EP=At();Object.defineProperty(q,"Metadata",{enumerable:!0,get:function(){return EP.Metadata}});var TP=Fb();Object.defineProperty(q,"Server",{enumerable:!0,get:function(){return TP.Server}});var wP=um();Object.defineProperty(q,"ServerCredentials",{enumerable:!0,get:function(){return wP.ServerCredentials}});var IP=Lb();Object.defineProperty(q,"StatusBuilder",{enumerable:!0,get:function(){return IP.StatusBuilder}});q.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:bu.ChannelCredentials.createInsecure,createSsl:bu.ChannelCredentials.createSsl,createFromSecureContext:bu.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Cu.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Cu.CallCredentials.createFromGoogleCredential,createEmpty:Cu.CallCredentials.createEmpty};var AP=n=>n.close();q.closeClient=AP;var DP=(n,e,t)=>n.waitForReady(e,t);q.waitForClientReady=DP;var RP=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};q.loadObject=RP;var kP=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};q.load=kP;var xP=n=>{nE.setLogger(n)};q.setLogger=xP;var NP=n=>{nE.setLoggerVerbosity(n)};q.setLogVerbosity=NP;var OP=n=>tE.Client.prototype.getChannel.call(n);q.getClientChannel=OP;var Eu=tf();Object.defineProperty(q,"ListenerBuilder",{enumerable:!0,get:function(){return Eu.ListenerBuilder}});Object.defineProperty(q,"RequesterBuilder",{enumerable:!0,get:function(){return Eu.RequesterBuilder}});Object.defineProperty(q,"InterceptingCall",{enumerable:!0,get:function(){return Eu.InterceptingCall}});Object.defineProperty(q,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Eu.InterceptorConfigurationError}});var rE=bi();Object.defineProperty(q,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return rE.getChannelzServiceDefinition}});Object.defineProperty(q,"getChannelzHandlers",{enumerable:!0,get:function(){return rE.getChannelzHandlers}});var MP=$l();Object.defineProperty(q,"addAdminServicesToServer",{enumerable:!0,get:function(){return MP.addAdminServicesToServer}});var PP=Em();q.experimental=PP;var FP=Tp(),LP=jb(),VP=Qb(),BP=Xb(),UP=eE(),qP=bm(),zP=bi();FP.setup(),LP.setup(),VP.setup(),BP.setup(),UP.setup(),qP.setup(),zP.setup()});var Vv=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(z(vo),z(yo))}}static{this.\u0275dir=Ge({type:n})}}return n})(),Ro=(()=>{class n extends Vv{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,features:[_t]})}}return n})(),ci=new Pe(""),Gw={provide:ci,useExisting:qt(()=>Kd),multi:!0},Kd=(()=>{class n extends Ro{writeValue(t){this.setProperty("checked",t)}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,i){r&1&&ie("change",function(o){return i.onChange(o.target.checked)})("blur",function(){return i.onTouched()})},features:[zt([Gw]),_t]})}}return n})(),jw={provide:ci,useExisting:qt(()=>wt),multi:!0};function $w(){let n=Vd()?Vd().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var Ww=new Pe(""),wt=(()=>{class n extends Vv{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!$w())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(z(vo),z(yo),z(Ww,8))}}static{this.\u0275dir=Ge({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&ie("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[zt([jw]),_t]})}}return n})();function vr(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function Bv(n){return n!=null&&typeof n.length=="number"}var Ji=new Pe(""),pl=new Pe(""),Kw=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,_r=class{static min(e){return Uv(e)}static max(e){return Hw(e)}static required(e){return qv(e)}static requiredTrue(e){return Qw(e)}static email(e){return Yw(e)}static minLength(e){return Jw(e)}static maxLength(e){return Xw(e)}static pattern(e){return Zw(e)}static nullValidator(e){return ol(e)}static compose(e){return Kv(e)}static composeAsync(e){return Hv(e)}};function Uv(n){return e=>{if(vr(e.value)||vr(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function Hw(n){return e=>{if(vr(e.value)||vr(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function qv(n){return vr(n.value)?{required:!0}:null}function Qw(n){return n.value===!0?null:{required:!0}}function Yw(n){return vr(n.value)||Kw.test(n.value)?null:{email:!0}}function Jw(n){return e=>vr(e.value)||!Bv(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function Xw(n){return e=>Bv(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function Zw(n){if(!n)return ol;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(vr(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function ol(n){return null}function zv(n){return n!=null}function Gv(n){return iv(n)?qi(n):n}function jv(n){let e={};return n.forEach(t=>{e=t!=null?vt(vt({},e),t):e}),Object.keys(e).length===0?null:e}function $v(n,e){return e.map(t=>t(n))}function eI(n){return!n.validate}function Wv(n){return n.map(e=>eI(e)?e:t=>e.validate(t))}function Kv(n){if(!n)return null;let e=n.filter(zv);return e.length==0?null:function(t){return jv($v(t,e))}}function Hd(n){return n!=null?Kv(Wv(n)):null}function Hv(n){if(!n)return null;let e=n.filter(zv);return e.length==0?null:function(t){let r=$v(t,e).map(Gv);return Jy(r).pipe(Mt(jv))}}function Qd(n){return n!=null?Hv(Wv(n)):null}function Rv(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Qv(n){return n._rawValidators}function Yv(n){return n._rawAsyncValidators}function zd(n){return n?Array.isArray(n)?n:[n]:[]}function al(n,e){return Array.isArray(n)?n.includes(e):n===e}function kv(n,e){let t=zd(e);return zd(n).forEach(i=>{al(t,i)||t.push(i)}),t}function xv(n,e){return zd(e).filter(t=>!al(n,t))}var ll=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Hd(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Qd(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Yn=class extends ll{get formDirective(){return null}get path(){return null}},li=class extends ll{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},cl=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},tI={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},cq=Ot(vt({},tI),{"[class.ng-submitted]":"isSubmitted"}),Gt=(()=>{class n extends cl{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(z(li,2))}}static{this.\u0275dir=Ge({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Od("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[_t]})}}return n})(),Cr=(()=>{class n extends cl{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(z(Yn,10))}}static{this.\u0275dir=Ge({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Od("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[_t]})}}return n})();var Eo="VALID",sl="INVALID",Ki="PENDING",To="DISABLED",Sr=class{},ul=class extends Sr{constructor(e,t){super(),this.value=e,this.source=t}},Io=class extends Sr{constructor(e,t){super(),this.pristine=e,this.source=t}},Ao=class extends Sr{constructor(e,t){super(),this.touched=e,this.source=t}},Hi=class extends Sr{constructor(e,t){super(),this.status=e,this.source=t}},Gd=class extends Sr{constructor(e){super(),this.source=e}},jd=class extends Sr{constructor(e){super(),this.source=e}};function Yd(n){return(ml(n)?n.validators:n)||null}function nI(n){return Array.isArray(n)?Hd(n):n||null}function Jd(n,e){return(ml(e)?e.asyncValidators:n)||null}function rI(n){return Array.isArray(n)?Qd(n):n||null}function ml(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Jv(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Ga(1e3,"");if(!r[t])throw new Ga(1001,"")}function Xv(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Ga(1002,"")})}var Qi=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=ji(()=>this.statusReactive()),this.statusReactive=Gi(void 0),this._pristine=ji(()=>this.pristineReactive()),this.pristineReactive=Gi(!0),this._touched=ji(()=>this.touchedReactive()),this.touchedReactive=Gi(!1),this._events=new za,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Hn(this.statusReactive)}set status(e){Hn(()=>this.statusReactive.set(e))}get valid(){return this.status===Eo}get invalid(){return this.status===sl}get pending(){return this.status==Ki}get disabled(){return this.status===To}get enabled(){return this.status!==To}get pristine(){return Hn(this.pristineReactive)}set pristine(e){Hn(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Hn(this.touchedReactive)}set touched(e){Hn(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(kv(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(kv(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(xv(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(xv(e,this._rawAsyncValidators))}hasValidator(e){return al(this._rawValidators,e)}hasAsyncValidator(e){return al(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Ot(vt({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Ao(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new Ao(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Ot(vt({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Io(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new Io(!0,r))}markAsPending(e={}){this.status=Ki;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Hi(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Ot(vt({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=To,this.errors=null,this._forEachChild(i=>{i.disable(Ot(vt({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ul(this.value,r)),this._events.next(new Hi(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ot(vt({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Eo,this._forEachChild(r=>{r.enable(Ot(vt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Ot(vt({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Eo||this.status===Ki)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ul(this.value,t)),this._events.next(new Hi(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Ot(vt({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?To:Eo}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Ki,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=Gv(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Hi(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new oi,this.statusChanges=new oi}_calculateStatus(){return this._allControlsDisabled()?To:this.errors?sl:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ki)?Ki:this._anyControlsHaveStatus(sl)?sl:Eo}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new Io(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Ao(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ml(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=nI(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=rI(this._rawAsyncValidators)}},Yi=class extends Qi{constructor(e,t,r){super(Yd(t),Jd(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){Xv(this,!0,e),Object.keys(e).forEach(r=>{Jv(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var $d=class extends Yi{};var ko=new Pe("CallSetDisabledState",{providedIn:"root",factory:()=>gl}),gl="always";function Zv(n,e){return[...e.path,n]}function dl(n,e,t=gl){Xd(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),sI(n,e),aI(n,e),oI(n,e),iI(n,e)}function Nv(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),fl(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function hl(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function iI(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Xd(n,e){let t=Qv(n);e.validator!==null?n.setValidators(Rv(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=Yv(n);e.asyncValidator!==null?n.setAsyncValidators(Rv(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();hl(e._rawValidators,i),hl(e._rawAsyncValidators,i)}function fl(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=Qv(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=Yv(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return hl(e._rawValidators,r),hl(e._rawAsyncValidators,r),t}function sI(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&e_(n,e)})}function oI(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&e_(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function e_(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function aI(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function t_(n,e){n==null,Xd(n,e)}function lI(n,e){return fl(n,e)}function n_(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function cI(n){return Object.getPrototypeOf(n.constructor)===Ro}function r_(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function i_(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===wt?t=s:cI(s)?r=s:i=s}),i||r||t||null}function uI(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var dI={provide:Yn,useExisting:qt(()=>ui)},wo=Promise.resolve(),ui=(()=>{class n extends Yn{get submitted(){return Hn(this.submittedReactive)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=ji(()=>this.submittedReactive()),this.submittedReactive=Gi(!1),this._directives=new Set,this.ngSubmit=new oi,this.form=new Yi({},Hd(t),Qd(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){wo.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),dl(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){wo.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){wo.then(()=>{let r=this._findContainer(t.path),i=new Yi({});t_(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){wo.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){wo.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),r_(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(r){return new(r||n)(z(Ji,10),z(pl,10),z(ko,8))}}static{this.\u0275dir=Ge({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){r&1&&ie("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[zt([dI]),_t]})}}return n})();function Ov(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Mv(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Do=class extends Qi{constructor(e=null,t,r){super(Yd(t),Jd(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ml(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Mv(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Ov(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Ov(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Mv(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var hI=n=>n instanceof Do;var fI={provide:li,useExisting:qt(()=>sn)},Pv=Promise.resolve(),sn=(()=>{class n extends li{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new Do,this._registered=!1,this.name="",this.update=new oi,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=i_(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),n_(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){dl(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){Pv.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Ld(r);Pv.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Zv(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(z(Yn,9),z(Ji,10),z(pl,10),z(ci,10),z(ov,8),z(ko,8))}}static{this.\u0275dir=Ge({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[zt([fI]),_t,mo]})}}return n})(),br=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Ge({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})(),pI={provide:ci,useExisting:qt(()=>Zd),multi:!0},Zd=(()=>{class n extends Ro{writeValue(t){let r=t??"";this.setProperty("value",r)}registerOnChange(t){this.onChange=r=>{t(r==""?null:parseFloat(r))}}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,i){r&1&&ie("input",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},features:[zt([pI]),_t]})}}return n})();var s_=new Pe("");var mI={provide:Yn,useExisting:qt(()=>eh)},eh=(()=>{class n extends Yn{get submitted(){return Hn(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=ji(()=>this._submittedReactive()),this._submittedReactive=Gi(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new oi,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(fl(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let r=this.form.get(t.path);return dl(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){Nv(t.control||null,t,!1),uI(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this._submittedReactive.set(!0),r_(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new Gd(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new jd(this.form))}_updateDomValue(){this.directives.forEach(t=>{let r=t.control,i=this.form.get(t.path);r!==i&&(Nv(r||null,t),hI(i)&&(dl(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let r=this.form.get(t.path);t_(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let r=this.form.get(t.path);r&&lI(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Xd(this.form,this),this._oldForm&&fl(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(r){return new(r||n)(z(Ji,10),z(pl,10),z(ko,8))}}static{this.\u0275dir=Ge({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){r&1&&ie("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[zt([mI]),_t,mo]})}}return n})();var gI={provide:li,useExisting:qt(()=>th)},th=(()=>{class n extends li{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,r,i,s,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.name=null,this.update=new oi,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=i_(this,s)}ngOnChanges(t){this._added||this._setUpControl(),n_(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Zv(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(r){return new(r||n)(z(Yn,13),z(Ji,10),z(pl,10),z(ci,10),z(s_,8))}}static{this.\u0275dir=Ge({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[zt([gI]),_t,mo]})}}return n})(),yI={provide:ci,useExisting:qt(()=>yl),multi:!0};function o_(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function vI(n){return n.split(":")[0]}var yl=(()=>{class n extends Ro{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;let r=this._getOptionId(t),i=o_(r,t);this.setProperty("value",i)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){let r=vI(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,i){r&1&&ie("change",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[zt([yI]),_t]})}}return n})(),a_=(()=>{class n{constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(o_(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(r){return new(r||n)(z(yo),z(vo),z(yl,9))}}static{this.\u0275dir=Ge({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return n})(),_I={provide:ci,useExisting:qt(()=>l_),multi:!0};function Fv(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function SI(n){return n.split(":")[0]}var l_=(()=>{class n extends Ro{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;let r;if(Array.isArray(t)){let i=t.map(s=>this._getOptionId(s));r=(s,o)=>{s._setSelected(i.indexOf(o.toString())>-1)}}else r=(i,s)=>{i._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{let i=[],s=r.selectedOptions;if(s!==void 0){let o=s;for(let a=0;a<o.length;a++){let l=o[a],c=this._getOptionValue(l.value);i.push(c)}}else{let o=r.options;for(let a=0;a<o.length;a++){let l=o[a];if(l.selected){let c=this._getOptionValue(l.value);i.push(c)}}}this.value=i,t(i)}}_registerOption(t){let r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){let r=SI(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,i){r&1&&ie("change",function(o){return i.onChange(o.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[zt([_I]),_t]})}}return n})(),c_=(()=>{class n{constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(Fv(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(Fv(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(r){return new(r||n)(z(yo),z(vo),z(l_,9))}}static{this.\u0275dir=Ge({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return n})();function CI(n){return typeof n=="number"?n:parseFloat(n)}var u_=(()=>{class n{constructor(){this._validator=ol}ngOnChanges(t){if(this.inputName in t){let r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):ol,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Ge({type:n,features:[mo]})}}return n})();var bI={provide:Ji,useExisting:qt(()=>nh),multi:!0},nh=(()=>{class n extends u_{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=t=>CI(t),this.createValidator=t=>Uv(t)}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,i){r&2&&Nd("min",i._enabled?i.min:null)},inputs:{min:"min"},features:[zt([bI]),_t]})}}return n})(),EI={provide:Ji,useExisting:qt(()=>di),multi:!0};var di=(()=>{class n extends u_{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Ld,this.createValidator=t=>qv}enabled(t){return t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=yr(n)))(i||n)}})()}static{this.\u0275dir=Ge({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,i){r&2&&Nd("required",i._enabled?"":null)},inputs:{required:"required"},features:[zt([EI]),_t]})}}return n})();var d_=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=gr({type:n})}static{this.\u0275inj=mr({})}}return n})(),Wd=class extends Qi{constructor(e,t,r){super(Yd(t),Jd(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){Xv(this,!1,e),e.forEach((r,i)=>{Jv(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function Lv(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var h_=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,r=null){let i=this._reduceControls(t),s={};return Lv(r)?s=r:r!==null&&(s.validators=r.validator,s.asyncValidators=r.asyncValidator),new Yi(i,s)}record(t,r=null){let i=this._reduceControls(t);return new $d(i,r)}control(t,r,i){let s={};return this.useNonNullable?(Lv(r)?s=r:(s.validators=r,s.asyncValidators=i),new Do(t,Ot(vt({},s),{nonNullable:!0}))):new Do(t,r,i)}array(t,r,i){let s=t.map(o=>this._createControl(o));return new Wd(s,r,i)}_reduceControls(t){let r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){if(t instanceof Do)return t;if(t instanceof Qi)return t;if(Array.isArray(t)){let r=t[0],i=t.length>1?t[1]:null,s=t.length>2?t[2]:null;return this.control(r,i,s)}else return this.control(t)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Tn=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:ko,useValue:t.callSetDisabledState??gl}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=gr({type:n})}static{this.\u0275inj=mr({imports:[d_]})}}return n})(),f_=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:s_,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:ko,useValue:t.callSetDisabledState??gl}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=gr({type:n})}static{this.\u0275inj=mr({imports:[d_]})}}return n})();var Zi=class n{constructor(e){this.http=e}categoryUrl="https://dummyjson.com/products/category-list";productSearchUrl="https://dummyjson.com/products/search?q=";getCategories(){return this.http.get(this.categoryUrl)}getProductsByCategory(e){return this.http.get(`https://dummyjson.com/products/category/${e}`)}static \u0275fac=function(t){return new(t||n)(he(tl))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};var wn=class n{constructor(e){this.http=e}produits=[];searchQuery="https://dummyjson.com/products/";getProduits(){return this.http.get(this.searchQuery)}getCategory(e){return this.http.get(`${this.searchQuery}/category/${e}`)}getProductByKey(e){return this.http.get(`https://dummyjson.com/products/search?q=${e}`)}getProductById(e){let t=this.produits.find(r=>r.id===e);return this.http.get(`${this.searchQuery}/${e}`)}addCommande(e,t,r){}static \u0275fac=function(t){return new(t||n)(he(tl))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};var It=class n{cartItemCountSource=new nn(0);cartItemCount$=this.cartItemCountSource.asObservable();searchKeySource=new nn("");searchKey$=this.searchKeySource.asObservable();selectedCategorySource=new nn("");selectedCategory$=this.selectedCategorySource.asObservable();cartItems=new nn(this.loadCartFromLocalStorage());cartItems$=this.cartItems.asObservable();constructor(){this.updateCartItemCount()}addProductToCart(e){let t=this.cartItems.value,r=t.findIndex(i=>i.produit.id===e.produit.id);r>-1?t[r].quantite+=1:t.push(e),this.cartItems.next(t),this.saveCartToLocalStorage(t),this.updateCartItemCount()}getCartItems(){return this.cartItems.value}updateCartItemCount(){let e=this.cartItems.value.reduce((t,r)=>t+r.quantite,0);this.cartItemCountSource.next(e)}saveCartToLocalStorage(e){this.isLocalStorageAvailable()&&localStorage.setItem("cartItems",JSON.stringify(e))}loadCartFromLocalStorage(){if(this.isLocalStorageAvailable()){let e=localStorage.getItem("cartItems");return e?JSON.parse(e):[]}return[]}clearCart(){this.cartItems.next([]),this.isLocalStorageAvailable()&&localStorage.removeItem("cartItems"),this.updateCartItemCount()}isLocalStorageAvailable(){try{let e="__test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}setSearchKey(e){this.searchKeySource.next(e)}setSelectedCategory(e){this.selectedCategorySource.next(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};var II="firebase",AI="10.14.1";St(II,AI,"app");var on=new Pd("ANGULARFIRE2_VERSION");function sh(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var No=(n,e)=>{let t=e?[e]:il(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Er=class{constructor(){return No(DI)}},DI="app-check";function es(){}var vl=class{zone;delegate;constructor(e,t=Yy){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},ih=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",es,{},es,es)),t.pipe(ev({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},fi=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new vl(Zone.current)),this.insideAngular=t.run(()=>new vl(Zone.current,Qy)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(he(bn))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function _l(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function RI(n){return _l().ngZone.runOutsideAngular(()=>n())}function hi(n){return _l().ngZone.run(()=>n())}function oh(n){return kI(_l())(n)}function kI(n){return function(t){return t=t.lift(new ih(n.ngZone)),t.pipe(ii(n.outsideAngular),pr(n.insideAngular))}}var xI=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),hi(()=>n.apply(void 0,r))},an=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=hi(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",es,{},es,es))),r[s]=xI(r[s],t));let i=RI(()=>n.apply(this,r));if(!e)if(i instanceof fr){let s=_l();return i.pipe(ii(s.outsideAngular),pr(s.insideAngular))}else return hi(()=>i);return i instanceof fr?i.pipe(oh):i instanceof Promise?hi(()=>new Promise((s,o)=>i.then(a=>hi(()=>s(a)),a=>hi(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:hi(()=>i)};var pi=class{constructor(e){return e}},Oo=class{constructor(){return il()}};function OI(n){return n&&n.length===1?n[0]:new pi(bo())}var ah=new Pe("angularfire2._apps"),MI={provide:pi,useFactory:OI,deps:[[new Cn,ah]]},PI={provide:Oo,deps:[[new Cn,ah]]};function FI(n){return(e,t)=>{let r=t.get(zi);St("angularfire",on.full,"core"),St("angularfire",on.full,"app"),St("angular",Za.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new pi(i)}}function p_(n,...e){return ja([MI,PI,{provide:ah,useFactory:FI(n),multi:!0,deps:[bn,go,fi,...e]}])}var LI=new Map,VI={activated:!1,tokenObservers:[]},BI={initialized:!1,enabled:!1};function ln(n){return LI.get(n)||Object.assign({},VI)}function __(){return BI}var UI="https://content-firebaseappcheck.googleapis.com/v1";var qI="exchangeDebugToken",m_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},qq=24*60*60*1e3;var ch=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return R(this,null,function*(){this.stop();try{this.pending=new Bd,this.pending.promise.catch(t=>{}),yield zI(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Bd,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function zI(n){return new Promise(e=>{setTimeout(e,n)})}var GI={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Tr=new Av("appCheck","AppCheck",GI);function S_(n){if(!ln(n).activated)throw Tr.create("use-before-activation",{appName:n.name})}function C_(r,i){return R(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let S=yield o.getHeartbeatsHeader();S&&(s["X-Firebase-Client"]=S)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(S){throw Tr.create("fetch-network-error",{originalErrorMessage:S?.message})}if(l.status!==200)throw Tr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(S){throw Tr.create("fetch-parse-error",{originalErrorMessage:S?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Tr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let p=Number(u[1])*1e3,m=Date.now();return{token:c.token,expireTimeMillis:m+p,issuedAtTimeMillis:m}})}function b_(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${UI}/projects/${t}/apps/${r}:${qI}?key=${i}`,body:{debug_token:e}}}var jI="firebase-app-check-database",$I=1,uh="firebase-app-check-store";var Sl=null;function WI(){return Sl||(Sl=new Promise((n,e)=>{try{let t=indexedDB.open(jI,$I);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Tr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(uh,{keyPath:"compositeKey"})}}}catch(t){e(Tr.create("storage-open",{originalErrorMessage:t?.message}))}}),Sl)}function KI(n,e){return HI(QI(n),e)}function HI(n,e){return R(this,null,function*(){let r=(yield WI()).transaction(uh,"readwrite"),s=r.objectStore(uh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Tr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function QI(n){return`${n.options.appId}-${n.name}`}var dh=new rl("@firebase/app-check");function lh(n,e){return Ud()?KI(n,e).catch(t=>{dh.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function E_(){return __().enabled}function T_(){return R(this,null,function*(){let n=__();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var YI={error:"UNKNOWN_ERROR"};function JI(n){return Cv.encodeString(JSON.stringify(n),!1)}function hh(n,e=!1){return R(this,null,function*(){let t=n.app;S_(t);let r=ln(t),i=r.token,s;if(i&&!Mo(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Mo(l)?i=l:yield lh(t,void 0))}if(!e&&i&&Mo(i))return{token:i.token};let o=!1;if(E_()){r.exchangeTokenPromise||(r.exchangeTokenPromise=C_(b_(t,yield T_()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield lh(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield ln(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?dh.warn(l.message):dh.error(l),s=l}let a;return i?s?Mo(i)?a={token:i.token,internalError:s}:a=y_(s):(a={token:i.token},r.token=i,yield lh(t,i)):a=y_(s),o&&tA(t,a),a})}function XI(n){return R(this,null,function*(){let e=n.app;S_(e);let{provider:t}=ln(e);if(E_()){let r=yield T_(),{token:i}=yield C_(b_(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function ZI(n,e,t,r){let{app:i}=n,s=ln(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Mo(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),g_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>g_(n))}function w_(n,e){let t=ln(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function g_(n){let{app:e}=n,t=ln(e),r=t.tokenRefresher;r||(r=eA(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function eA(n){let{app:e}=n;return new ch(()=>R(this,null,function*(){let t=ln(e),r;if(t.token?r=yield hh(n,!0):r=yield hh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=ln(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},m_.RETRIAL_MIN_WAIT,m_.RETRIAL_MAX_WAIT)}function tA(n,e){let t=ln(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Mo(n){return n.expireTimeMillis-Date.now()>0}function y_(n){return{token:JI(YI),error:n}}var fh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ln(this.app);for(let t of e)w_(this.app,t.next);return Promise.resolve()}};function nA(n,e){return new fh(n,e)}function rA(n){return{getToken:e=>hh(n,e),getLimitedUseToken:()=>XI(n),addTokenListener:e=>ZI(n,"INTERNAL",e),removeTokenListener:e=>w_(n.app,e)}}var iA="@firebase/app-check",sA="0.8.8";var oA="app-check",v_="app-check-internal";function aA(){Co(new So(oA,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return nA(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(v_).initialize()})),Co(new So(v_,n=>{let e=n.getProvider("app-check").getImmediate();return rA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),St(iA,sA)}aA();var lA=["localhost","0.0.0.0","127.0.0.1"],Zq=typeof window<"u"&&lA.includes(window.location.hostname);var uA="firebase",dA="10.14.1";Pt.registerVersion(uA,dA,"app-compat");var hA=["ngOnDestroy"],A_=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(hA.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let p=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,p),p})})})});var Cl=class{constructor(e){return e}},bl=new Pe("angularfire2.app.options"),El=new Pe("angularfire2.app.name");function ph(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Pt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Pt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;fA("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Cl(o)}var fA=(n,...e)=>{Fd()&&typeof console<"u"&&console[n](...e)},pA={provide:Cl,useFactory:ph,deps:[bl,bn,[new Cn,El]]},D_=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:bl,useValue:t},{provide:El,useValue:r}]}}constructor(t){Pt.registerVersion("angularfire",on.full,"core"),Pt.registerVersion("angularfire",on.full,"app-compat"),Pt.registerVersion("angular",Za.full,t.toString())}static \u0275fac=function(r){return new(r||n)(he(zi))};static \u0275mod=gr({type:n});static \u0275inj=mr({providers:[pA]})}return n})();function R_(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return mA(i,o)||(I_("error",`${e} was already initialized on the ${t} Firebase App with different settings.${gA?" You may need to reload as Firebase is not HMR aware.":""}`),I_("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function mA(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var gA=typeof module<"u"&&!!module.hot,I_=(n,...e)=>{Fd()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var yA=new Pe("angularfire2.auth.use-emulator"),vA=new Pe("angularfire2.auth.settings"),_A=new Pe("angularfire2.auth.tenant-id"),SA=new Pe("angularfire2.auth.langugage-code"),CA=new Pe("angularfire2.auth.use-device-language"),bA=new Pe("angularfire.auth.persistence"),EA=(n,e,t,r,i,s,o,a)=>R_(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Po=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,p,m,S){let E=new za,T=po(void 0).pipe(pr(o.outsideAngular),si(()=>s.runOutsideAngular(()=>import("./chunk-7TJ6ZNCT.mjs"))),Mt(()=>ph(t,s,r)),Mt(b=>EA(b,s,a,c,u,p,l,m)),kd({bufferSize:1,refCount:!1}));if(hv(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=po(null);else{T.pipe(Zy()).subscribe();let b=T.pipe(si(M=>M.getRedirectResult().then(P=>P,()=>null)),oh,kd({bufferSize:1,refCount:!1})),O=T.pipe(si(M=>new fr(P=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(j=>P.next(j),j=>P.error(j),()=>P.complete()))})))),D=T.pipe(si(M=>new fr(P=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(j=>P.next(j),j=>P.error(j),()=>P.complete()))}))));this.authState=b.pipe(xd(O),ii(o.outsideAngular),pr(o.insideAngular)),this.user=b.pipe(xd(D),ii(o.outsideAngular),pr(o.insideAngular)),this.idToken=this.user.pipe(si(M=>M?qi(M.getIdToken()):po(null))),this.idTokenResult=this.user.pipe(si(M=>M?qi(M.getIdTokenResult()):po(null))),this.credential=Xy(b,E,this.authState.pipe(Rd(M=>!M))).pipe(Mt(M=>M?.user?M:null),ii(o.outsideAngular),pr(o.insideAngular))}return A_(this,T,s,{spy:{apply:(b,O,D)=>{(b.startsWith("signIn")||b.startsWith("createUser"))&&D.then(M=>E.next(M))}}})}static \u0275fac=function(r){return new(r||n)(he(bl),he(El,8),he(zi),he(bn),he(fi),he(yA,8),he(vA,8),he(_A,8),he(SA,8),he(CA,8),he(bA,8),he(Er,8))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),k_=(()=>{class n{constructor(){Pt.registerVersion("angularfire",on.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=gr({type:n});static \u0275inj=mr({providers:[Po]})}return n})();var Ye=class n{constructor(e){this.auth=e;if(this.isBrowser()){let t=localStorage.getItem("user");t&&this.userSubject.next(JSON.parse(t));let r=localStorage.getItem("isAuth");r&&this.isAuth.next(JSON.parse(r))}}isAuth=new nn(!1);isAuth$=this.isAuth.asObservable();defaultUser={name:"EL MEJBAR Otmane",email:"elmejbarotmane@gmail.com",password:"123456",profilePicture:"assets/default-profile.png"};userSubject=new nn(this.defaultUser);user$=this.userSubject.asObservable();login(e,t){return this.isAuth.next(!0),this.auth.signInWithEmailAndPassword(e,t)}signup(e,t){return this.auth.createUserWithEmailAndPassword(e,t)}logout(){return this.isAuth.next(!1),this.auth.signOut()}isLoggedIn(){return this.isAuth.value}getUser(){return this.userSubject.value}updateUser(e){this.userSubject.next(e),this.isBrowser()&&localStorage.setItem("user",JSON.stringify(e))}isBrowser(){return typeof window<"u"&&typeof localStorage<"u"}getUserId(){return R(this,null,function*(){let e=yield this.auth.currentUser;return e?e.uid:null})}static \u0275fac=function(t){return new(t||n)(he(Po))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};function wA(n,e){if(n&1){let t=Ke();I(0,"button",21),ie("click",function(){Se(t);let i=me();return Ce(i.signIn())}),L(1," Sign in "),w()}}function IA(n,e){if(n&1){let t=Ke();I(0,"button",21),ie("click",function(){Se(t);let i=me();return Ce(i.signOut())}),L(1," Sign Out "),w()}}function AA(n,e){if(n&1&&pe(0,"option",22),n&2){let t=e.$implicit;X("value",t.name)}}function DA(n,e){if(n&1&&(I(0,"option",22),L(1),w()),n&2){let t=e.$implicit;X("value",t),B(),ot(" ",t," ")}}var Tl=class n{constructor(e,t,r,i,s){this.categoryService=e;this.productService=t;this.sharedService=r;this.router=i;this.auth=s}categories=[];selectedCategory="";products=[];filteredProducts=[];searchKey="";loggedIn=!1;signIn(){this.router.navigate(["/signin"])}signOut(){this.auth.logout(),this.router.navigate(["/"])}ngOnInit(){this.categoryService.getCategories().subscribe(e=>{this.categories=e}),this.productService.getProduits().subscribe(e=>{this.products=e.products}),this.auth.isAuth$.subscribe(e=>{this.loggedIn=e})}onSearchByKey(){this.sharedService.setSearchKey(this.searchKey)}search(){this.sharedService.setSelectedCategory(this.selectedCategory)}static \u0275fac=function(t){return new(t||n)(z(Zi),z(wn),z(It),z(Tt),z(Ye))};static \u0275cmp=ze({type:n,selectors:[["app-navbar"]],standalone:!0,features:[je],decls:35,vars:5,consts:[[1,"navbar","navbar-dark","bg-primary"],[1,"container-fluid"],["href","#",1,"navbar-brand"],[1,"navbar-nav","d-flex","flex-row","me-auto"],[1,"nav-item"],["routerLink","/",1,"nav-link","active"],[1,"nav-item","ms-3"],["href","#",1,"nav-link"],["routerLink","/panier",1,"nav-link"],["aria-hidden","true",1,"fa","fa-shopping-cart","ms-1"],["routerLink","/commandes",1,"nav-link"],["routerLink","/profile",1,"nav-link"],["aria-hidden","true",1,"fa","fa-user","ms-1"],["type","button",1,"btn","btn-outline-light"],[1,"d-flex","align-items-center"],[1,"search-container","position-relative","me-2"],["type","text","list","productSuggestions","placeholder","Rechercher des produits","aria-label","Search","name","searchKey",1,"form-control",3,"ngModelChange","ngModel"],[1,"fa","fa-magnifying-glass","position-absolute","end-0","top-50","translate-middle-y","text-light","me-2"],["id","productSuggestions"],[3,"value",4,"ngFor","ngForOf"],["name","selectedCategory",1,"form-control","me-2",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-outline-light",3,"click"],[3,"value"]],template:function(t,r){t&1&&(I(0,"nav",0)(1,"div",1)(2,"a",2),L(3,"ECOM"),w(),I(4,"ul",3)(5,"li",4)(6,"a",5),L(7,"Accueil"),w()(),I(8,"li",6)(9,"a",7),L(10,"Page 1"),w()(),I(11,"li",6)(12,"a",8),L(13," Panier "),pe(14,"i",9),w()(),I(15,"li",6)(16,"a",10),L(17," Mes commandes "),pe(18,"i",9),w()(),I(19,"li",6)(20,"a",11),L(21," Profile "),pe(22,"i",12),w()()(),Fe(23,wA,2,0,"button",13)(24,IA,2,0,"button",13),I(25,"form",14)(26,"div",15)(27,"input",16),ct("ngModelChange",function(s){return lt(r.searchKey,s)||(r.searchKey=s),s}),ie("ngModelChange",function(){return r.onSearchByKey()}),w(),pe(28,"i",17),I(29,"datalist",18),Fe(30,AA,1,1,"option",19),w()(),I(31,"select",20),ct("ngModelChange",function(s){return lt(r.selectedCategory,s)||(r.selectedCategory=s),s}),Fe(32,DA,2,2,"option",19),w(),I(33,"button",21),ie("click",function(){return r.search()}),L(34," Rechercher "),w()()()()),t&2&&(B(23),Wa(r.loggedIn?24:23),B(4),at("ngModel",r.searchKey),B(3),X("ngForOf",r.filteredProducts),B(),at("ngModel",r.selectedCategory),B(),X("ngForOf",r.categories))},dependencies:[Tn,br,a_,c_,wt,yl,Gt,Cr,sn,ui,nl,$i],styles:[".navbar[_ngcontent-%COMP%]{background-color:#007bff;padding:1rem 1.5rem}.navbar-brand[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff}.navbar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#fff;margin-right:1.5rem;font-size:1.1rem;transition:color .3s ease}.navbar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover, .navbar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fc0}.fa-shopping-cart[_ngcontent-%COMP%]{margin-right:5px;font-size:1.5rem;vertical-align:middle;color:#fff}.badge.bg-danger[_ngcontent-%COMP%]{vertical-align:top;margin-left:5px;font-size:.85rem}.search-container[_ngcontent-%COMP%]{position:relative;max-width:250px}.search-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:2rem;border-radius:30px;border:2px solid #fff}.search-container[_ngcontent-%COMP%]   i.fa-magnifying-glass[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:1.2rem}.form-control[_ngcontent-%COMP%]:focus{border-color:#fc0;box-shadow:0 0 8px #ffcc0080}select.form-control[_ngcontent-%COMP%]{width:auto;border-radius:30px;background-color:#fff;color:#007bff}select.form-control[_ngcontent-%COMP%]:focus{border-color:#fc0}.btn-outline-light[_ngcontent-%COMP%]{color:#fff;border-color:#fff;transition:background-color .3s ease,color .3s ease}.btn-outline-light[_ngcontent-%COMP%]:hover{background-color:#fc0;color:#000}"]})};var wl=class n{title="ecom-app";constructor(){}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=ze({type:n,selectors:[["app-root"]],standalone:!0,features:[je],decls:2,vars:0,template:function(t,r){t&1&&pe(0,"app-navbar")(1,"router-outlet")},dependencies:[_v,Tl]})};var Il=class{produit;quantite;constructor(e,t){this.produit=e,this.quantite=t}};var RA=n=>({color:n});function kA(n,e){if(n&1){let t=Ke();I(0,"a",10),ie("click",function(i){Se(t);let s=me();return Ce(s.addToPanier(i))}),L(1,"Add To Panier"),w()}}var Al=class n{constructor(e,t){this.sharedService=e;this.router=t}product;addToPanier(e){e.stopPropagation();let t=new Il(this.product,1);this.sharedService.addProductToCart(t)}getColor(){return this.product.stock>0?"green":"red"}getState(){return this.product.stock>0?"En stock":"En rupture de stock"}onComponentClick(e){this.router.navigate(["/product",e])}static \u0275fac=function(t){return new(t||n)(z(It),z(Tt))};static \u0275cmp=ze({type:n,selectors:[["app-product-item"]],inputs:{product:"product"},standalone:!0,features:[je],decls:14,vars:10,consts:[[1,"clickable-component",3,"click"],[1,"card","h-100","shadow-sm"],[1,"card-img-top","img-fluid","card-img-custom",3,"src","alt"],[1,"card-body","d-flex","flex-column"],[1,"card-title"],[1,"card-text"],[1,"card-title","mt-auto"],[1,"d-flex","justify-content-between","align-items-center"],[3,"ngStyle"],[1,"btn","btn-primary"],[1,"btn","btn-primary",3,"click"]],template:function(t,r){t&1&&(I(0,"div",0),ie("click",function(){return r.onComponentClick(r.product.id)}),I(1,"div",1),pe(2,"img",2),I(3,"div",3)(4,"h5",4),L(5),w(),I(6,"p",5),L(7),w(),I(8,"h5",6),L(9),w(),I(10,"div",7)(11,"span",8),L(12),w(),Fe(13,kA,2,0,"a",9),w()()()()),t&2&&(B(2),Ya("alt",r.product.title),X("src",r.product.images[0],En),B(3),rt(r.product.title),B(2),rt(r.product.description),B(2),ot("",r.product.price," $"),B(2),X("ngStyle",ai(8,RA,r.getColor())),B(),rt(r.getState()),B(),Wa(r.product.stock>0?13:-1))},dependencies:[el],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:10px;transition:transform .3s,box-shadow .3s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 4px 20px #0003}.card-img-custom[_ngcontent-%COMP%]{border-top-left-radius:10px;border-top-right-radius:10px;width:100%;height:200px;object-fit:cover}.card-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600}.card-text[_ngcontent-%COMP%]{font-size:.9rem;color:#555}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;border:none;transition:background-color .3s}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}@media (max-width: 576px){.card-title[_ngcontent-%COMP%]{font-size:1.1rem}.card-text[_ngcontent-%COMP%]{font-size:.85rem}}"]})};function xA(n,e){if(n&1&&(I(0,"div",3),pe(1,"app-product-item",4),w()),n&2){let t=e.$implicit;B(),X("product",t)}}var Dl=class n{constructor(e,t){this.produitService=e;this.sharedService=t}items=[];produits=[];ngOnInit(){this.produitService.getProduits().subscribe(e=>{this.produits=e.products}),this.sharedService.searchKey$.subscribe(e=>{e&&this.onSearchedText(e)}),this.sharedService.selectedCategory$.subscribe(e=>{e&&this.onSearch(e)})}onSearch(e){this.produitService.getCategory(e).subscribe(t=>{this.produits=t.products})}onSearchedText(e){this.produitService.getProductByKey(e).subscribe(t=>{this.produits=t.products})}getCartItemCount(){return this.items.reduce((e,t)=>e+t.quantite,0)}static \u0275fac=function(t){return new(t||n)(z(wn),z(It))};static \u0275cmp=ze({type:n,selectors:[["app-list-produits"]],standalone:!0,features:[je],decls:7,vars:0,consts:[[1,"container","text-center","mt-5","py-5"],[1,"mx-auto"],[1,"row","row-cols-1","row-cols-md-4","g-4"],[1,"col"],[3,"product"]],template:function(t,r){t&1&&(I(0,"div",0)(1,"h3"),L(2,"Our Products"),w(),pe(3,"hr",1),w(),I(4,"div",2),Ha(5,xA,2,1,"div",3,Ka),w()),t&2&&(B(5),Qa(r.produits))},dependencies:[Al],styles:[".card-img-custom[_ngcontent-%COMP%]{height:200px;object-fit:cover}.card[_ngcontent-%COMP%]{height:100%}"]})};var b4=Dd(zw(),1);var ND="auth";var Rl=class{constructor(){return No(ND)}};import{inspect as GP,TextEncoder as jP,TextDecoder as H6}from"util";import{randomBytes as $P}from"crypto";var x_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N_={};var wr,mh;(function(){var n;function e(_,g){function y(){}y.prototype=g.prototype,_.D=g.prototype,_.prototype=new y,_.prototype.constructor=_,_.C=function(v,h,C){for(var d=Array(arguments.length-2),f=2;f<arguments.length;f++)d[f-2]=arguments[f];return g.prototype[h].apply(v,d)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(_,g,y){y||(y=0);var v=Array(16);if(typeof g=="string")for(var h=0;16>h;++h)v[h]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(h=0;16>h;++h)v[h]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=_.g[0],y=_.g[1],h=_.g[2];var C=_.g[3],d=g+(C^y&(h^C))+v[0]+3614090360&4294967295;g=y+(d<<7&4294967295|d>>>25),d=C+(h^g&(y^h))+v[1]+3905402710&4294967295,C=g+(d<<12&4294967295|d>>>20),d=h+(y^C&(g^y))+v[2]+606105819&4294967295,h=C+(d<<17&4294967295|d>>>15),d=y+(g^h&(C^g))+v[3]+3250441966&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(C^y&(h^C))+v[4]+4118548399&4294967295,g=y+(d<<7&4294967295|d>>>25),d=C+(h^g&(y^h))+v[5]+1200080426&4294967295,C=g+(d<<12&4294967295|d>>>20),d=h+(y^C&(g^y))+v[6]+2821735955&4294967295,h=C+(d<<17&4294967295|d>>>15),d=y+(g^h&(C^g))+v[7]+4249261313&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(C^y&(h^C))+v[8]+1770035416&4294967295,g=y+(d<<7&4294967295|d>>>25),d=C+(h^g&(y^h))+v[9]+2336552879&4294967295,C=g+(d<<12&4294967295|d>>>20),d=h+(y^C&(g^y))+v[10]+4294925233&4294967295,h=C+(d<<17&4294967295|d>>>15),d=y+(g^h&(C^g))+v[11]+2304563134&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(C^y&(h^C))+v[12]+1804603682&4294967295,g=y+(d<<7&4294967295|d>>>25),d=C+(h^g&(y^h))+v[13]+4254626195&4294967295,C=g+(d<<12&4294967295|d>>>20),d=h+(y^C&(g^y))+v[14]+2792965006&4294967295,h=C+(d<<17&4294967295|d>>>15),d=y+(g^h&(C^g))+v[15]+1236535329&4294967295,y=h+(d<<22&4294967295|d>>>10),d=g+(h^C&(y^h))+v[1]+4129170786&4294967295,g=y+(d<<5&4294967295|d>>>27),d=C+(y^h&(g^y))+v[6]+3225465664&4294967295,C=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(C^g))+v[11]+643717713&4294967295,h=C+(d<<14&4294967295|d>>>18),d=y+(C^g&(h^C))+v[0]+3921069994&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(h^C&(y^h))+v[5]+3593408605&4294967295,g=y+(d<<5&4294967295|d>>>27),d=C+(y^h&(g^y))+v[10]+38016083&4294967295,C=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(C^g))+v[15]+3634488961&4294967295,h=C+(d<<14&4294967295|d>>>18),d=y+(C^g&(h^C))+v[4]+3889429448&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(h^C&(y^h))+v[9]+568446438&4294967295,g=y+(d<<5&4294967295|d>>>27),d=C+(y^h&(g^y))+v[14]+3275163606&4294967295,C=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(C^g))+v[3]+4107603335&4294967295,h=C+(d<<14&4294967295|d>>>18),d=y+(C^g&(h^C))+v[8]+1163531501&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(h^C&(y^h))+v[13]+2850285829&4294967295,g=y+(d<<5&4294967295|d>>>27),d=C+(y^h&(g^y))+v[2]+4243563512&4294967295,C=g+(d<<9&4294967295|d>>>23),d=h+(g^y&(C^g))+v[7]+1735328473&4294967295,h=C+(d<<14&4294967295|d>>>18),d=y+(C^g&(h^C))+v[12]+2368359562&4294967295,y=h+(d<<20&4294967295|d>>>12),d=g+(y^h^C)+v[5]+4294588738&4294967295,g=y+(d<<4&4294967295|d>>>28),d=C+(g^y^h)+v[8]+2272392833&4294967295,C=g+(d<<11&4294967295|d>>>21),d=h+(C^g^y)+v[11]+1839030562&4294967295,h=C+(d<<16&4294967295|d>>>16),d=y+(h^C^g)+v[14]+4259657740&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(y^h^C)+v[1]+2763975236&4294967295,g=y+(d<<4&4294967295|d>>>28),d=C+(g^y^h)+v[4]+1272893353&4294967295,C=g+(d<<11&4294967295|d>>>21),d=h+(C^g^y)+v[7]+4139469664&4294967295,h=C+(d<<16&4294967295|d>>>16),d=y+(h^C^g)+v[10]+3200236656&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(y^h^C)+v[13]+681279174&4294967295,g=y+(d<<4&4294967295|d>>>28),d=C+(g^y^h)+v[0]+3936430074&4294967295,C=g+(d<<11&4294967295|d>>>21),d=h+(C^g^y)+v[3]+3572445317&4294967295,h=C+(d<<16&4294967295|d>>>16),d=y+(h^C^g)+v[6]+76029189&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(y^h^C)+v[9]+3654602809&4294967295,g=y+(d<<4&4294967295|d>>>28),d=C+(g^y^h)+v[12]+3873151461&4294967295,C=g+(d<<11&4294967295|d>>>21),d=h+(C^g^y)+v[15]+530742520&4294967295,h=C+(d<<16&4294967295|d>>>16),d=y+(h^C^g)+v[2]+3299628645&4294967295,y=h+(d<<23&4294967295|d>>>9),d=g+(h^(y|~C))+v[0]+4096336452&4294967295,g=y+(d<<6&4294967295|d>>>26),d=C+(y^(g|~h))+v[7]+1126891415&4294967295,C=g+(d<<10&4294967295|d>>>22),d=h+(g^(C|~y))+v[14]+2878612391&4294967295,h=C+(d<<15&4294967295|d>>>17),d=y+(C^(h|~g))+v[5]+4237533241&4294967295,y=h+(d<<21&4294967295|d>>>11),d=g+(h^(y|~C))+v[12]+1700485571&4294967295,g=y+(d<<6&4294967295|d>>>26),d=C+(y^(g|~h))+v[3]+2399980690&4294967295,C=g+(d<<10&4294967295|d>>>22),d=h+(g^(C|~y))+v[10]+4293915773&4294967295,h=C+(d<<15&4294967295|d>>>17),d=y+(C^(h|~g))+v[1]+2240044497&4294967295,y=h+(d<<21&4294967295|d>>>11),d=g+(h^(y|~C))+v[8]+1873313359&4294967295,g=y+(d<<6&4294967295|d>>>26),d=C+(y^(g|~h))+v[15]+4264355552&4294967295,C=g+(d<<10&4294967295|d>>>22),d=h+(g^(C|~y))+v[6]+2734768916&4294967295,h=C+(d<<15&4294967295|d>>>17),d=y+(C^(h|~g))+v[13]+1309151649&4294967295,y=h+(d<<21&4294967295|d>>>11),d=g+(h^(y|~C))+v[4]+4149444226&4294967295,g=y+(d<<6&4294967295|d>>>26),d=C+(y^(g|~h))+v[11]+3174756917&4294967295,C=g+(d<<10&4294967295|d>>>22),d=h+(g^(C|~y))+v[2]+718787259&4294967295,h=C+(d<<15&4294967295|d>>>17),d=y+(C^(h|~g))+v[9]+3951481745&4294967295,_.g[0]=_.g[0]+g&4294967295,_.g[1]=_.g[1]+(h+(d<<21&4294967295|d>>>11))&4294967295,_.g[2]=_.g[2]+h&4294967295,_.g[3]=_.g[3]+C&4294967295}r.prototype.u=function(_,g){g===void 0&&(g=_.length);for(var y=g-this.blockSize,v=this.B,h=this.h,C=0;C<g;){if(h==0)for(;C<=y;)i(this,_,C),C+=this.blockSize;if(typeof _=="string"){for(;C<g;)if(v[h++]=_.charCodeAt(C++),h==this.blockSize){i(this,v),h=0;break}}else for(;C<g;)if(v[h++]=_[C++],h==this.blockSize){i(this,v),h=0;break}}this.h=h,this.o+=g},r.prototype.v=function(){var _=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);_[0]=128;for(var g=1;g<_.length-8;++g)_[g]=0;var y=8*this.o;for(g=_.length-8;g<_.length;++g)_[g]=y&255,y/=256;for(this.u(_),_=Array(16),g=y=0;4>g;++g)for(var v=0;32>v;v+=8)_[y++]=this.g[g]>>>v&255;return _};function s(_,g){var y=a;return Object.prototype.hasOwnProperty.call(y,_)?y[_]:y[_]=g(_)}function o(_,g){this.h=g;for(var y=[],v=!0,h=_.length-1;0<=h;h--){var C=_[h]|0;v&&C==g||(y[h]=C,v=!1)}this.g=y}var a={};function l(_){return-128<=_&&128>_?s(_,function(g){return new o([g|0],0>g?-1:0)}):new o([_|0],0>_?-1:0)}function c(_){if(isNaN(_)||!isFinite(_))return p;if(0>_)return b(c(-_));for(var g=[],y=1,v=0;_>=y;v++)g[v]=_/y|0,y*=4294967296;return new o(g,0)}function u(_,g){if(_.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(_.charAt(0)=="-")return b(u(_.substring(1),g));if(0<=_.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),v=p,h=0;h<_.length;h+=8){var C=Math.min(8,_.length-h),d=parseInt(_.substring(h,h+C),g);8>C?(C=c(Math.pow(g,C)),v=v.j(C).add(c(d))):(v=v.j(y),v=v.add(c(d)))}return v}var p=l(0),m=l(1),S=l(16777216);n=o.prototype,n.m=function(){if(T(this))return-b(this).m();for(var _=0,g=1,y=0;y<this.g.length;y++){var v=this.i(y);_+=(0<=v?v:4294967296+v)*g,g*=4294967296}return _},n.toString=function(_){if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E(this))return"0";if(T(this))return"-"+b(this).toString(_);for(var g=c(Math.pow(_,6)),y=this,v="";;){var h=P(y,g).g;y=O(y,h.j(g));var C=((0<y.g.length?y.g[0]:y.h)>>>0).toString(_);if(y=h,E(y))return C+v;for(;6>C.length;)C="0"+C;v=C+v}},n.i=function(_){return 0>_?0:_<this.g.length?this.g[_]:this.h};function E(_){if(_.h!=0)return!1;for(var g=0;g<_.g.length;g++)if(_.g[g]!=0)return!1;return!0}function T(_){return _.h==-1}n.l=function(_){return _=O(this,_),T(_)?-1:E(_)?0:1};function b(_){for(var g=_.g.length,y=[],v=0;v<g;v++)y[v]=~_.g[v];return new o(y,~_.h).add(m)}n.abs=function(){return T(this)?b(this):this},n.add=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0,h=0;h<=g;h++){var C=v+(this.i(h)&65535)+(_.i(h)&65535),d=(C>>>16)+(this.i(h)>>>16)+(_.i(h)>>>16);v=d>>>16,C&=65535,d&=65535,y[h]=d<<16|C}return new o(y,y[y.length-1]&-2147483648?-1:0)};function O(_,g){return _.add(b(g))}n.j=function(_){if(E(this)||E(_))return p;if(T(this))return T(_)?b(this).j(b(_)):b(b(this).j(_));if(T(_))return b(this.j(b(_)));if(0>this.l(S)&&0>_.l(S))return c(this.m()*_.m());for(var g=this.g.length+_.g.length,y=[],v=0;v<2*g;v++)y[v]=0;for(v=0;v<this.g.length;v++)for(var h=0;h<_.g.length;h++){var C=this.i(v)>>>16,d=this.i(v)&65535,f=_.i(h)>>>16,U=_.i(h)&65535;y[2*v+2*h]+=d*U,D(y,2*v+2*h),y[2*v+2*h+1]+=C*U,D(y,2*v+2*h+1),y[2*v+2*h+1]+=d*f,D(y,2*v+2*h+1),y[2*v+2*h+2]+=C*f,D(y,2*v+2*h+2)}for(v=0;v<g;v++)y[v]=y[2*v+1]<<16|y[2*v];for(v=g;v<2*g;v++)y[v]=0;return new o(y,0)};function D(_,g){for(;(_[g]&65535)!=_[g];)_[g+1]+=_[g]>>>16,_[g]&=65535,g++}function M(_,g){this.g=_,this.h=g}function P(_,g){if(E(g))throw Error("division by zero");if(E(_))return new M(p,p);if(T(_))return g=P(b(_),g),new M(b(g.g),b(g.h));if(T(g))return g=P(_,b(g)),new M(b(g.g),g.h);if(30<_.g.length){if(T(_)||T(g))throw Error("slowDivide_ only works with positive integers.");for(var y=m,v=g;0>=v.l(_);)y=j(y),v=j(v);var h=Q(y,1),C=Q(v,1);for(v=Q(v,2),y=Q(y,2);!E(v);){var d=C.add(v);0>=d.l(_)&&(h=h.add(y),C=d),v=Q(v,1),y=Q(y,1)}return g=O(_,h.j(g)),new M(h,g)}for(h=p;0<=_.l(g);){for(y=Math.max(1,Math.floor(_.m()/g.m())),v=Math.ceil(Math.log(y)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),C=c(y),d=C.j(g);T(d)||0<d.l(_);)y-=v,C=c(y),d=C.j(g);E(C)&&(C=m),h=h.add(C),_=O(_,d)}return new M(h,_)}n.A=function(_){return P(this,_).h},n.and=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)&_.i(v);return new o(y,this.h&_.h)},n.or=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)|_.i(v);return new o(y,this.h|_.h)},n.xor=function(_){for(var g=Math.max(this.g.length,_.g.length),y=[],v=0;v<g;v++)y[v]=this.i(v)^_.i(v);return new o(y,this.h^_.h)};function j(_){for(var g=_.g.length+1,y=[],v=0;v<g;v++)y[v]=_.i(v)<<1|_.i(v-1)>>>31;return new o(y,_.h)}function Q(_,g){var y=g>>5;g%=32;for(var v=_.g.length-y,h=[],C=0;C<v;C++)h[C]=0<g?_.i(C+y)>>>g|_.i(C+y+1)<<32-g:_.i(C+y);return new o(h,_.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,mh=N_.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,wr=N_.Integer=o}).apply(typeof x_<"u"?x_:typeof self<"u"?self:typeof window<"u"?window:{});var Di=Dd(iE(),1),BE=Dd(dp(),1);var sE="@firebase/firestore",oE="4.7.3";var tt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};tt.UNAUTHENTICATED=new tt(null);tt.GOOGLE_CREDENTIALS=new tt("google-credentials-uid");tt.FIRST_PARTY=new tt("first-party-uid");tt.MOCK_USER=new tt("mock-user");var WP="10.14.0";var lo=WP;function KP(n){lo=n}function HP(n){return GP(n,{depth:100})}var Ri=new rl("@firebase/firestore");function ya(){return Ri.logLevel}function W(n,...e){if(Ri.logLevel<=Qn.DEBUG){let t=e.map(_y);Ri.debug(`Firestore (${lo}): ${n}`,...t)}}function _n(n,...e){if(Ri.logLevel<=Qn.ERROR){let t=e.map(_y);Ri.error(`Firestore (${lo}): ${n}`,...t)}}function Ws(n,...e){if(Ri.logLevel<=Qn.WARN){let t=e.map(_y);Ri.warn(`Firestore (${lo}): ${n}`,...t)}}function _y(n){if(typeof n=="string")return n;try{return HP(n)}catch{return n}}function J(n="Unexpected state"){let e=`FIRESTORE (${lo}) INTERNAL ASSERTION FAILED: `+n;throw _n(e),new Error(e)}function ye(n,e){n||J()}function ee(n,e){return n}var N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},H=class extends Iv{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var yn=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Du=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},zm=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tt.UNAUTHENTICATED))}shutdown(){}},Gm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},jm=class{constructor(e){this.authProvider=e,this.currentUser=tt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){ye(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new yn;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new yn,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>R(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{W("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(W("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yn)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(W("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ye(typeof r.accessToken=="string"),new Du(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string"),new tt(e)}},$m=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=tt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Wm=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new $m(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(tt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Km=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Hm=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){ye(this.tokenListener===void 0);let r=s=>{s.error!=null&&W("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,W("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{W("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):W("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ye(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Km(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function QP(n){if(!n)return new zm;switch(n.type){case"firstParty":return new Wm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new H(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function YP(n){return $P(n)}var Ru=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=YP(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ue(n,e){return n<e?-1:n>e?1:0}function ki(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}var aE=-62135596800,lE=1e6,it=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new H(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new H(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<aE)throw new H(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*lE);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/lE}_compareTo(e){return this.seconds===e.seconds?ue(this.nanoseconds,e.nanoseconds):ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-aE,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var te=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new it(0,0))}static max(){return new n(new it(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var cE="__name__",ku=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&J(),r===void 0?r=e.length-t:r>e.length-t&&J(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Ne=class n extends ku{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new H(N.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},JP=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ut=class n extends ku{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return JP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===cE}static keyField(){return new n([cE])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new H(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new H(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new H(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new H(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var Y=class n{constructor(e){this.path=e}static fromPath(e){return new n(Ne.fromString(e))}static fromName(e){return new n(Ne.fromString(e).popFirst(5))}static empty(){return new n(Ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new Ne(e.slice()))}};var ba=-1;function XP(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=te.fromTimestamp(r===1e9?new it(t+1,0):new it(t,r));return new xi(i,Y.empty(),e)}function ZP(n){return new xi(n.readTime,n.key,ba)}var xi=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(te.min(),Y.empty(),ba)}static max(){return new n(te.max(),Y.empty(),ba)}};function eF(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=Y.comparator(n.documentKey,e.documentKey),t!==0)?t:ue(n.largestBatchId,e.largestBatchId)}var tF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Qm=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function La(n){return R(this,null,function*(){if(n.code===N.FAILED_PRECONDITION&&n.message===tF)W("LocalStore","Unexpectedly lost primary lease");else throw n})}var F=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&J(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function nF(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Va(n){return n.name==="IndexedDbTransactionError"}var X6=15*1e3,Z6=60*1e3;var UE=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})();var rF="remoteDocuments";var qE="owner";var zE="mutationQueues";var GE="mutations";var jE="documentMutations",iF="remoteDocumentsV14";var $E="remoteDocumentGlobal";var WE="targets";var KE="targetDocuments";var HE="targetGlobal",QE="collectionParents";var YE="clientMetadata";var JE="bundles";var XE="namedQueries";var sF="indexConfiguration";var oF="indexState";var aF="indexEntries";var ZE="documentOverlays";var lF="globals";var cF=[zE,GE,jE,rF,WE,qE,HE,KE],uF=cF,dF=[...uF,YE],hF=[...dF,$E],fF=[...hF,QE],pF=[...fF,JE,XE],e9=[...pF,ZE],mF=[zE,GE,jE,iF,WE,qE,HE,KE,YE,$E,QE,JE,XE,ZE],gF=mF,yF=[...gF,sF,oF,aF];var t9=[...yF,lF];function uE(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Vi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function eT(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Oe=class n{constructor(e,t){this.comparator=e,this.root=t||_a.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,_a.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_a.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new js(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new js(this.root,e,this.comparator,!1)}getReverseIterator(){return new js(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new js(this.root,e,this.comparator,!0)}},js=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},_a=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw J();let t=this.left.check();if(t!==this.right.check())throw J();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Ym=class{constructor(){this.size=0}get key(){throw J()}get value(){throw J()}get color(){throw J()}get left(){throw J()}get right(){throw J()}copy(e,t,r,i,s){return this}insert(e,t,r){return new _a(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};_a.EMPTY=new Ym;var pt=class n{constructor(e){this.comparator=e,this.data=new Oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new xu(this.data.getIterator())}getIteratorFrom(e){return new xu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},xu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var tn=class n{constructor(e){this.fields=e,e.sort(Ut.comparator)}static empty(){return new n([])}unionWith(e){let t=new pt(Ut.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ki(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function vF(n){return Buffer.from(n,"base64").toString("binary")}function _F(n){return Buffer.from(n,"binary").toString("base64")}var mt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=vF(e);return new n(t)}static fromUint8Array(e){let t=SF(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return _F(this.binaryString)}toUint8Array(){return CF(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};mt.EMPTY_BYTE_STRING=new mt("");function SF(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function CF(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var bF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lr(n){if(ye(!!n),typeof n=="string"){let e=0,t=bF.exec(n);if(ye(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ae(n.seconds),t=Ae(n.nanos);return{seconds:e,nanos:t}}}function Ae(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ei(n){return typeof n=="string"?mt.fromBase64String(n):mt.fromUint8Array(n)}var tT="server_timestamp",nT="__type__",rT="__previous_value__",iT="__local_write_time__";function Sy(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[nT])===null||t===void 0?void 0:t.stringValue)===tT}function EF(n,e){let t={fields:{[nT]:{stringValue:tT},[iT]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Sy(e)&&(e=Cy(e)),e&&(t.fields[rT]=e),{mapValue:t}}function Cy(n){let e=n.mapValue.fields[rT];return Sy(e)?Cy(e):e}function Ea(n){let e=lr(n.mapValue.fields[iT].timestampValue);return new it(e.seconds,e.nanos)}var Jm=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},Xm="(default)",Nu=class n{constructor(e,t){this.projectId=e,this.database=t||Xm}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Xm}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function TF(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new H(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Nu(n.options.projectId,e)}var by=-1;function sd(n){return n==null}function Ta(n){return n===0&&1/n===-1/0}function wF(n){return typeof n=="number"&&Number.isInteger(n)&&!Ta(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Ey="__type__",sT="__max__",Tu={mapValue:{fields:{__type__:{stringValue:sT}}}},Ty="__vector__",Hs="value";function Ni(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sy(n)?4:lT(n)?9007199254740991:aT(n)?10:11:J()}function vn(n,e){if(n===e)return!0;let t=Ni(n),r=Ni(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ea(n).isEqual(Ea(e));case 3:return IF(n,e);case 5:return n.stringValue===e.stringValue;case 6:return DF(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return AF(n,e);case 2:return RF(n,e);case 9:return ki(n.arrayValue.values||[],e.arrayValue.values||[],vn);case 10:case 11:return kF(n,e);case 9007199254740991:return!0;default:return J()}}function IF(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=lr(n.timestampValue),r=lr(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function AF(n,e){return Ae(n.geoPointValue.latitude)===Ae(e.geoPointValue.latitude)&&Ae(n.geoPointValue.longitude)===Ae(e.geoPointValue.longitude)}function DF(n,e){return ei(n.bytesValue).isEqual(ei(e.bytesValue))}function RF(n,e){if("integerValue"in n&&"integerValue"in e)return Ae(n.integerValue)===Ae(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ae(n.doubleValue),r=Ae(e.doubleValue);return t===r?Ta(t)===Ta(r):isNaN(t)&&isNaN(r)}return!1}function kF(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(uE(t)!==uE(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!vn(t[i],r[i])))return!1;return!0}function wa(n,e){return(n.values||[]).find(t=>vn(t,e))!==void 0}function Qs(n,e){if(n===e)return 0;let t=Ni(n),r=Ni(e);if(t!==r)return ue(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ue(n.booleanValue,e.booleanValue);case 2:return xF(n,e);case 3:return dE(n.timestampValue,e.timestampValue);case 4:return dE(Ea(n),Ea(e));case 5:return ue(n.stringValue,e.stringValue);case 6:return MF(n.bytesValue,e.bytesValue);case 7:return NF(n.referenceValue,e.referenceValue);case 8:return OF(n.geoPointValue,e.geoPointValue);case 9:return oT(n.arrayValue,e.arrayValue);case 10:return PF(n.mapValue,e.mapValue);case 11:return FF(n.mapValue,e.mapValue);default:throw J()}}function xF(n,e){let t=Ae(n.integerValue||n.doubleValue),r=Ae(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function dE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ue(n,e);let t=lr(n),r=lr(e),i=ue(t.seconds,r.seconds);return i!==0?i:ue(t.nanos,r.nanos)}function NF(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ue(t[i],r[i]);if(s!==0)return s}return ue(t.length,r.length)}function OF(n,e){let t=ue(Ae(n.latitude),Ae(e.latitude));return t!==0?t:ue(Ae(n.longitude),Ae(e.longitude))}function MF(n,e){let t=ei(n),r=ei(e);return t.compareTo(r)}function oT(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Qs(t[i],r[i]);if(s)return s}return ue(t.length,r.length)}function PF(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Hs])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Hs])===null||r===void 0?void 0:r.arrayValue,u=ue(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:oT(l,c)}function FF(n,e){if(n===Tu.mapValue&&e===Tu.mapValue)return 0;if(n===Tu.mapValue)return 1;if(e===Tu.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ue(r[o],s[o]);if(a!==0)return a;let l=Qs(t[r[o]],i[s[o]]);if(l!==0)return l}return ue(r.length,s.length)}function Ys(n){return wy(n)}function wy(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?VF(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?LF(n.bytesValue):"referenceValue"in n?UF(n.referenceValue):"geoPointValue"in n?BF(n.geoPointValue):"arrayValue"in n?zF(n.arrayValue):"mapValue"in n?qF(n.mapValue):J()}function LF(n){return ei(n).toBase64()}function VF(n){let e=lr(n);return`time(${e.seconds},${e.nanos})`}function BF(n){return`geo(${n.latitude},${n.longitude})`}function UF(n){return Y.fromName(n).toString()}function qF(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${wy(n.fields[i])}`;return t+"}"}function zF(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=wy(r);return e+"]"}function Zm(n){return!!n&&"integerValue"in n}function GF(n){return!!n&&"doubleValue"in n}function jF(n){return Zm(n)||GF(n)}function Iy(n){return!!n&&"arrayValue"in n}function hE(n){return!!n&&"nullValue"in n}function fE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Iu(n){return!!n&&"mapValue"in n}function aT(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Ey])===null||t===void 0?void 0:t.stringValue)===Ty}function Sa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Vi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Sa(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Sa(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function lT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===sT}var n9={mapValue:{fields:{[Ey]:{stringValue:Ty},[Hs]:{arrayValue:{}}}}};var Bt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Iu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Sa(t)}setAll(e){let t=Ut.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Sa(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Iu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Iu(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Vi(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Sa(this.value))}};function cT(n){let e=[];return Vi(n.fields,(t,r)=>{let i=new Ut([t]);if(Iu(r)){let o=cT(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new tn(e)}var Sn=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,te.min(),te.min(),te.min(),Bt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,te.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,te.min(),te.min(),Bt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,te.min(),te.min(),Bt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(te.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Bt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function $F(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Qs(r,i):J()}var Js=class{constructor(e,t){this.position=e,this.inclusive=t}};function uT(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=Y.comparator(Y.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Qs(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function WF(n,e,t){let r=uT(n,e,t);return n.inclusive?r>=0:r>0}function KF(n,e,t){let r=uT(n,e,t);return n.inclusive?r<=0:r<0}function pE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!vn(r,i))return!1}return!0}var Xs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function HF(n){return n.field.canonicalString()+n.dir}function QF(n){return`${n.field.canonicalString()} (${n.dir})`}function YF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ou=class{},Qe=class n extends Ou{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new tg(e,t,r):t==="array-contains"?new ig(e,r):t==="in"?new sg(e,r):t==="not-in"?new og(e,r):t==="array-contains-any"?new ag(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ng(e,r):new rg(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Qs(t,this.value)):t!==null&&Ni(this.value)===Ni(t)&&this.matchesComparison(Qs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return J()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Wn=class n extends Ou{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return dT(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function dT(n){return n.op==="and"}function hT(n){return JF(n)&&dT(n)}function JF(n){for(let e of n.filters)if(e instanceof Wn)return!1;return!0}function eg(n){if(n instanceof Qe)return n.field.canonicalString()+n.op.toString()+Ys(n.value);if(hT(n))return n.filters.map(e=>eg(e)).join(",");{let e=n.filters.map(t=>eg(t)).join(",");return`${n.op}(${e})`}}function fT(n,e){if(n instanceof Qe)return XF(n,e);if(n instanceof Wn)return ZF(n,e);J()}function XF(n,e){return e instanceof Qe&&n.op===e.op&&n.field.isEqual(e.field)&&vn(n.value,e.value)}function ZF(n,e){return e instanceof Wn&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&fT(i,e.filters[s]),!0):!1}function pT(n){return n instanceof Qe?tL(n):n instanceof Wn?eL(n):"Filter"}function eL(n){return n.op.toString()+" {"+n.getFilters().map(pT).join(" ,")+"}"}function tL(n){return`${n.field.canonicalString()} ${n.op} ${Ys(n.value)}`}var tg=class extends Qe{constructor(e,t,r){super(e,t,r),this.key=Y.fromName(r.referenceValue)}matches(e){let t=Y.comparator(e.key,this.key);return this.matchesComparison(t)}},ng=class extends Qe{constructor(e,t){super(e,"in",t),this.keys=mT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},rg=class extends Qe{constructor(e,t){super(e,"not-in",t),this.keys=mT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function mT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Y.fromName(r.referenceValue))}var ig=class extends Qe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Iy(t)&&wa(t.arrayValue,this.value)}},sg=class extends Qe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&wa(this.value.arrayValue,t)}},og=class extends Qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(wa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!wa(this.value.arrayValue,t)}},ag=class extends Qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Iy(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>wa(this.value.arrayValue,r))}};var lg=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function mE(n,e=null,t=[],r=[],i=null,s=null,o=null){return new lg(n,e,t,r,i,s,o)}function Ay(n){let e=ee(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>eg(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>HF(r)).join(","),sd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ys(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ys(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function nL(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>pT(t)).join(", ")}]`),sd(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>QF(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ys(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ys(t)).join(",")),`Target(${e})`}function Dy(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!YF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!fT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!pE(n.startAt,e.startAt)?!1:pE(n.endAt,e.endAt)}function cg(n){return Y.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Zs=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function rL(n,e,t,r,i,s,o,a){return new Zs(n,e,t,r,i,s,o,a)}function od(n){return new Zs(n)}function iL(n,e){return new Zs(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function gE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function sL(n){let e=new pt(Ut.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function oL(n){return Y.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function aL(n){return n.collectionGroup!==null}function Ia(n){let e=ee(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";sL(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Xs(s,r))}),t.has(Ut.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Xs(Ut.keyField(),r))}return e.memoizedNormalizedOrderBy}function Gn(n){let e=ee(n);return e.memoizedTarget||(e.memoizedTarget=lL(e,Ia(n))),e.memoizedTarget}function lL(n,e){if(n.limitType==="F")return mE(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Xs(i.field,s)});let t=n.endAt?new Js(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Js(n.startAt.position,n.startAt.inclusive):null;return mE(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ug(n,e,t){return new Zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ad(n,e){return Dy(Gn(n),Gn(e))&&n.limitType===e.limitType}function gT(n){return`${Ay(Gn(n))}|lt:${n.limitType}`}function zs(n){return`Query(target=${nL(Gn(n))}; limitType=${n.limitType})`}function ld(n,e){return e.isFoundDocument()&&cL(n,e)&&uL(n,e)&&dL(n,e)&&hL(n,e)}function cL(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):Y.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function uL(n,e){for(let t of Ia(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function dL(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function hL(n,e){return!(n.startAt&&!KF(n.startAt,Ia(n),e)||n.endAt&&!WF(n.endAt,Ia(n),e))}function fL(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function yT(n){return(e,t)=>{let r=!1;for(let i of Ia(n)){let s=pL(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function pL(n,e,t){let r=n.field.isKeyField()?Y.comparator(e.key,t.key):$F(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return J()}}var ti=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Vi(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return eT(this.inner)}size(){return this.innerSize}};var mL=new Oe(Y.comparator);function cr(){return mL}var vT=new Oe(Y.comparator);function va(...n){let e=vT;for(let t of n)e=e.insert(t.key,t);return e}function gL(){return Aa()}function _T(n){let e=vT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ii(){return Aa()}function ST(){return Aa()}function Aa(){return new ti(n=>n.toString(),(n,e)=>n.isEqual(e))}var yL=new Oe(Y.comparator);function vL(){return yL}var _L=new pt(Y.comparator);function se(...n){let e=_L;for(let t of n)e=e.add(t);return e}var SL=new pt(ue);function CL(){return SL}function Ry(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ta(e)?"-0":e}}function CT(n){return{integerValue:""+n}}function bL(n,e){return wF(e)?CT(e):Ry(n,e)}var eo=class{constructor(){this._=void 0}};function EL(n,e,t){return n instanceof to?EF(t,e):n instanceof Oi?ET(n,e):n instanceof Mi?TT(n,e):IL(n,e)}function TL(n,e,t){return n instanceof Oi?ET(n,e):n instanceof Mi?TT(n,e):t}function bT(n,e){return n instanceof no?jF(e)?e:{integerValue:0}:null}function wL(n,e){return n instanceof Oi&&e instanceof Oi||n instanceof Mi&&e instanceof Mi?ki(n.elements,e.elements,vn):n instanceof no&&e instanceof no?vn(n.operand,e.operand):n instanceof to&&e instanceof to}var to=class extends eo{},Oi=class extends eo{constructor(e){super(),this.elements=e}};function ET(n,e){let t=wT(e);for(let r of n.elements)t.some(i=>vn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Mi=class extends eo{constructor(e){super(),this.elements=e}};function TT(n,e){let t=wT(e);for(let r of n.elements)t=t.filter(i=>!vn(i,r));return{arrayValue:{values:t}}}var no=class extends eo{constructor(e,t){super(),this.serializer=e,this.operand=t}};function IL(n,e){let t=bT(n,e),r=yE(t)+yE(n.operand);return Zm(t)&&Zm(n.operand)?CT(r):Ry(n.serializer,r)}function yE(n){return Ae(n.integerValue||n.doubleValue)}function wT(n){return Iy(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function AL(n,e){return n.field.isEqual(e.field)&&wL(n.transform,e.transform)}function DL(n,e){return n===void 0&&e===void 0?!0:n&&e?ki(n,e,(t,r)=>AL(t,r)):!1}var dg=class{constructor(e,t){this.version=e,this.transformResults=t}},ar=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function cd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var ro=class{};function IT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Da(n.key,ar.none()):new Pi(n.key,n.data,ar.none());{let t=n.data,r=Bt.empty(),i=new pt(Ut.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Kn(n.key,r,new tn(i.toArray()),ar.none())}}function RL(n,e,t){n instanceof Pi?xL(n,e,t):n instanceof Kn?OL(n,e,t):PL(n,e,t)}function Ca(n,e,t,r){return n instanceof Pi?NL(n,e,t,r):n instanceof Kn?ML(n,e,t,r):FL(n,e,t)}function kL(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=bT(r.transform,i||null);s!=null&&(t===null&&(t=Bt.empty()),t.set(r.field,s))}return t||null}function vE(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!DL(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Pi=class extends ro{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function xL(n,e,t){let r=n.value.clone(),i=DT(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function NL(n,e,t,r){if(!cd(n.precondition,e))return t;let i=n.value.clone(),s=RT(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Kn=class extends ro{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function OL(n,e,t){if(!cd(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=DT(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(AT(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function ML(n,e,t,r){if(!cd(n.precondition,e))return t;let i=RT(n.fieldTransforms,r,e),s=e.data;return s.setAll(AT(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function AT(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function DT(n,e,t){let r=new Map;ye(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,TL(o,a,t[i]))}return r}function RT(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,EL(s,o,e))}return r}var Da=class extends ro{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function PL(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function FL(n,e,t){return cd(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var hg=class extends ro{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var fg=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];RL(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ca(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ca(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=ST();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=IT(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),se())}isEqual(e){return this.batchId===e.batchId&&ki(this.mutations,e.mutations,(t,r)=>vE(t,r))&&ki(this.baseMutations,e.baseMutations,(t,r)=>vE(t,r))}},pg=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){ye(e.mutations.length===r.length);let i=vL(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var mg=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var gg=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var et=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(et||{});function LL(n){switch(n){case N.OK:return J();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return J()}}function VL(n){return LL(n)&&n!==N.ABORTED}function Au(n){if(n===void 0)return _n("GRPC error has no .code"),N.UNKNOWN;switch(n){case et.OK:return N.OK;case et.CANCELLED:return N.CANCELLED;case et.UNKNOWN:return N.UNKNOWN;case et.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case et.INTERNAL:return N.INTERNAL;case et.UNAVAILABLE:return N.UNAVAILABLE;case et.UNAUTHENTICATED:return N.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case et.NOT_FOUND:return N.NOT_FOUND;case et.ALREADY_EXISTS:return N.ALREADY_EXISTS;case et.PERMISSION_DENIED:return N.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case et.ABORTED:return N.ABORTED;case et.OUT_OF_RANGE:return N.OUT_OF_RANGE;case et.UNIMPLEMENTED:return N.UNIMPLEMENTED;case et.DATA_LOSS:return N.DATA_LOSS;default:return J()}}var yg=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Pm=null;function BL(){return new jP}var UL=new wr([4294967295,4294967295],0);function _E(n){let e=BL().encode(n),t=new mh;return t.update(e),new Uint8Array(t.digest())}function SE(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new wr([t,r],0),a=new wr([i,s],0);return[o,a]}var vg=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ai(`Invalid padding: ${t}`);if(r<0)throw new Ai(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ai(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ai(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=wr.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(wr.fromNumber(r)));return i.compare(UL)===1&&(i=new wr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=_E(e),[r,i]=SE(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=_E(e),[r,i]=SE(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ai=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Mu=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ra.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(te.min(),i,new Oe(ue),cr(),se())}},Ra=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,se(),se(),se())}};var Ks=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Pu=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Fu=class{constructor(e,t,r=mt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Lu=class{constructor(){this.pendingResponses=0,this.documentChanges=bE(),this._resumeToken=mt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=se(),t=se(),r=se();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:J()}}),new Ra(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=bE()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,ye(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},qL="WatchChangeAggregator",_g=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=cr(),this.pendingDocumentTargetMapping=CE(),this.pendingTargetResets=new Oe(ue)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:J()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(cg(s))if(r===0){let o=new Y(s.path);this.removeDocumentFromTarget(t,o,Sn.newNoDocument(o,te.min()))}else ye(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Pm?.notifyOnExistenceFilterMismatch(zL(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=ei(r).toUint8Array()}catch(l){if(l instanceof yg)return Ws("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new vg(o,i,s)}catch(l){return l instanceof Ai?Ws("BloomFilter error: ",l):Ws("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&cg(a.target)){let l=new Y(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Sn.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=se();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new Mu(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=cr(),this.pendingDocumentTargetMapping=CE(),this.pendingTargetResets=new Oe(ue),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Lu,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new pt(ue),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||W(qL,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Lu),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function CE(){return new Oe(Y.comparator)}function bE(){return new Oe(Y.comparator)}function zL(n,e,t,r,i){var s,o,a,l,c,u;let p={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},m=e.unchangedNames;return m&&(p.bloomFilter={applied:i===0,hashCount:(s=m?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=m?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=m?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:S=>{var E;return(E=r?.mightContain(S))!==null&&E!==void 0?E:!1}}),p}var GL=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),jL=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),$L=(()=>{let n={};return n.and="AND",n.or="OR",n})();var Sg=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function WL(n){let e=n.code===void 0?N.UNKNOWN:Au(n.code);return new H(e,n.message||"")}function Cg(n,e){return n.useProto3Json||sd(e)?e:{value:e}}function KL(n){let e;return typeof n=="object"?e=n.value:e=n,sd(e)?null:e}function Vu(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function HL(n){let e=lr(n);return new it(e.seconds,e.nanos)}function kT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function QL(n,e){return n.useProto3Json?(ye(e===void 0||typeof e=="string"),mt.fromBase64String(e||"")):(ye(e===void 0||e instanceof Buffer||e instanceof Uint8Array),mt.fromUint8Array(e||new Uint8Array))}function YL(n,e){return Vu(n,e.toTimestamp())}function jn(n){return ye(!!n),te.fromTimestamp(HL(n))}function ky(n,e){return bg(n,e).canonicalString()}function bg(n,e){let t=XL(n).child("documents");return e===void 0?t:t.child(e)}function xT(n){let e=Ne.fromString(n);return ye(FT(e)),e}function Eg(n,e){return ky(n.databaseId,e.path)}function Fm(n,e){let t=xT(e);if(t.get(1)!==n.databaseId.projectId)throw new H(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new H(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Y(OT(t))}function NT(n,e){return ky(n.databaseId,e)}function JL(n){let e=xT(n);return e.length===4?Ne.emptyPath():OT(e)}function Tg(n){return new Ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function XL(n){return new Ne(["projects",n.projectId,"databases",n.database])}function OT(n){return ye(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function EE(n,e,t){return{name:Eg(n,e),fields:t.value.mapValue.fields}}function ZL(n,e){let t;if("targetChange"in e){e.targetChange;let r=e2(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=QL(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&WL(o);t=new Fu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Fm(n,r.document.name),s=jn(r.document.updateTime),o=r.document.createTime?jn(r.document.createTime):te.min(),a=new Bt({mapValue:{fields:r.document.fields}}),l=Sn.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Ks(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Fm(n,r.document),s=r.readTime?jn(r.readTime):te.min(),o=Sn.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Ks([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Fm(n,r.document),s=r.removedTargetIds||[];t=new Ks([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new gg(i,s),a=r.targetId;t=new Pu(a,o)}else return J();return t}function e2(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:J()}function t2(n){if(!("targetChange"in n))return te.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?te.min():jn(e.readTime)}function n2(n,e){let t;if(e instanceof Pi)t={update:EE(n,e.key,e.value)};else if(e instanceof Da)t={delete:Eg(n,e.key)};else if(e instanceof Kn)t={update:EE(n,e.key,e.data),updateMask:M2(e.fieldMask)};else if(e instanceof hg)t={verify:Eg(n,e.key)};else return J();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>o2(n,r))),e.precondition.isNone||(t.currentDocument=r2(n,e.precondition)),t}function r2(n,e){return e.updateTime!==void 0?{updateTime:YL(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:J()}function i2(n,e){let t=n.updateTime?jn(n.updateTime):jn(e);return t.isEqual(te.min())&&(t=jn(e)),new dg(t,n.transformResults||[])}function s2(n,e){return n&&n.length>0?(ye(e!==void 0),n.map(t=>i2(t,e))):[]}function o2(n,e){let t=e.transform;if(t instanceof to)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Oi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Mi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof no)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw J()}function a2(n,e){return{documents:[NT(n,e.path)]}}function l2(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=NT(n,i);let s=f2(e.filters);s&&(t.structuredQuery.where=s);let o=m2(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Cg(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=y2(e.startAt)),e.endAt&&(t.structuredQuery.endAt=v2(e.endAt)),{queryTarget:t,parent:i}}function c2(n){let e=JL(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){ye(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=p2(t.where));let o=[];t.orderBy&&(o=g2(t.orderBy));let a=null;t.limit&&(a=KL(t.limit));let l=null;t.startAt&&(l=_2(t.startAt));let c=null;return t.endAt&&(c=S2(t.endAt)),rL(e,i,o,s,a,"F",l,c)}function u2(n,e){let t=d2(e.purpose);return t==null?null:{"goog-listen-tags":t}}function d2(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return J()}}function h2(n,e){let t,r=e.target;if(cg(r)?t={documents:a2(n,r)}:t={query:l2(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=kT(n,e.resumeToken);let i=Cg(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(te.min())>0){t.readTime=Vu(n,e.snapshotVersion.toTimestamp());let i=Cg(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function f2(n){if(n.length!==0)return PT(Wn.create(n,"and"))}function p2(n){let e=MT(n);return e instanceof Wn&&hT(e)?e.getFilters():[e]}function MT(n){return n.unaryFilter!==void 0?x2(n):n.fieldFilter!==void 0?N2(n):n.compositeFilter!==void 0?O2(n):J()}function m2(n){if(n.length!==0)return n.map(e=>A2(e))}function g2(n){return n.map(e=>D2(e))}function y2(n){return{before:n.inclusive,values:n.position}}function v2(n){return{before:!n.inclusive,values:n.position}}function _2(n){let e=!!n.before,t=n.values||[];return new Js(t,e)}function S2(n){let e=!n.before,t=n.values||[];return new Js(t,e)}function C2(n){return GL[n]}function b2(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function E2(n){return jL[n]}function T2(n){return $L[n]}function w2(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return J();default:return J()}}function I2(n){switch(n){case"AND":return"and";case"OR":return"or";default:return J()}}function Gs(n){return{fieldPath:n.canonicalString()}}function $s(n){return Ut.fromServerFormat(n.fieldPath)}function A2(n){return{field:Gs(n.field),direction:C2(n.dir)}}function D2(n){return new Xs($s(n.field),b2(n.direction))}function PT(n){return n instanceof Qe?k2(n):n instanceof Wn?R2(n):J()}function R2(n){let e=n.getFilters().map(t=>PT(t));return e.length===1?e[0]:{compositeFilter:{op:T2(n.op),filters:e}}}function k2(n){if(n.op==="=="){if(fE(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NAN"}};if(hE(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(fE(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NOT_NAN"}};if(hE(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gs(n.field),op:E2(n.op),value:n.value}}}function x2(n){switch(n.unaryFilter.op){case"IS_NAN":let e=$s(n.unaryFilter.field);return Qe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=$s(n.unaryFilter.field);return Qe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=$s(n.unaryFilter.field);return Qe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=$s(n.unaryFilter.field);return Qe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return J();default:return J()}}function N2(n){return Qe.create($s(n.fieldFilter.field),w2(n.fieldFilter.op),n.fieldFilter.value)}function O2(n){return Wn.create(n.compositeFilter.filters.map(e=>MT(e)),I2(n.compositeFilter.op))}function M2(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function FT(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ka=class n{constructor(e,t,r,i,s=te.min(),o=te.min(),a=mt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var wg=class{constructor(e){this.remoteSerializer=e}};function P2(n){let e=c2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ug(e,e.limit,"L"):e}function F2(n){return{name:n.name,query:P2(n.bundledQuery),readTime:jn(n.readTime)}}function L2(n){return{id:n.id,version:n.version,createTime:jn(n.createTime)}}var V2=5,B2=10,U2=13,Lm=15,q2=20,z2=25,G2=30,j2=37,$2=45,W2=50,K2=53,H2=55,Q2=60,Y2=2,Bu=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,V2);else if("booleanValue"in e)this.writeValueTypeLabel(t,B2),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Lm),t.writeNumber(Ae(e.integerValue));else if("doubleValue"in e){let r=Ae(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,U2):(this.writeValueTypeLabel(t,Lm),Ta(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,q2),typeof r=="string"&&(r=lr(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,G2),t.writeBytes(ei(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,$2),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?lT(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):aT(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):J()}writeIndexString(e,t){this.writeValueTypeLabel(t,z2),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,H2);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,K2);let o=Hs,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,Lm),t.writeNumber(Ae(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,W2);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,j2),Y.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,Q2),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(Y2)}};Bu.INSTANCE=new Bu;var Ig=class{constructor(){this.collectionParentIndex=new Ag}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(xi.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(xi.min())}updateCollectionGroup(e,t,r){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}},Ag=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new pt(Ne.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new pt(Ne.comparator)).toArray()}};var r9=new Uint8Array(0);var Vm=2,xa=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Vm,this.lastId}static forTargetCache(){return new n(2-Vm)}static forSyncEngine(){return new n(1-Vm)}};var LT=-1,VT=40*1024*1024,zn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};zn.DEFAULT_COLLECTION_PERCENTILE=10;zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;zn.DEFAULT=new zn(VT,zn.DEFAULT_COLLECTION_PERCENTILE,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);zn.DISABLED=new zn(LT,0,0);var TE=1*1024*1024,i9=1*60*1e3,s9=5*60*1e3;var Dg=class{constructor(){this.changes=new ti(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Sn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?F.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Rg=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var kg=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ca(r.mutation,i,tn.empty(),it.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,se()).next(()=>r))}getLocalViewOfDocuments(e,t,r=se()){let i=Ii();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=va();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Ii();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,se()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=cr(),o=Aa(),a=gL();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Kn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Ca(u.mutation,c,u.mutation.getFieldMask(),it.now())):o.set(c.key,tn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var p;return a.set(c,new Rg(u,(p=o.get(c))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Aa(),i=new Oe((o,a)=>o-a),s=se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||tn.empty();u=a.applyToLocalView(c,u),r.set(l,u);let p=(i.get(a.batchId)||se()).add(l);i=i.insert(a.batchId,p)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,p=ST();u.forEach(m=>{if(!s.has(m)){let S=IT(t.get(m),r.get(m));S!==null&&p.set(m,S),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,p))}return F.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return oL(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aL(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):F.resolve(Ii()),a=ba,l=s;return o.next(c=>F.forEach(c,(u,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(u)?F.resolve():this.remoteDocumentCache.getEntry(e,u).next(m=>{l=l.insert(u,m)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,se())).next(u=>({batchId:a,changes:_T(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Y(t)).next(r=>{let i=va();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=va();return this.indexManager.getCollectionParents(e,s).next(a=>F.forEach(a,l=>{let c=iL(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Sn.newInvalidDocument(u)))});let a=va();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Ca(u.mutation,c,tn.empty(),it.now()),ld(t,c)&&(a=a.insert(l,c))}),a})}};var xg=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return F.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,L2(t)),F.resolve()}getNamedQuery(e,t){return F.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,F2(t)),F.resolve()}};var Ng=class{constructor(){this.overlays=new Oe(Y.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Ii();return F.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),F.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),F.resolve()}getOverlaysForCollection(e,t,r){let i=Ii(),s=t.length+1,o=new Y(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return F.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Oe((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let m=s.get(u.largestBatchId);m===null&&(m=Ii(),s=s.insert(u.largestBatchId,m)),m.set(u.getKey(),u)}}let a=Ii(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((p,m)=>a.set(p,m)),!(a.size()>=i)););return F.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new mg(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=se(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Og=class{constructor(){this.sessionToken=mt.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,F.resolve()}};var Na=class{constructor(){this.refsByKey=new pt(We.compareByKey),this.refsByTarget=new pt(We.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new We(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new We(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new Y(new Ne([])),r=new We(t,e),i=new We(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new Y(new Ne([])),r=new We(t,e),i=new We(t,e+1),s=se();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new We(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},We=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return Y.comparator(e.key,t.key)||ue(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ue(e.targetOrBatchId,t.targetOrBatchId)||Y.comparator(e.key,t.key)}};var Mg=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new pt(We.compareByKey)}checkEmpty(e){return F.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new fg(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new We(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return F.resolve(o)}lookupMutationBatch(e,t){return F.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return F.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(this.mutationQueue.length===0?by:this.nextBatchId-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new We(t,0),i=new We(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),F.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new pt(ue);return t.forEach(i=>{let s=new We(i,0),o=new We(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),F.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;Y.isDocumentKey(s)||(s=s.child(""));let o=new We(new Y(s),0),a=new pt(ue);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),F.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");ye(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return F.forEach(t.mutations,s=>{let o=new We(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new We(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return F.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function J2(){return new Oe(Y.comparator)}var Pg=class{constructor(e){this.sizer=e,this.docs=J2(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return F.resolve(r?r.document.mutableCopy():Sn.newInvalidDocument(t))}getEntries(e,t){let r=cr();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Sn.newInvalidDocument(i))}),F.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=cr(),o=t.path,a=new Y(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||eF(ZP(u),r)<=0||!i.has(u.key)&&!ld(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return F.resolve(s)}getAllFromCollectionGroup(e,t,r,i){J()}forEachDocumentKey(e,t){return F.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Fg(this)}getSize(e){return F.resolve(this.size)}};function X2(n){return new Pg(n)}var Fg=class extends Dg{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),F.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Lg=class{constructor(e){this.persistence=e,this.targets=new ti(t=>Ay(t),Dy),this.lastRemoteSnapshotVersion=te.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Na,this.targetCount=0,this.targetIdGenerator=xa.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),F.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new xa(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.saveTargetData(t),F.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),F.waitFor(s).next(()=>i)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return F.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),F.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),F.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),F.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return F.resolve(r)}containsKey(e,t){return F.resolve(this.references.containsKey(t))}};var Z2="MemoryPersistence",Vg=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new UE(0),this._started=!1,this._started=!0,this.globalsCache=new Og,this.referenceDelegate=e(this),this.targetCache=new Lg(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Ig,this.remoteDocumentCache=X2(r),this.serializer=new wg(t),this.bundleCache=new xg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ng,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Mg(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){W(Z2,"Starting transaction:",e);let i=new Bg(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return F.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Bg=class extends Qm{constructor(e){super(),this.currentSequenceNumber=e}},Ug=class n{constructor(e){this.persistence=e,this.localViewReferences=new Na,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw J()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),F.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),F.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.orphanedDocuments,i=>{let s=Y.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,te.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return F.or([()=>F.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var o9=30*60*1e3;function eV(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var xy="LocalStore",tV=5*60*1e6,qg=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Oe(ue),this.targetIdByTarget=new ti(s=>Ay(s),Dy),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new kg(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function nV(n,e,t,r){return new qg(n,e,t,r)}function BT(n,e){return R(this,null,function*(){let t=ee(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=se();for(let u of s){a.push(u.batchId);for(let p of u.mutations)c=c.add(p.key)}for(let u of o){l.push(u.batchId);for(let p of u.mutations)c=c.add(p.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function rV(n,e){let t=ee(n),r=it.now(),i=e.reduce((a,l)=>a.add(l.key),se()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=cr(),c=se();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((p,m)=>{m.isValidDocument()||(c=c.add(p))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let p=[];for(let m of e){let S=kL(m,s.get(m.key).overlayedDocument);S!=null&&p.push(new Kn(m.key,S,cT(S.value.mapValue),ar.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,p,e)}).next(u=>{o=u;let p=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,p)})}).then(()=>({batchId:o.batchId,changes:_T(s)}))}function iV(n,e){let t=ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return pV(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,sV(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function sV(n){let e=se();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function oV(n,e){let t=ee(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(ye(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function UT(n){let e=ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function aV(n,e){let t=ee(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,p)=>{let m=i.get(p);if(!m)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,p).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,p)));let S=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?S=S.withResumeToken(mt.EMPTY_BYTE_STRING,te.min()).withLastLimboFreeSnapshotVersion(te.min()):u.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(u.resumeToken,r)),i=i.insert(p,S),cV(m,S,u)&&a.push(t.targetCache.updateTargetData(s,S))});let l=cr(),c=se();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(lV(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(te.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(p=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return F.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function lV(n,e,t){let r=se(),i=se();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=cr();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(te.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):W(xy,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function cV(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=tV?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function uV(n,e){return R(this,null,function*(){let t=ee(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>F.forEach(e,i=>F.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>F.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Va(r))W(xy,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function dV(n,e){let t=ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=by),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function hV(n,e){let t=ee(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,F.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new ka(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function fV(n,e,t){let r=ee(n),i=r.targetIdByTarget.get(t);return i!==void 0?F.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function zg(n,e,t){return R(this,null,function*(){let r=ee(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Va(o))W(xy,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function qT(n,e,t){let r=ee(n),i=te.min(),s=se();return r.persistence.runTransaction("Execute query","readwrite",o=>fV(r,o,Gn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:te.min(),t?s:se())).next(a=>(mV(r,fL(e),a),{documents:a,remoteKeys:s})))}function pV(n,e,t,r){let i=t.batch,s=i.keys(),o=F.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);ye(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function mV(n,e,t){let r=n.collectionGroupReadTime.get(e)||te.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}var Gg=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var gV=100;function yV(){return wv()?8:nF(Tv())>0?6:4}var jg=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=gV,this.relativeIndexReadCostPerDocument=yV()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Gg;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(ya()<=Qn.DEBUG&&W("QueryEngine","SDK will not create cache indexes for query:",zs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),F.resolve()):(ya()<=Qn.DEBUG&&W("QueryEngine","Query:",zs(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(ya()<=Qn.DEBUG&&W("QueryEngine","The SDK decides to create cache indexes for query:",zs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gn(t))):F.resolve())}performQueryUsingIndex(e,t){if(gE(t))return F.resolve(null);let r=Gn(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ug(t,null,"F"),r=Gn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=se(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,ug(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return gE(t)||i.isEqual(te.min())?F.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?F.resolve(null):(ya()<=Qn.DEBUG&&W("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),zs(t)),this.appendRemainingResults(e,o,t,XP(i,ba)).next(a=>a))})}applyQuery(e,t){let r=new pt(yT(e));return t.forEach((i,s)=>{ld(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return ya()<=Qn.DEBUG&&W("QueryEngine","Using full collection scan to execute query:",zs(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,xi.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Uu=class{constructor(){this.activeTargetIds=CL()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var $g=class{constructor(){this.localState=new Uu,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Uu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Wg=class{addCallback(e){}shutdown(){}};var Kg=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var wu=null;function vV(){return 268435456+Math.round(2147483648*Math.random())}function Bm(){return wu===null?wu=vV():wu++,"0x"+wu.toString(16)}function _V(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var SV="1.9.1",Et="GrpcConnection",CV=`gl-node/${process.versions.node} fire/${lo} grpc/${SV}`;function Um(n,e,t,r){ye(e===null||e.type==="OAuth");let i=new Di.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",CV),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Hg=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){W(Et,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Di.credentials.createSsl():Di.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Bm(),a=this.ensureActiveStub(),l=Um(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return _V(u=>(W(Et,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(p,m)=>{p?(W(Et,`RPC '${e}' ${o} failed with error:`,p),u(new H(Au(p.code),p.message))):(W(Et,`RPC '${e}' ${o} completed with response:`,m),u(void 0,m))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Bm(),l=[],c=new yn;W(Et,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),p=Um(this.databasePath,i,s,this.databaseInfo.appId),m=Object.assign(Object.assign({},r),{database:this.databasePath}),S=u[e](m,p),E=!1;return S.on("data",T=>{W(Et,`RPC ${e} ${a} received result:`,T),l.push(T),o!==void 0&&l.length===o&&(E=!0,c.resolve(l))}),S.on("end",()=>{W(Et,`RPC '${e}' ${a} completed.`),E||(E=!0,c.resolve(l))}),S.on("error",T=>{W(Et,`RPC '${e}' ${a} failed with error:`,T);let b=Au(T.code);c.reject(new H(b,T.message))}),c.promise}openStream(e,t,r){let i=Bm(),s=this.ensureActiveStub(),o=Um(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=m=>{l||(l=!0,u.callOnClose(m),a.end())},u=new Kg({sendFn:m=>{if(l)W(Et,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,m);else{W(Et,`RPC '${e}' stream ${i} sending:`,m);try{a.write(m)}catch(S){throw _n("Failure sending:",m),_n("Error:",S),S}}},closeFn:()=>{W(Et,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),p=!1;return a.on("data",m=>{l||(W(Et,`RPC '${e}' stream ${i} received:`,m),p||(u.callOnConnected(),p=!0),u.callOnMessage(m))}),a.on("end",()=>{W(Et,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",m=>{if(!l){Ws(Et,`RPC '${e}' stream ${i} error. Code:`,m.code,"Message:",m.message);let S=Au(m.code);c(new H(S,m.message))}}),W(Et,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},zT={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},bV={nested:zT},EV=Object.freeze({__proto__:null,nested:zT,default:bV});var TV={longs:String,enums:String,defaults:!0,oneofs:!1};function wV(){let n=BE.fromJSON(EV,TV);return Di.loadPackageDefinition(n)}function IV(n){let e=wV();return new Hg(e,n)}function AV(){return new Wg}function ud(n){return new Sg(n,!1)}var DV="ExponentialBackoff",RV=1e3,kV=1.5,xV=60*1e3,qu=class{constructor(e,t,r=RV,i=kV,s=xV){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&W(DV,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var wE="PersistentStream",NV=60*1e3,OV=10*1e3,zu=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new qu(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return R(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,NV,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return R(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return R(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(_n(t.toString()),_n("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new H(N.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,OV,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>R(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return W(wE,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(W(wE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Qg=class extends zu{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=ZL(this.serializer,e),r=t2(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Tg(this.serializer),t.addTarget=h2(this.serializer,e);let r=u2(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Tg(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Yg=class extends zu{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return ye(!!e.streamToken),this.lastStreamToken=e.streamToken,ye(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){ye(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=s2(e.writeResults,e.commitTime),r=jn(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=Tg(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>n2(this.serializer,r))};this.sendRequest(t)}};var Jg=class{},Xg=class extends Jg{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new H(N.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,bg(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new H(N.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,bg(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new H(N.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function MV(n,e,t,r){return new Xg(n,e,t,r)}function PV(n,e,t){let r=ee(n);return r.verifyInitialized(),new Yg(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function FV(n,e,t){let r=ee(n);return r.verifyInitialized(),new Qg(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var LV="OnlineStateTracker",IE=1,AE=10*1e3,Zg=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",AE,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${AE/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=IE&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${IE} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(_n(t),this.shouldWarnClientIsOffline=!1):W(LV,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Fi="RemoteStore",VV=10,ey=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>R(this,null,function*(){Bi(this)&&(W(Fi,"Restarting streams for network reachability change."),yield eB(this))}))}),this.onlineStateTracker=new Zg(r,i)}};function BV(n,e,t,r,i){return new ey(n,e,t,r,i)}function dd(n){return R(this,null,function*(){if(Bi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function Ba(n){return R(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function UV(n){return R(this,null,function*(){let e=ee(n);W(Fi,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Ba(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function GT(n,e){let t=ee(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Py(t)?My(t):co(t).isOpen()&&Oy(t,e))}function Ny(n,e){let t=ee(n),r=co(t);t.listenTargets.delete(e),r.isOpen()&&jT(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Bi(t)&&t.onlineStateTracker.set("Unknown"))}function Oy(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(te.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}co(n).watch(e)}function jT(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),co(n).unwatch(e)}function My(n){n.watchChangeAggregator=new _g({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),co(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Py(n){return Bi(n)&&!co(n).isStarted()&&n.listenTargets.size>0}function Bi(n){return ee(n).offlineCauses.size===0}function $T(n){n.watchChangeAggregator=void 0}function qV(n){return R(this,null,function*(){n.onlineStateTracker.set("Online")})}function zV(n){return R(this,null,function*(){n.listenTargets.forEach((e,t)=>{Oy(n,e)})})}function GV(n,e){return R(this,null,function*(){$T(n),Py(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),My(n)):n.onlineStateTracker.set("Unknown")})}function jV(n,e,t){return R(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Fu&&e.state===2&&e.cause){try{yield WV(n,e)}catch(r){W(Fi,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Gu(n,r)}return}if(e instanceof Ks?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Pu?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(te.min()))try{let r=yield UT(n.localStore);t.compareTo(r)>=0&&(yield $V(n,t))}catch(r){W(Fi,"Failed to raise snapshot:",r),yield Gu(n,r)}})}function Gu(n,e,t){return R(this,null,function*(){if(Va(e))n.offlineCauses.add(1),yield Ba(n),n.onlineStateTracker.set("Offline"),t||(t=()=>UT(n.localStore)),n.asyncQueue.enqueueRetryable(()=>R(this,null,function*(){W(Fi,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield dd(n)}));else throw e})}function WT(n,e){return e().catch(t=>Gu(n,t,e))}function $V(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(mt.EMPTY_BYTE_STRING,s.snapshotVersion)),jT(n,r);let o=new ka(s.target,r,i,s.sequenceNumber);Oy(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function WV(n,e){return R(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function hd(n){return R(this,null,function*(){let e=ee(n),t=ri(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:by;for(;KV(e);)try{let i=yield dV(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,HV(e,i)}catch(i){yield Gu(e,i)}KT(e)&&HT(e)})}function KV(n){return Bi(n)&&n.writePipeline.length<VV}function HV(n,e){n.writePipeline.push(e);let t=ri(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function KT(n){return Bi(n)&&!ri(n).isStarted()&&n.writePipeline.length>0}function HT(n){ri(n).start()}function QV(n){return R(this,null,function*(){ri(n).writeHandshake()})}function YV(n){return R(this,null,function*(){let e=ri(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function JV(n,e,t){return R(this,null,function*(){let r=n.writePipeline.shift(),i=pg.from(r,e,t);yield WT(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield hd(n)})}function XV(n,e){return R(this,null,function*(){e&&ri(n).handshakeComplete&&(yield ZV(n,e)),KT(n)&&HT(n)})}function ZV(n,e){return R(this,null,function*(){if(VL(e.code)){let t=n.writePipeline.shift();ri(n).inhibitBackoff(),yield WT(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield hd(n)}})}function eB(n){return R(this,null,function*(){let e=ee(n);e.offlineCauses.add(4),yield Ba(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield dd(e)})}function DE(n,e){return R(this,null,function*(){let t=ee(n);t.asyncQueue.verifyOperationInProgress(),W(Fi,"RemoteStore received new credentials");let r=Bi(t);t.offlineCauses.add(3),yield Ba(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield dd(t)})}function tB(n,e){return R(this,null,function*(){let t=ee(n);e?(t.offlineCauses.delete(2),yield dd(t)):e||(t.offlineCauses.add(2),yield Ba(t),t.onlineStateTracker.set("Unknown"))})}function co(n){return n.watchStream||(n.watchStream=FV(n.datastore,n.asyncQueue,{onConnected:qV.bind(null,n),onOpen:zV.bind(null,n),onClose:GV.bind(null,n),onWatchChange:jV.bind(null,n)}),n.onNetworkStatusChange.push(e=>R(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Py(n)?My(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),$T(n))}))),n.watchStream}function ri(n){return n.writeStream||(n.writeStream=PV(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:QV.bind(null,n),onClose:XV.bind(null,n),onHandshakeComplete:YV.bind(null,n),onMutationResult:JV.bind(null,n)}),n.onNetworkStatusChange.push(e=>R(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield hd(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(W(Fi,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var nB="AsyncQueue",ty=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Fy(n,e){if(_n(nB,`${e}: ${n}`),Va(n))return new H(N.UNAVAILABLE,`${e}: ${n}`);throw n}var ju=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||Y.comparator(t.key,r.key):this.comparator=(t,r)=>Y.comparator(t.key,r.key),this.keyedMap=va(),this.sortedSet=new Oe(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var $u=class{constructor(){this.changeMap=new Oe(Y.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):J()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},io=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,ju.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!ad(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var ny=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function rB(){return new ry}var ry=class{constructor(){this.queries=QT(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){aB(this,new H(N.ABORTED,"Firestore shutting down"))}};function QT(){return new ti(n=>gT(n),ad)}function YT(n,e){return R(this,null,function*(){let t=ee(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new ny,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=Fy(o,`Initialization of query '${zs(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Ly(t)})}function JT(n,e){return R(this,null,function*(){let t=ee(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function iB(n,e){let t=ee(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&Ly(t)}function sB(n,e,t){let r=ee(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function oB(n,e){let t=ee(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&Ly(t)}function aB(n,e){let t=ee(n),r=t.queries;t.queries=QT(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function Ly(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var XT=function(n){return n.Default="default",n.Cache="cache",n}(XT||{}),Wu=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new io(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=io.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==XT.Cache}};var iy=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=se(),i=se();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Ku=class{constructor(e){this.key=e}},Hu=class{constructor(e){this.key=e}},sy=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=se(),this.mutatedKeys=se(),this.docComparator=yT(e),this.documentSet=new ju(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new $u,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,p)=>{let m=i.get(u),S=ld(this.query,p)?p:null,E=m?this.mutatedKeys.has(m.key):!1,T=S?S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations:!1,b=!1;m&&S?m.data.isEqual(S.data)?E!==T&&(r.track({type:3,doc:S}),b=!0):this.shouldWaitForSyncedDocument(m,S)||(r.track({type:2,doc:S}),b=!0,(l&&this.docComparator(S,l)>0||c&&this.docComparator(S,c)<0)&&(a=!0)):!m&&S?(r.track({type:0,doc:S}),b=!0):m&&!S&&(r.track({type:1,doc:m}),b=!0,(l||c)&&(a=!0)),b&&(S?(o=o.add(S),T?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((p,m)=>lB(p.type,m.type)||this.docComparator(p.doc,m.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new io(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new $u,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=se(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Hu(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Ku(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=se();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return io.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function lB(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return J()}};return t(n)-t(e)}var Vy="SyncEngine",oy=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},ay=class{constructor(e){this.key=e,this.receivedDocument=!1}},ly=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new ti(a=>gT(a),ad),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Oe(Y.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Na,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=xa.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function cB(n,e,t,r,i,s,o){let a=new ly(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function uB(n,e,t=!0){return R(this,null,function*(){let r=sw(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield ZT(r,e,t,!0),i})}function dB(n,e){return R(this,null,function*(){let t=sw(n);yield ZT(t,e,!0,!1)})}function ZT(n,e,t,r){return R(this,null,function*(){let i=yield hV(n.localStore,Gn(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield hB(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&GT(n.remoteStore,i),a})}function hB(n,e,t,r,i){return R(this,null,function*(){n.applyDocChanges=(p,m,S)=>bB(n,p,m,S);let s=yield qT(n.localStore,e,!0),o=new sy(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Ra.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);iw(n,t,c.limboChanges);let u=new oy(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function fB(n,e,t){return R(this,null,function*(){let r=ee(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!ad(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield zg(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ny(r.remoteStore,i.targetId),cy(r,i.targetId)}).catch(La))):(cy(r,i.targetId),yield zg(r.localStore,i.targetId,!0))})}function pB(n,e){return R(this,null,function*(){let t=ee(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ny(t.remoteStore,r.targetId))})}function mB(n,e,t){return R(this,null,function*(){let r=wB(n);try{let i=yield rV(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),SB(r,i.batchId,t),yield Ua(r,i.changes),yield hd(r.remoteStore)}catch(i){let s=Fy(i,"Failed to persist write");t.reject(s)}})}function ew(n,e){return R(this,null,function*(){let t=ee(n);try{let r=yield aV(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(ye(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?ye(o.receivedDocument):i.removedDocuments.size>0&&(ye(o.receivedDocument),o.receivedDocument=!1))}),yield Ua(t,r,e)}catch(r){yield La(r)}})}function RE(n,e,t){let r=ee(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),oB(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function gB(n,e,t){return R(this,null,function*(){let r=ee(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Oe(Y.comparator);o=o.insert(s,Sn.newNoDocument(s,te.min()));let a=se().add(s),l=new Mu(te.min(),new Map,new Oe(ue),o,a);yield ew(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),By(r)}else yield zg(r.localStore,e,!1).then(()=>cy(r,e,t)).catch(La)})}function yB(n,e){return R(this,null,function*(){let t=ee(n),r=e.batch.batchId;try{let i=yield iV(t.localStore,e);nw(t,r,null),tw(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ua(t,i)}catch(i){yield La(i)}})}function vB(n,e,t){return R(this,null,function*(){let r=ee(n);try{let i=yield oV(r.localStore,e);nw(r,e,t),tw(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ua(r,i)}catch(i){yield La(i)}})}function tw(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function _B(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new H(N.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function SB(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Oe(ue)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function nw(n,e,t){let r=ee(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function cy(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||rw(n,i)})}function rw(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Ny(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),By(n))}function iw(n,e,t){for(let r of t)r instanceof Ku?(n.limboDocumentRefs.addReference(r.key,e),CB(n,r)):r instanceof Hu?(W(Vy,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||rw(n,r.key)):J()}function CB(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(W(Vy,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),By(n))}function By(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new Y(Ne.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new ay(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),GT(n.remoteStore,new ka(Gn(od(t.path)),r,"TargetPurposeLimboResolution",UE.INVALID))}}function Ua(n,e,t){return R(this,null,function*(){let r=ee(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let p=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(c){i.push(c);let p=iy.fromSnapshot(l.targetId,c);s.push(p)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield uV(r.localStore,s))})}function bB(n,e,t,r){return R(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield qT(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return iw(n,e.targetId,a.limboChanges),a.snapshot})}function EB(n,e){return R(this,null,function*(){let t=ee(n);if(!t.currentUser.isEqual(e)){W(Vy,"User change. New user:",e.toKey());let i=yield BT(t.localStore,e);t.currentUser=e,_B(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Ua(t,i.affectedDocuments)}})}function TB(n,e){let t=ee(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return se().add(r.key);{let i=se(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function sw(n){let e=ee(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ew.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=TB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gB.bind(null,e),e.syncEngineListener.onWatchChange=iB.bind(null,e.eventManager),e.syncEngineListener.onWatchError=sB.bind(null,e.eventManager),e}function wB(n){let e=ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vB.bind(null,e),e}var kE=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return R(this,null,function*(){this.serializer=ud(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return nV(this.persistence,new jg,t.initialUser,this.serializer)}createPersistence(t){return new Vg(Ug.factory,this.serializer)}createSharedClientState(t){return new $g}terminate(){return R(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var IB=(()=>{class n{initialize(t,r){return R(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>RE(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=EB.bind(null,this.syncEngine),yield tB(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return rB()}createDatastore(t){let r=ud(t.databaseInfo.databaseId),i=IV(t.databaseInfo);return MV(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return BV(this.localStore,this.datastore,t.asyncQueue,r=>RE(this.syncEngine,r,0),AV())}createSyncEngine(t,r){return cB(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return R(this,null,function*(){var t,r;yield UV(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})();function ow(n,e,t){if(!t)throw new H(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function AB(n,e,t,r){if(e===!0&&r===!0)throw new H(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xE(n){if(!Y.isDocumentKey(n))throw new H(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function NE(n){if(Y.isDocumentKey(n))throw new H(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function DB(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Uy(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=RB(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":J()}function RB(n){return n.constructor?n.constructor.name:null}function $n(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new H(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Uy(n);throw new H(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Qu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):_n("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var ni="FirestoreClient",kB=100,xB=11,NB=20,OB=22,uy=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=tt.UNAUTHENTICATED,this.clientId=Ru.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>R(this,null,function*(){W(ni,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(W(ni,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:kB}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>R(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Fy(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function qm(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),W(ni,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>R(this,null,function*(){r.isEqual(i)||(yield BT(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function OE(n,e){return R(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield PB(n);W(ni,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>DE(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>DE(e.remoteStore,i)),n._onlineComponents=e})}function MB(n){return n.name==="FirebaseError"?n.code===N.FAILED_PRECONDITION||n.code===N.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===OB||n.code===NB||n.code===xB:!0}function PB(n){return R(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){W(ni,"Using user provided OfflineComponentProvider");try{yield qm(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!MB(t))throw t;Ws("Error using user provided cache. Falling back to memory cache: "+t),yield qm(n,new kE)}}else W(ni,"Using default OfflineComponentProvider"),yield qm(n,new kE);return n._offlineComponents})}function aw(n){return R(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(W(ni,"Using user provided OnlineComponentProvider"),yield OE(n,n._uninitializedComponentsProvider._online)):(W(ni,"Using default OnlineComponentProvider"),yield OE(n,new IB))),n._onlineComponents})}function FB(n){return aw(n).then(e=>e.syncEngine)}function dy(n){return R(this,null,function*(){let e=yield aw(n),t=e.eventManager;return t.onListen=uB.bind(null,e.syncEngine),t.onUnlisten=fB.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=dB.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=pB.bind(null,e.syncEngine),t})}function LB(n,e,t,r){let i=new Qu(r),s=new Wu(e,i,t);return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let o=yield dy(n);return YT(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let o=yield dy(n);return JT(o,s)}))}}function VB(n,e,t={}){let r=new yn;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let i=yield dy(n);return UB(i,n.asyncQueue,e,t,r)})),r.promise}function BB(n,e){let t=new yn;return n.asyncQueue.enqueueAndForget(()=>R(this,null,function*(){let r=yield FB(n);return mB(r,e,t)})),t.promise}function UB(n,e,t,r,i){let s=new Qu({next:a=>{s.mute(),e.enqueueAndForget(()=>JT(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new H(N.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new H(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Wu(od(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return YT(n,o)}function qB(n,e){return n.timeoutSeconds===e.timeoutSeconds}function lw(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var zB="ComponentProvider",ME=new Map;function GB(n){let e=ME.get(n);e&&(W(zB,"Removing Datastore"),ME.delete(n),e.terminate())}function jB(n,e,t,r){return new Jm(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,lw(r.experimentalLongPollingOptions),r.useFetchStreams)}var cw="firestore.googleapis.com",PE=!0,FE=5,LE=30,$B=!0,Yu=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new H(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=cw,this.ssl=PE}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:PE;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=VT;else{if(e.cacheSizeBytes!==LT&&e.cacheSizeBytes<TE)throw new H(N.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${TE}`);this.cacheSizeBytes=e.cacheSizeBytes}AB("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=$B:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),WB(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&qB(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function WB(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new H(N.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<FE)throw new H(N.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${FE})`);if(n.timeoutSeconds>LE)throw new H(N.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${LE})`)}}var so=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yu(e),e.credentials!==void 0&&(this._authCredentials=QP(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return R(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return GB(this),Promise.resolve()}};function uw(n,e,t,r={}){var i;n=$n(n,so);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==cw&&s.host!==o&&Ws("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=tt.MOCK_USER;else{a=Ev(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new H(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new tt(c)}n._authCredentials=new Gm(new Du(a,l))}}var Ju=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},xt=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Zr=class n extends Ju{constructor(e,t,r){super(e,t,od(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new xt(this.firestore,null,new Y(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function dw(n,e,...t){if(n=rn(n),ow("collection","path",e),n instanceof so){let r=Ne.fromString(e,...t);return NE(r),new Zr(n,null,r)}else{if(!(n instanceof xt)&&!(n instanceof Zr))throw new H(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Ne.fromString(e,...t));return NE(r),new Zr(n.firestore,null,r)}}function qy(n,e,...t){if(n=rn(n),arguments.length===1&&(e=Ru.newId()),ow("doc","path",e),n instanceof so){let r=Ne.fromString(e,...t);return xE(r),new xt(n,null,new Y(r))}else{if(!(n instanceof xt)&&!(n instanceof Zr))throw new H(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Ne.fromString(e,...t));return xE(r),new xt(n.firestore,n instanceof Zr?n.converter:null,new Y(r))}}var KB="AsyncQueue",Xu=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new qu(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new yn;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return R(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Va(e))W(KB,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=HB(r);throw _n("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=ty.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&J()}verifyOperationInProgress(){}drain(){return R(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function HB(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var ur=class extends so{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Xu,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return R(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Xu(e),this._firestoreClient=void 0,yield e}})}};function hw(n,e){let t=typeof n=="object"?n:bo(),r=typeof n=="string"?n:e||Xm,i=qd(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=bv("firestore");s&&uw(i,...s)}return i}function zy(n){if(n._terminated)throw new H(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||QB(n),n._firestoreClient}function QB(n){var e,t,r;let i=n._freezeSettings(),s=jB(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new uy(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&YB(n._componentsProvider))}function YB(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function JB(n,e=!0){KP(Dv),Co(new So("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new ur(new jm(t.getProvider("auth-internal")),new Hm(t.getProvider("app-check-internal")),TF(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),St(sE,oE,n),St(sE,oE,"esm2017")}var Oa=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(mt.fromBase64String(e))}catch(t){throw new H(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(mt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var oo=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new H(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ma=class{constructor(e){this._methodName=e}};var Pa=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new H(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new H(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ue(this._lat,e._lat)||ue(this._long,e._long)}};var Fa=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return eV(this._values,e._values)}};var XB=/^__.*__$/,hy=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Kn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pi(e,this.data,t,this.fieldTransforms)}},Zu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Kn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function fw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw J()}}var fy=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return td(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(fw(this.dataSource)&&XB.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},py=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ud(e)}createContext(e,t,r,i=!1){return new fy({dataSource:e,methodName:t,targetDoc:r,path:Ut.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function pw(n){let e=n._freezeSettings(),t=ud(n._databaseId);return new py(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ZB(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);Gy("Data must be an object, but it was:",o,r);let a=mw(r,o),l,c;if(s.merge)l=new tn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let p of s.mergeFields){let m=my(e,p,t);if(!o.contains(m))throw new H(N.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);yw(u,m)||u.push(m)}l=new tn(u),c=o.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,c=o.fieldTransforms;return new hy(new Bt(a),l,c)}var ed=class n extends Ma{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function eU(n,e,t,r){let i=n.createContext(1,e,t);Gy("Data must be an object, but it was:",i,r);let s=[],o=Bt.empty();Vi(r,(l,c)=>{let u=jy(e,l,t);c=rn(c);let p=i.childContextForFieldPath(u);if(c instanceof ed)s.push(u);else{let m=fd(c,p);m!=null&&(s.push(u),o.set(u,m))}});let a=new tn(s);return new Zu(o,a,i.fieldTransforms)}function tU(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[my(e,r,t)],l=[i];if(s.length%2!==0)throw new H(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(my(e,s[m])),l.push(s[m+1]);let c=[],u=Bt.empty();for(let m=a.length-1;m>=0;--m)if(!yw(c,a[m])){let S=a[m],E=l[m];E=rn(E);let T=o.childContextForFieldPath(S);if(E instanceof ed)c.push(S);else{let b=fd(E,T);b!=null&&(c.push(S),u.set(S,b))}}let p=new tn(c);return new Zu(u,p,o.fieldTransforms)}function fd(n,e){if(n=rn(n),gw(n))return Gy("Unsupported field value:",e,n),mw(n,e);if(n instanceof Ma)return rU(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return nU(n,e)}else return iU(n,e)}function mw(n,e){let t={};return eT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vi(n,(r,i)=>{let s=fd(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function nU(n,e){let t=[],r=0;for(let i of n){let s=fd(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function rU(n,e){if(!fw(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function iU(n,e){if(n=rn(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return bL(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=it.fromDate(n);return{timestampValue:Vu(e.serializer,t)}}else if(n instanceof it){let t=new it(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Vu(e.serializer,t)}}else{if(n instanceof Pa)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Oa)return{bytesValue:kT(e.serializer,n._byteString)};if(n instanceof xt){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:ky(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof Fa)return sU(n,e);throw e.createError(`Unsupported field value: ${Uy(n)}`)}}}function sU(n,e){return{mapValue:{fields:{[Ey]:{stringValue:Ty},[Hs]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return Ry(e.serializer,r)})}}}}}}function gw(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof it)&&!(n instanceof Pa)&&!(n instanceof Oa)&&!(n instanceof xt)&&!(n instanceof Ma)&&!(n instanceof Fa)}function Gy(n,e,t){if(!gw(t)||!DB(t)){let r=Uy(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function my(n,e,t){if(e=rn(e),e instanceof oo)return e._internalPath;if(typeof e=="string")return jy(n,e);throw td("Field path arguments must be of type string or ",n,!1,void 0,t)}var oU=new RegExp("[~\\*/\\[\\]]");function jy(n,e,t){if(e.search(oU)>=0)throw td(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new oo(...e.split("."))._internalPath}catch{throw td(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function td(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new H(N.INVALID_ARGUMENT,a+n+l)}function yw(n,e){return n.some(t=>t.isEqual(e))}var nd=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new xt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new gy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(vw("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},gy=class extends nd{data(){return super.data()}};function vw(n,e){return typeof e=="string"?jy(n,e):e instanceof oo?e._internalPath:e._delegate._internalPath}function aU(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new H(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var yy=class{convertValue(e,t="none"){switch(Ni(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw J()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Vi(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Hs].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ae(o.doubleValue));return new Fa(s)}convertGeoPoint(e){return new Pa(Ae(e.latitude),Ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Cy(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ea(e));default:return null}}convertTimestamp(e){let t=lr(e);return new it(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=Ne.fromString(e);ye(FT(r));let i=new Nu(r.get(1),r.get(3)),s=new Y(r.popFirst(5));return i.isEqual(t)||_n(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function lU(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}function VE(n){return cU(n,["next","error","complete"])}function cU(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Li=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},rd=class extends nd{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new ao(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(vw("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},ao=class extends rd{data(e={}){return super.data(e)}},vy=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Li(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ao(this._firestore,this._userDataWriter,r.key,r,new Li(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new H(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=uU(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function uU(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new ao(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Li(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new ao(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Li(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:dU(r.type),doc:i,oldIndex:s,newIndex:o}})}}function dU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return J()}}function _w(n){n=$n(n,xt);let e=$n(n.firestore,ur),t=zy(e);return VB(t,n._key).then(r=>Ew(e,n,r))}var id=class extends yy{constructor(e){super(),this.firestore=e}convertBytes(e){return new Oa(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new xt(this.firestore,null,t)}};function Sw(n,e,t,...r){n=$n(n,xt);let i=$n(n.firestore,ur),s=pw(i);e=rn(e);let o;typeof e=="string"||e instanceof oo?o=tU(s,"updateDoc",n._key,e,t,r):o=eU(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,ar.exists(!0));return Wy(i,[a])}function Cw(n){let e=$n(n.firestore,ur),t=[new Da(n._key,ar.none())];return Wy(e,t)}function bw(n,e){let t=$n(n.firestore,ur),r=qy(n),i=lU(n.converter,e),s=pw(n.firestore),a=ZB(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ar.exists(!1));return Wy(t,[a]).then(()=>r)}function $y(n,...e){var t,r,i;n=rn(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!VE(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(VE(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let l,c,u;if(n instanceof xt)c=$n(n.firestore,ur),u=od(n._key.path),l={next:m=>{e[o]&&e[o](Ew(c,n,m))},error:e[o+1],complete:e[o+2]};else{let m=$n(n,Ju);c=$n(m.firestore,ur),u=m._query;let S=new id(c);l={next:E=>{e[o]&&e[o](new vy(c,S,m,E))},error:e[o+1],complete:e[o+2]},aU(n._query)}let p=zy(c);return LB(p,u,a,l)}function Wy(n,e){let t=zy(n);return BB(t,e)}function Ew(n,e,t){let r=t.docs.get(e._key),i=new id(n);return new rd(n,i,e._key,r,new Li(t.hasPendingWrites,t.fromCache),e.converter)}JB("node");var pd=function(){return pd=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},pd.apply(this,arguments)};var pU={includeMetadataChanges:!1};function Tw(n,e){return e===void 0&&(e=pU),new fr(function(t){var r=$y(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function ww(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:pd(pd({},r),(t={},t[e.idField]=n.id,t))}function Iw(n){return Tw(n,{includeMetadataChanges:!0}).pipe(Mt(function(e){return e.docs}))}function Aw(n,e){return e===void 0&&(e={}),Iw(n).pipe(Mt(function(t){return t.map(function(r){return ww(r,e)})}))}var dr=class{constructor(e){return e}},Dw="firestore",Ky=class{constructor(){return No(Dw)}};var Hy=new Pe("angularfire2.firestore-instances");function mU(n,e){let t=sh(Dw,n,e);return t&&new dr(t)}function gU(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new dr(r)}}var yU={provide:Ky,deps:[[new Cn,Hy]]},vU={provide:dr,useFactory:mU,deps:[[new Cn,Hy],pi]};function Rw(n,...e){return St("angularfire",on.full,"fst"),ja([vU,yU,{provide:Hy,useFactory:gU(n),multi:!0,deps:[bn,go,fi,Oo,[new Cn,Rl],[new Cn,Er],...e]}])}var md=an(Aw,!0);var kw=an(bw,!0);var uo=an(dw,!0);var xw=an(Cw,!0);var gd=an(qy,!0);var Nw=an(_w,!0);var Ow=an(hw,!0);var Mw=an(Sw,!0);var ho=class n{constructor(e){this.fireStore=e}products;addCommande(e,t,r){let i={userid:e,montantTotal:t,dateCommande:new Date,details:r},s=uo(this.fireStore,"orders");kw(s,i).then(()=>console.log("data saved successfully !")).catch(o=>console.log(o))}getAllOrders(){let e=uo(this.fireStore,"orders");return md(e,{idField:"id"})}getOrderId(e){let t=uo(this.fireStore,"orders"),r=gd(this.fireStore,"orders",e);return Nw(r)}updateOrder(e){let t=gd(this.fireStore,"products",e);Mw(t,{name:"updated name",montant:1e3}).then(()=>console.log(`Order with ${e} updated successfully ! `)).catch(i=>console.log(i))}deleteOrder(e){let t=gd(this.fireStore,"orders",e);xw(t).then(()=>console.log("data deleted !")).catch(r=>console.log(r))}static \u0275fac=function(t){return new(t||n)(he(dr))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};function SU(n,e){if(n&1){let t=Ke();I(0,"tr")(1,"td"),pe(2,"img",6),w(),I(3,"td"),L(4),w(),I(5,"td"),L(6),w(),I(7,"td")(8,"button",7),ie("click",function(){let i=Se(t).$index,s=me();return Ce(s.decreaseQuantity(i))}),L(9,"-"),w(),I(10,"input",8),ct("ngModelChange",function(i){let s=Se(t).$implicit;return lt(s.quantite,i)||(s.quantite=i),Ce(i)}),ie("ngModelChange",function(){let i=Se(t),s=i.$implicit,o=i.$index,a=me();return Ce(a.updateQuantite(o,s.quantite))}),w(),I(11,"button",7),ie("click",function(){let i=Se(t).$index,s=me();return Ce(s.increaseQuantity(i))}),L(12,"+"),w()(),I(13,"td"),L(14),w(),I(15,"td")(16,"button",9),ie("click",function(){let i=Se(t).$index,s=me();return Ce(s.removeItem(i))}),L(17," Supprimer "),w()()()}if(n&2){let t=e.$implicit;B(2),X("src",t.produit.images[0],En),B(2),rt(t.produit.title),B(2),rt(t.produit.price),B(4),at("ngModel",t.quantite),B(4),rt(t.produit.price*t.quantite)}}var yd=class n{constructor(e,t,r,i){this.sharedService=e;this.authService=t;this.router=r;this.fireStoreService=i}items=[];ngOnInit(){this.sharedService.cartItems$.subscribe(e=>{this.items=e})}updateQuantite(e,t){t<1?this.items[e].quantite=1:this.items[e].quantite=t}calculateTotal(){return this.items.reduce((e,t)=>e+t.produit.price*t.quantite,0)}removeItem(e){this.items.splice(e,1)}validerPanier(){return R(this,null,function*(){if(this.authService.isLoggedIn()){let e=yield this.authService.getUserId();if(e){let t=this.calculateTotal(),r=this.items;this.fireStoreService.addCommande(e,t,r),alert("Panier valid\xE9 avec succ\xE8s!"),this.items=[]}else console.log("User ID could not be retrieved.")}else this.router.navigate(["/signin"])})}increaseQuantity(e){this.items[e].quantite+=1}decreaseQuantity(e){this.items[e].quantite>1&&(this.items[e].quantite-=1)}static \u0275fac=function(t){return new(t||n)(z(It),z(Ye),z(Tt),z(ho))};static \u0275cmp=ze({type:n,selectors:[["app-panier"]],inputs:{items:"items"},standalone:!0,features:[je],decls:26,vars:2,consts:[[1,"container","mt-4"],[1,"table","table-bordered"],[1,"thead-dark"],["scope","col"],[1,"text-end"],[1,"btn","btn-primary",3,"click","disabled"],["alt","product image","width","50",3,"src"],[1,"btn","btn-secondary","btn-sm",3,"click"],["type","number","min","1",1,"form-control","d-inline",2,"width","60px",3,"ngModelChange","ngModel"],[1,"btn","btn-danger","btn-sm",3,"click"]],template:function(t,r){t&1&&(I(0,"div",0)(1,"h2"),L(2,"Panier"),w(),I(3,"table",1)(4,"thead",2)(5,"tr")(6,"th",3),L(7,"Image"),w(),I(8,"th",3),L(9,"Description"),w(),I(10,"th",3),L(11,"Prix"),w(),I(12,"th",3),L(13,"Quantit\xE9"),w(),I(14,"th",3),L(15,"Total"),w(),I(16,"th",3),L(17,"Actions"),w()()(),I(18,"tbody"),Ha(19,SU,18,5,"tr",null,Ka),w()(),I(21,"div",4)(22,"h4"),L(23),w()(),I(24,"button",5),ie("click",function(){return r.validerPanier()}),L(25," Valider le Panier "),w()()),t&2&&(B(19),Qa(r.items),B(4),ot("Total: ",r.calculateTotal(),""),B(),X("disabled",r.items.length===0))},dependencies:[Tn,wt,Zd,Gt,nh,sn],styles:["@media (max-width: 768px){.table[_ngcontent-%COMP%]{font-size:12px}.btn[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.8rem}input[type=number][_ngcontent-%COMP%]{width:50px}}"]})};var vd=class{fullName;email;password;constructor(e,t,r){this.fullName=e,this.email=t,this.password=r}};var _d=class{user;rating;comment;date;constructor(e,t,r,i){this.user=e,this.rating=t,this.comment=r,this.date=i}};var CU=n=>({color:n}),bU=n=>({active:n}),Fw=()=>[1,2,3,4,5],Lw=n=>({filled:n});function EU(n,e){if(n&1&&(I(0,"div",18),pe(1,"img",19),w()),n&2){let t=e.$implicit,r=e.index,i=me();X("ngClass",ai(3,bU,r===0)),B(),Ya("alt",i.product.title),X("src",t,En)}}function TU(n,e){if(n&1&&(I(0,"span",25),L(1," \u2605 "),w()),n&2){let t=e.$implicit,r=me().$implicit;X("ngClass",ai(1,Lw,t<=r.rating))}}function wU(n,e){if(n&1&&(I(0,"li",22)(1,"div",23)(2,"strong"),L(3),w(),I(4,"span"),L(5),w()(),I(6,"p"),L(7),w(),Fe(8,TU,2,3,"span",24),pe(9,"br"),w()),n&2){let t=e.$implicit;B(3),rt(t.user.fullName),B(2),tv("",t.date.getFullYear(),"-",t.date.getMonth()+1,"-",t.date.getDate(),""),B(2),rt(t.comment),B(),X("ngForOf",Md(6,Fw))}}function IU(n,e){if(n&1&&(I(0,"div")(1,"ul",20),Fe(2,wU,10,7,"li",21),w()()),n&2){let t=me();B(2),X("ngForOf",t.comments)}}function AU(n,e){n&1&&(I(0,"div",26)(1,"p"),L(2,"No comments yet. Be the first to comment!"),w()())}function DU(n,e){if(n&1){let t=Ke();I(0,"span",37),ie("click",function(){let i=Se(t).$implicit,s=me(2);return Ce(s.setRating(i))}),L(1," \u2605 "),w()}if(n&2){let t=e.$implicit,r=me(2);X("ngClass",ai(1,Lw,t<=r.commentForm.controls.rating.value))}}function RU(n,e){if(n&1){let t=Ke();I(0,"div",27)(1,"form",28),ie("ngSubmit",function(){Se(t);let i=me();return Ce(i.addComment())}),I(2,"div",29)(3,"label",30),L(4,"Your Comment"),w(),pe(5,"textarea",31),w(),I(6,"div",29)(7,"label",32),L(8,"Rating"),w(),pe(9,"br"),Fe(10,DU,2,3,"span",33),w(),I(11,"div",29)(12,"label",34),L(13,"Your Name"),w(),pe(14,"input",35),w(),I(15,"button",36),L(16," Submit Comment "),w()()()}if(n&2){let t=me();B(),X("formGroup",t.commentForm),B(9),X("ngForOf",Md(3,Fw)),B(5),X("disabled",t.commentForm.invalid)}}var Sd=class n{constructor(e,t,r,i,s,o){this.route=e;this.produitService=t;this.sharedService=r;this.authService=s;this.router=o;this.commentForm=i.group({comment:["",_r.required],rating:[0,[_r.required,_r.min(1),_r.max(5)]],user:["",_r.required]})}product;commentForm;comments=[];showForm=!1;isLoggedIn;ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&this.produitService.getProductById(+e).subscribe(r=>{r?this.product=r:console.error("Product not found")},r=>{console.error("Error fetching product:",r)}),this.authService.isAuth$.subscribe(r=>{this.isLoggedIn=r});let t=localStorage.getItem(`comments_${e}`);t&&(this.comments=JSON.parse(t)||[]),this.authService.isAuth$.subscribe(r=>{this.isLoggedIn=r})}addComment(){if(this.commentForm.valid){let e=new vd(this.commentForm.value.user,"",""),t=this.commentForm.value.rating,r=this.commentForm.value.comment,i=new Date,s=new _d(e,t,r,new Date);this.comments.push(s);let o=this.route.snapshot.paramMap.get("id");o&&localStorage.setItem(`comments_${o}`,JSON.stringify(this.comments)),this.commentForm.reset(),this.commentForm.patchValue({rating:0})}}getColor(){return this.product?.stock>0?"green":"red"}getState(){return this.product?.stock>0?"En stock":"En rupture de stock"}addToPanier(){this.product&&this.sharedService.addProductToCart({produit:this.product,quantite:1})}toggleForm(){this.isLoggedIn?this.showForm=!this.showForm:this.router.navigate(["/signin"])}setRating(e){this.commentForm.patchValue({rating:e})}static \u0275fac=function(t){return new(t||n)(z(vv),z(wn),z(It),z(h_),z(Ye),z(Tt))};static \u0275cmp=ze({type:n,selectors:[["app-details-produits"]],standalone:!0,features:[je],decls:35,vars:12,consts:[[1,"container","mt-5"],[1,"row"],[1,"col-md-6"],["id","carouselExample","data-bs-ride","carousel",1,"carousel","slide"],[1,"carousel-inner"],["class","carousel-item",3,"ngClass",4,"ngFor","ngForOf"],["type","button","data-bs-target","#carouselExample","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button","data-bs-target","#carouselExample","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"],[1,"text-muted"],[3,"ngStyle"],[1,"btn","btn-primary",3,"click"],[4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"mt-4"],["class","mb-4 mt-3",4,"ngIf"],[1,"carousel-item",3,"ngClass"],[1,"d-block","w-100","img-fluid",3,"src","alt"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","justify-content-between"],["class","star",3,"ngClass",4,"ngFor","ngForOf"],[1,"star",3,"ngClass"],[1,"mt-3"],[1,"mb-4","mt-3"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","comment",1,"form-label"],["id","comment","formControlName","comment","rows","3","required","",1,"form-control"],[1,"form-label"],["class","star",3,"ngClass","click",4,"ngFor","ngForOf"],["for","user",1,"form-label"],["id","user","type","text","formControlName","user","required","",1,"form-control"],["type","submit",1,"btn","btn-secondary",3,"disabled"],[1,"star",3,"click","ngClass"]],template:function(t,r){t&1&&(I(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Fe(5,EU,2,5,"div",5),w(),I(6,"button",6),pe(7,"span",7),I(8,"span",8),L(9,"Previous"),w()(),I(10,"button",9),pe(11,"span",10),I(12,"span",8),L(13,"Next"),w()()()(),I(14,"div",2)(15,"h2"),L(16),w(),I(17,"p",11),L(18),w(),I(19,"h4"),L(20),w(),I(21,"span",12),L(22),w(),pe(23,"br"),I(24,"a",13),ie("click",function(){return r.addToPanier()}),L(25,"Add To Panier"),w()(),I(26,"div",2)(27,"h5"),L(28,"User Comments"),w(),Fe(29,IU,3,1,"div",14)(30,AU,3,0,"div",15),I(31,"div",16)(32,"button",13),ie("click",function(){return r.toggleForm()}),L(33),w()(),Fe(34,RU,17,4,"div",17),w()()()),t&2&&(B(5),X("ngForOf",r.product.images),B(11),rt(r.product.title),B(2),rt(r.product.description),B(2),ot("",r.product.price," $"),B(),X("ngStyle",ai(10,CU,r.getColor())),B(),rt(r.getState()),B(7),X("ngIf",r.comments.length>0),B(),X("ngIf",r.comments.length===0),B(3),ot(" ",r.showForm?"Cancel":"Leave a Comment"," "),B(),X("ngIf",r.showForm))},dependencies:[lv,$i,el,f_,br,wt,Gt,Cr,di,eh,th,Wi],styles:[".carousel-control-prev-icon[_ngcontent-%COMP%], .carousel-control-next-icon[_ngcontent-%COMP%]{background-color:#00000080;border-radius:50%}.carousel-control-prev-icon[_ngcontent-%COMP%], .carousel-control-next-icon[_ngcontent-%COMP%]{width:3rem;height:3rem}.carousel-control-prev[_ngcontent-%COMP%]:hover   .carousel-control-prev-icon[_ngcontent-%COMP%], .carousel-control-next[_ngcontent-%COMP%]:hover   .carousel-control-next-icon[_ngcontent-%COMP%]{background-color:#ffffffb3}textarea[_ngcontent-%COMP%]{resize:none}.list-group-item[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]{margin-bottom:10px}.star[_ngcontent-%COMP%]{font-size:1.5rem;cursor:pointer;color:#ddd}.star.filled[_ngcontent-%COMP%]{color:#fc0}"]})};var fo=class n{constructor(e,t){this.authService=e;this.router=t}canActivate(e,t){return this.authService.isAuth$.pipe(Mt(r=>r?!0:(this.router.navigate(["signin"]),!1)))}static \u0275fac=function(t){return new(t||n)(he(Ye),he(Tt))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};var Cd=class n{constructor(e,t){this.router=e;this.auth=t}email="";password="";rememberMe=!1;onSubmit(){this.auth.login(this.email,this.password).then(e=>{let t=e.user.multiFactor.user.accessToken;localStorage.setItem("accessToken",t)}),this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||n)(z(Tt),z(Ye))};static \u0275cmp=ze({type:n,selectors:[["app-authentification"]],standalone:!0,features:[je],decls:27,vars:3,consts:[[1,"auth-container"],[1,"auth-form"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","name","email","required","","placeholder","Enter your email",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","mt-3"],["for","password"],["type","password","id","password","name","password","required","","placeholder","Enter your password",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-check","mt-3"],["type","checkbox","id","rememberMe","name","rememberMe",1,"form-check-input",3,"ngModelChange","ngModel"],["for","rememberMe",1,"form-check-label"],["type","submit",1,"btn","btn-primary","btn-block","mt-4"],[1,"mt-3"],["routerLink","/signup"],[1,"mt-2"],["routerLink","/forgot-password"]],template:function(t,r){t&1&&(I(0,"div",0)(1,"div",1)(2,"h2"),L(3,"Sign In"),w(),I(4,"form",2),ie("ngSubmit",function(){return r.onSubmit()}),I(5,"div",3)(6,"label",4),L(7,"Email Address"),w(),I(8,"input",5),ct("ngModelChange",function(s){return lt(r.email,s)||(r.email=s),s}),w()(),I(9,"div",6)(10,"label",7),L(11,"Password"),w(),I(12,"input",8),ct("ngModelChange",function(s){return lt(r.password,s)||(r.password=s),s}),w()(),I(13,"div",9)(14,"input",10),ct("ngModelChange",function(s){return lt(r.rememberMe,s)||(r.rememberMe=s),s}),w(),I(15,"label",11),L(16,"Remember Me"),w()(),I(17,"button",12),L(18,"Sign In"),w()(),I(19,"p",13),L(20,"Don't have an account? "),I(21,"a",14),L(22,"Sign up here"),w(),L(23,"."),w(),I(24,"p",15)(25,"a",16),L(26,"Forgot your password?"),w()()()()),t&2&&(B(8),at("ngModel",r.email),B(4),at("ngModel",r.password),B(2),at("ngModel",r.rememberMe))},dependencies:[Tn,br,wt,Kd,Gt,Cr,di,sn,ui,nl],styles:[".auth-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}.auth-form[_ngcontent-%COMP%]{width:300px;padding:20px;background-color:#fff;border-radius:8px;box-shadow:0 4px 8px #0000001a}.form-control[_ngcontent-%COMP%], .btn-block[_ngcontent-%COMP%]{width:100%}"]})};function kU(n,e){if(n&1){let t=Ke();I(0,"div",13)(1,"input",14),ie("change",function(i){Se(t);let s=me();return Ce(s.onFileSelected(i))}),w()()}}function xU(n,e){if(n&1&&(I(0,"h4"),L(1),w()),n&2){let t=me();B(),rt(t.user.name)}}function NU(n,e){if(n&1){let t=Ke();I(0,"input",15),ct("ngModelChange",function(i){Se(t);let s=me();return lt(s.user.name,i)||(s.user.name=i),Ce(i)}),w()}if(n&2){let t=me();at("ngModel",t.user.name)}}function OU(n,e){if(n&1&&(I(0,"p"),L(1),w()),n&2){let t=me();B(),rt(t.user.email)}}function MU(n,e){if(n&1){let t=Ke();I(0,"input",16),ct("ngModelChange",function(i){Se(t);let s=me();return lt(s.user.email,i)||(s.user.email=i),Ce(i)}),w()}if(n&2){let t=me();at("ngModel",t.user.email)}}function PU(n,e){if(n&1){let t=Ke();I(0,"button",17),ie("click",function(){Se(t);let i=me();return Ce(i.toggleEditMode())}),L(1,"Edit Profile"),w()}}function FU(n,e){if(n&1){let t=Ke();I(0,"button",18),ie("click",function(){Se(t);let i=me();return Ce(i.saveProfile())}),L(1,"Save"),w()}}function LU(n,e){if(n&1){let t=Ke();I(0,"button",19),ie("click",function(){Se(t);let i=me();return Ce(i.toggleEditMode())}),L(1,"Cancel"),w()}}var bd=class n{constructor(e){this.auth=e}user={name:"",email:"",profilePicture:""};isEditing=!1;ngOnInit(){this.getUserProfile()}getUserProfile(){let e=this.auth.getUser();e&&(this.user.name=e.name,this.user.email=e.email,this.user.profilePicture=e.profilePicture)}toggleEditMode(){this.isEditing=!this.isEditing}saveProfile(){this.auth.updateUser(this.user),this.isEditing=!1}onFileSelected(e){let t=e.target.files[0];if(t){let r=new FileReader;r.onload=i=>{this.user.profilePicture=i.target.result},r.readAsDataURL(t)}}static \u0275fac=function(t){return new(t||n)(z(Ye))};static \u0275cmp=ze({type:n,selectors:[["app-user-profile"]],standalone:!0,features:[je],decls:14,vars:9,consts:[[1,"container","mt-5"],[1,"card","mx-auto",2,"max-width","600px"],[1,"card-body","text-center"],[1,"profile-picture","mb-3"],["alt","Profile Picture",1,"rounded-circle","img-fluid",2,"width","150px","height","150px",3,"src"],["class","mb-3",4,"ngIf"],[4,"ngIf"],["class","form-control mb-3","placeholder","Name",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-control mb-3","placeholder","Email","type","email",3,"ngModel","ngModelChange",4,"ngIf"],[1,"d-flex","justify-content-center"],["class","btn btn-primary me-2",3,"click",4,"ngIf"],["class","btn btn-success me-2",3,"click",4,"ngIf"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"mb-3"],["type","file",3,"change"],["placeholder","Name",1,"form-control","mb-3",3,"ngModelChange","ngModel"],["placeholder","Email","type","email",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","me-2",3,"click"],[1,"btn","btn-success","me-2",3,"click"],[1,"btn","btn-secondary",3,"click"]],template:function(t,r){t&1&&(I(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),pe(4,"img",4),w(),Fe(5,kU,2,0,"div",5)(6,xU,2,1,"h4",6)(7,NU,1,1,"input",7)(8,OU,2,1,"p",6)(9,MU,1,1,"input",8),I(10,"div",9),Fe(11,PU,2,0,"button",10)(12,FU,2,0,"button",11)(13,LU,2,0,"button",12),w()()()()),t&2&&(B(4),X("src",r.user.profilePicture||"assets/default-profile.png",En),B(),X("ngIf",r.isEditing),B(),X("ngIf",!r.isEditing),B(),X("ngIf",r.isEditing),B(),X("ngIf",!r.isEditing),B(),X("ngIf",r.isEditing),B(2),X("ngIf",!r.isEditing),B(),X("ngIf",r.isEditing),B(),X("ngIf",r.isEditing))},dependencies:[Tn,wt,Gt,sn,Wi],styles:[".profile-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:3px solid #ddd;padding:5px}"]})};var Ed=class n{constructor(e,t){this.router=e;this.auth=t}email="";password="";fullName="";onSubmit(){this.auth.signup(this.email,this.password),this.router.navigate(["/signin"])}static \u0275fac=function(t){return new(t||n)(z(Tt),z(Ye))};static \u0275cmp=ze({type:n,selectors:[["app-registration"]],standalone:!0,features:[je],decls:20,vars:4,consts:[["userForm","ngForm"],[1,"auth-container"],[1,"auth-form"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","fullName","name","email","required","","placeholder","Enter your full name",1,"form-control",3,"ngModelChange","ngModel"],["type","email","id","email","name","email","required","","placeholder","Enter your email",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","mt-3"],["for","password"],["type","password","id","password","name","password","required","","placeholder","Enter your password",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary","btn-block","mt-4",3,"disabled"]],template:function(t,r){if(t&1){let i=Ke();I(0,"div",1)(1,"div",2)(2,"h2"),L(3,"Sign In"),w(),I(4,"form",3,0),ie("ngSubmit",function(){return Se(i),Ce(r.onSubmit())}),I(6,"div",4)(7,"label",5),L(8,"Full Name"),w(),I(9,"input",6),ct("ngModelChange",function(o){return Se(i),lt(r.fullName,o)||(r.fullName=o),Ce(o)}),w()(),I(10,"div",4)(11,"label",5),L(12,"Email Address"),w(),I(13,"input",7),ct("ngModelChange",function(o){return Se(i),lt(r.email,o)||(r.email=o),Ce(o)}),w()(),I(14,"div",8)(15,"label",9),L(16,"Password"),w(),I(17,"input",10),ct("ngModelChange",function(o){return Se(i),lt(r.password,o)||(r.password=o),Ce(o)}),w()(),I(18,"button",11),L(19,"Sign Up"),w()()()()}if(t&2){let i=Ja(5);B(9),at("ngModel",r.fullName),B(4),at("ngModel",r.email),B(4),at("ngModel",r.password),B(),X("disabled",i.invalid)}},dependencies:[Tn,br,wt,Gt,Cr,di,sn,ui]})};var Td=class n{constructor(e){this.firestore=e;this.ordersCollection=uo(this.firestore,"orders")}ordersCollection;getValidCommandes(){return md(this.ordersCollection,{idField:"id"}).pipe(Mt(e=>e.map(t=>Ot(vt({},t),{dateCommande:t.dateCommande.toDate()}))))}static \u0275fac=function(t){return new(t||n)(he(dr))};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};function BU(n,e){if(n&1&&(I(0,"li",10),pe(1,"img",11),I(2,"div",12)(3,"span"),L(4),w(),I(5,"span"),L(6),w(),I(7,"span"),L(8),_o(9,"currency"),w()()()),n&2){let t=e.$implicit;B(),X("src",t.produit.images[0],En),B(3),ot("Product ID: ",t.produit.id,""),B(2),ot("Quantity: ",t.quantite,""),B(2),ot("Price: ",Xa(9,4,t.produit.price),"")}}function UU(n,e){if(n&1&&(I(0,"div",4)(1,"div",5)(2,"h3"),L(3),w(),pe(4,"hr",6),w(),I(5,"div",7)(6,"p"),L(7),_o(8,"date"),w(),I(9,"p",8),L(10),_o(11,"currency"),w()(),I(12,"ul"),Fe(13,BU,10,6,"li",9),w()()),n&2){let t=e.$implicit,r=e.index;B(3),ot("Order #",r+1,""),B(4),ot("Date: ",nv(8,4,t.dateCommande,"medium"),""),B(3),ot("Total Amount: ",Xa(11,7,t.montantTotal),""),B(3),X("ngForOf",t.details)}}function qU(n,e){if(n&1&&(I(0,"div",2)(1,"h2"),L(2,"Validated Orders"),w(),Fe(3,UU,14,9,"div",3),w()),n&2){let t=e.ngIf;B(3),X("ngForOf",t)}}function zU(n,e){n&1&&(I(0,"p",13),L(1,"Loading orders..."),w())}var wd=class n{constructor(e){this.commandesService=e}commandes$;ngOnInit(){this.commandes$=this.commandesService.getValidCommandes()}static \u0275fac=function(t){return new(t||n)(z(Td))};static \u0275cmp=ze({type:n,selectors:[["app-commandes"]],standalone:!0,features:[je],decls:4,vars:4,consts:[["loading",""],["class","commandes-container",4,"ngIf","ngIfElse"],[1,"commandes-container"],["class","commande-card",4,"ngFor","ngForOf"],[1,"commande-card"],[1,"order-header"],[1,"separator"],[1,"commande-info"],[1,"total-amount"],["class","product-item",4,"ngFor","ngForOf"],[1,"product-item"],["alt","Product Image",1,"product-image",3,"src"],[1,"product-details"],[1,"loading"]],template:function(t,r){if(t&1&&(Fe(0,qU,4,1,"div",1),_o(1,"async"),Fe(2,zU,2,0,"ng-template",null,0,rv)),t&2){let i=Ja(3);X("ngIf",Xa(1,2,r.commandes$))("ngIfElse",i)}},dependencies:[cv,uv,dv,$i,Wi],styles:[".commandes-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Arial,sans-serif}h2[_ngcontent-%COMP%]{text-align:center;font-size:2rem;margin-bottom:1rem;color:#333}.commande-card[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid #ddd;border-radius:8px;padding:20px;margin-bottom:20px;box-shadow:0 4px 8px #0000001a}.order-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;color:#333;margin:0 0 10px}.separator[_ngcontent-%COMP%]{border:none;border-top:2px solid #ddd;margin:.5rem 0 1rem}.commande-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin:.5rem 0;color:#555}.commande-info[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-weight:700;color:#333}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:1rem 0 0}.product-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px;background-color:#fff;border:1px solid #ddd;border-radius:5px;margin:5px 0}.product-image[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover;border-radius:5px;margin-right:10px}.product-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:.9rem;color:#444}.product-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:2px 0}.loading[_ngcontent-%COMP%]{text-align:center;color:#777;font-size:1rem}"]})};var Vw=[{path:"",component:Dl},{path:"panier",component:yd},{path:"product/:id",component:Sd},{path:"signin",component:Cd},{path:"profile",component:bd,canActivate:[fo]},{path:"signup",component:Ed},{path:"commandes",component:wd}];var Id=class n{isAuth=new nn(!1);isAuth$=this.isAuth.asObservable();defaultUser={name:"EL MEJBAR Otmane",email:"elmejbarotmane@gmail.com",password:"123456",profilePicture:"assets/default-profile.png"};userSubject=new nn(this.defaultUser);user$=this.userSubject.asObservable();constructor(){if(this.isBrowser()){let e=localStorage.getItem("user");e&&this.userSubject.next(JSON.parse(e));let t=localStorage.getItem("isAuth");t&&this.isAuth.next(JSON.parse(t))}}login(e,t){return e===this.defaultUser.email&&t===this.defaultUser.password?(this.isAuth.next(!0),this.isBrowser()&&(localStorage.setItem("isAuth","true"),localStorage.setItem("user",JSON.stringify(this.defaultUser))),console.log("Login successful!"),!0):(console.error("Invalid credentials!"),!1)}logout(){this.isAuth.next(!1),this.isBrowser()&&(localStorage.removeItem("isAuth"),localStorage.removeItem("user"),localStorage.removeItem("cartItems")),this.userSubject.next(this.defaultUser)}isLoggedIn(){return this.isAuth.value}getUser(){return this.userSubject.value}updateUser(e){this.userSubject.next(e),this.isBrowser()&&localStorage.setItem("user",JSON.stringify(e))}isBrowser(){return typeof window<"u"&&typeof localStorage<"u"}static \u0275fac=function(t){return new(t||n)};static \u0275prov=ke({token:n,factory:n.\u0275fac,providedIn:"root"})};var GU=Pt.initializeApp,Bw={apiKey:"AIzaSyCU_PjU3kXpaclr3Y7dWisFPXVCB0wwCwE",authDomain:"ecom-82444.firebaseapp.com",projectId:"ecom-82444",storageBucket:"ecom-82444.appspot.com",messagingSenderId:"477797322643",appId:"1:477797322643:web:64838e5f404e8b24ff6266",measurementId:"G-PCN3QWH4KR"},Uw={providers:[sv({eventCoalescing:!0}),Sv(Vw),gv(),fv(pv()),wn,Zi,It,Id,fo,$a(D_.initializeApp(Bw)),$a(Po),$a(k_),Ye,p_(()=>GU(Bw)),Rw(()=>Ow()),ho]};var jU={providers:[yv()]},qw=av(Uw,jU);var $U=()=>mv(wl,qw),e$=$U;export{e$ as a};
